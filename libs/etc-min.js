function extend(b,a){var c=function(){};c.prototype=a.prototype;b.prototype=new c();b.prototype.constructor=b;b.superclass=a.prototype}function getTextures(b){var a=[];for(var c in PIXI.TextureCache){if(c){var d=c;if(b.length>d.length){continue}if(d.substr(0,b.length)==b){a.push(PIXI.Texture.fromFrame(d))}}}if(a.length==0){console.log("Textures '"+b+"' not found")}return a}var ZObj=function(){this.cls="ZObj";this.PublicFields="allowRotation,drawAsTexture,userData,isClip,fps,autoPlay,scaleX,scaleY,offsetX,offsetY,offsetR;";this.allowRotation=true;this.clip=null;this.body=null;this.offsetX=0;this.offsetY=0;this.layer=-1;this.baseDim={x:0,y:0};this.clipSrc="";this.isClip=undefined;this._rot=0;this._x=0;this._y=0;this.isDestroyed=false;this.__defineGetter__("x",function(){return this._x});this.__defineSetter__("x",function(a){if(this.clip){this.clip.position.x=a}if(this.body){this.body.position[0]=a}return this._x=a});this.__defineGetter__("y",function(){return this._y});this.__defineSetter__("y",function(a){if(this.clip){this.clip.position.y=a}if(this.body){this.body.position[1]=a}return this._y=a});this.__defineGetter__("rotation",function(){return this._rot});this.__defineSetter__("rotation",function(a){if(this.body){this.body.angle=a}if(this.clip){this.clip.rotation=a}return this._rot=a});this.creationIndex=ZObj.items.length;ZObj.items.push(this)};ZObj.items=[];ZObj.prototype.Process=function(){};ZObj.prototype.Initialize=function(){};ZObj.prototype.UpdatePosition=function(){if(this.body&&this.clip){if(this.body.world){if(this.body.motionState!=p2.Body.STATIC){if(this.offsetX!=0||this.offsetY!=0){var a=[0,0];this.body.toWorldFrame(a,[this.offsetX*2,this.offsetY*2]);this.clip.position.x=a[0];this.clip.position.y=a[1]}else{this.clip.position.x=this.body.position[0];this.clip.position.y=this.body.position[1]}this.clip.rotation=this.body.angle}}}};ZObj.prototype.Destroy=function(){if(this.clip){delete this.clip.zobj}ZUtils.Remove(this.clip);for(var a=0;a<ZObj.items.length;a++){if(ZObj.items[a]==this){ZObj.items.splice(a,1);break}}this.clip=null;if(this.body){ZPhys.Inst.world.removeBody(this.body)}this.isDestroyed=true};ZObj.ProcessAll=function(){for(var a=0;a<ZObj.items.length;a++){if(ZObj.items[a].Process){ZObj.items[a].Process()}}};ZObj.InitializeAll=function(){var b=[];for(var a=0;a<ZObj.items.length;a++){b.push(ZObj.items[a])}for(var a=0;a<b.length;a++){if(b[a].Initialize){b[a].Initialize()}}};ZObj.DestroyAll=function(){var b=[];for(var a=0;a<ZObj.items.length;a++){b.push(ZObj.items[a])}for(var a=0;a<b.length;a++){b[a].Destroy()}};ZObj.Deserialize=function(f,e){var a=undefined;if((f.cls!=undefined)&&(f.cls!="")&&(f.cls!="ZEngine::ZObj")){var m=f.cls;if(m.indexOf("::")!=-1){m=m.split("::")[1]}if(window[m]){a=new window[m](e);a.cls=m}}if(a==undefined){a=new ZObj()}a.id=f.id;if(a.PublicFields!=undefined){var k=a.PublicFields.replace(" ","").split(";");var c;var b;var g=k.length;for(b=0;b<g;b++){if(k[b]!=""){var h=k[b].split(",");var j=h.length;for(c=0;c<j;c++){if(h[c]!=""){if(h[c].substr(0,1)=="["){continue}if(f[h[c]]!=undefined){a[h[c]]=f[h[c]]}}}}}}return a};ZObj.DeserializeZObj=function(r,m,h){var e;e=ZObj.Deserialize(r);if(e.clipSrc==""){e.clipSrc=r.clip}if(e.isClip==undefined){if(r.isClip!=undefined){e.isClip=r.isClip}}if(e.autoPlay==undefined){if(r.autoPlay!=undefined){e.autoPlay=r.autoPlay}}if(e.fps==undefined){if(r.fps!=undefined){e.fps=r.fps}}if(r.layer!=undefined){e.layer=r.layer}var l;if(r.body){var x="DYNAMIC";if(r.body.type!=undefined){x=r.body.type}var u=new p2.Body({mass:x=="STATIC"?0:1,fixedRotation:false,position:[r.x*2,r.y*2]});var k;var q=r.body.shapes.length;if(q!=0){for(l=0;l<q;l++){switch(r.body.shapes[l].type){case"CIRCLE":var t=new p2.Circle(r.body.shapes[l].radius*2);if(x=="STATIC"){t.collisionGroup=ZPhys.GRP_STATIC;t.material=ZPhys.Inst.staticMaterial}if(x=="DYNAMIC"){u.collisionGroup=ZPhys.GRP_DYNAMIC}t.collisionMask=ZPhys.COL_ALL;u.addShape(t);break;case"POLYGON":var v=r.body.shapes[l].localVerts;var g=[];for(k=0;k<v.length;k++){g.push([v[k].x*2,v[k].y*2])}var a=new p2.Convex(g);if(x=="STATIC"){a.collisionGroup=ZPhys.GRP_STATIC;a.material=ZPhys.Inst.staticMaterial}if(x=="DYNAMIC"){a.collisionGroup=ZPhys.GRP_DYNAMIC}a.collisionMask=ZPhys.COL_ALL;u.addShape(a);break}}}else{console.log("Warning. Body without shapes!")}ZPhys.Inst.world.addBody(u);u.mass=1;u.zobj=e;e.body=u}if(r.baseDim){e.baseDim.x=r.baseDim.x;e.baseDim.y=r.baseDim.y}if(!m){if(e.clipSrc!=null&&e.clipSrc!=""){var f=e.clipSrc.split(".");var s=e.clipSrc;if(f.length>=3){s=f[f.length-1]+".png"}if(e.cls=="goAir"){e.isClip=true;e.autoPlay=true;e.fps=30}if(e.isClip){var w=getTextures(f[f.length-1].replace(/[0-9]/g,""));if(w.length!=0){e.clip=new PIXI.MovieClip(w,30);e.clip.animationSpeed=0.3;if(e.fps){e.clip.animationSpeed=e.fps/60}e.clip.alignPivot();if(e.autoPlay){e.clip.gotoAndPlay(ZMath.rand(0,w.length-1))}ZLayers.Get("game").addChild(e.clip)}}else{if(PIXI.TextureCache[s]){e.clip=new PIXI.Sprite(PIXI.Texture.fromFrame(s));e.clip.alignPivot();ZLayers.Get("game").addChild(e.clip)}else{s="res/"+s;if(PIXI.TextureCache[s]){e.clip=new PIXI.Sprite(PIXI.Texture.fromFrame(s));e.clip.alignPivot();ZLayers.Get("game").addChild(e.clip)}}}}}if(e.clip){e.clip.zobj=e;if(r.scaleX!=undefined){e.clip.scale.x=r.scaleX}if(r.scaleY!=undefined){e.clip.scale.y=r.scaleY}}if(r.x!=undefined){e.x=r.x*2}if(r.y!=undefined){e.y=r.y*2}if(r.rotation!=undefined){e.rotation=r.rotation}if(r.density!=undefined){e.density=r.density}if(e.body){if(e.density!=undefined){e.body.setDensity(e.density)}if(r.scaleX!=undefined){if(r.scaleX!=1){if(e.body.shapes[0].type==p2.Shape.CIRCLE){e.body.shapes[0].radius*=r.scaleX}}}}ZObj.UpdatePositions();return e};ZObj.DeserializeArray=function(c){var b=[];for(var a=0;a<c.length;a++){c[a].creationIndex=a}c.sort(ZObj.SortFunc);for(var a=0;a<c.length;a++){b.push(ZObj.DeserializeZObj(c[a]))}return b};ZObj.UpdatePositions=function(){for(var a=0;a<ZObj.items.length;a++){ZObj.items[a].UpdatePosition()}};ZObj.SortFunc=function(d,c){if(d.layer==c.layer){if(d.creationIndex<c.creationIndex){return -1}else{return 1}}else{if(d.layer<c.layer){return -1}else{return 1}}};ZObj.FindObject=function(b){for(var a=0;a<ZObj.items.length;a++){if(ZObj.items[a].id==b){return ZObj.items[a]}}return null};PIXI.MovieClip.prototype.alignPivot=function(){this.anchor.x=0.5;this.anchor.y=0.5};PIXI.Sprite.prototype.alignPivot=function(){this.anchor.x=0.5;this.anchor.y=0.5};function getTimer(){return parseFloat(new Date().valueOf())/1000}ZLayers={items:{}};ZLayers.Get=function(a){return ZLayers.items[a]};ZLayers.AddLayer=function(b){if(ZLayers.Get(b)){return ZLayers.Get(b)}var a=new PIXI.DisplayObjectContainer();stage.addChild(a);ZLayers.items[b]=a;return a};ZMath={rand:function(b,a){return b+Math.floor(Math.random()*(a-b+1))},DEG_TO_RAD:1/360*Math.PI*2};ZUtils={};ZUtils.Remove=function(a){if(a==undefined){return}if(a==null){return}delete a.zobj;TweenMax.killTweensOf(a);TweenMax.killTweensOf(a.scale);TweenMax.killTweensOf(a.position);if(a.parent){a.parent.removeChild(a)}};ZUtils.BindSwipeEvent=function(c,d,a,b){c.touchstart=c.mousedown=function(e){c.initialPoint=e.getLocalPosition(this.parent)};c.touchend=c.mouseup=c.touchendoutside=function(g){var e=g.getLocalPosition(this.parent);var h=Math.abs(c.initialPoint.x-e.x);var f=Math.abs(c.initialPoint.y-e.y);if(h>20||f>20){if(h>f){if(a){if(e.x<c.initialPoint.x){d("left")}else{d("right")}}}else{if(b){if(e.y<c.initialPoint.y){d("up")}else{d("down")}}}}}};ZUtils.UnBindSwipeEvent=function(a){a.touchstart=null;a.touchend=null;a.touchendoutside=null;a.mouseup=null;a.mousedown=null};ZUtils.lzw_encode=function(d){var h={};var f=(d+"").split("");var b=[];var g;var a=f[0];var e=256;for(var c=1;c<f.length;c++){g=f[c];if(h[a+g]!=null){a+=g}else{b.push(a.length>1?h[a]:a.charCodeAt(0));h[a+g]=e;e++;a=g}}b.push(a.length>1?h[a]:a.charCodeAt(0));for(var c=0;c<b.length;c++){b[c]=String.fromCharCode(b[c])}return b.join("")};ZUtils.lzw_decode=function(k){var b={};var j=(k+"").split("");var d=j[0];var c=d;var g=[d];var a=256;var e;for(var h=1;h<j.length;h++){var f=j[h].charCodeAt(0);if(f<256){e=j[h]}else{e=b[f]?b[f]:(c+d)}g.push(e);d=e.charAt(0);b[a]=c+d;a++;c=e}return g.join("")};ZPhys=function(a){this.debug=new PIXI.Graphics();this.world=new p2.World({gravity:[0,9.82]});this.groundBody=new p2.Body();this.world.addBody(this.groundBody);this.staticMaterial=new p2.Material();ZPhys.Inst=this;return this};ZPhys.GRP_STATIC=Math.pow(2,0);ZPhys.GRP_DYNAMIC=Math.pow(2,1);ZPhys.GRP_SENSOR=Math.pow(2,2);ZPhys.COL_ALL=ZPhys.GRP_STATIC|ZPhys.GRP_DYNAMIC|ZPhys.GRP_SENSOR;ZPhys.prototype.RenderDebug=function(){var n=this;if(!n.world){return}var c=n.world.bodies;if(c.length==0){return}var e;var d;var o;n.debug.clear();for(e=0;e<c.length;e++){var m=Math.cos(c[e].angle);var g=Math.sin(c[e].angle);var b=c[e].shapes;for(o=0;o<b.length;o++){if(c[e].motionState==p2.Body.STATIC){n.debug.lineStyle(2,16711680)}else{n.debug.lineStyle(2,65280)}if(b[o].sensor==true){n.debug.lineStyle(2,16711935)}if(b[o].type==1){n.debug.drawCircle(c[e].position[0],c[e].position[1],b[o].radius)}else{if(b[o].type==p2.Shape.CONVEX){var l=b[o].vertices;var k=l[0][0]+c[e].shapeOffsets[o][0];var h=l[0][1]+c[e].shapeOffsets[o][1];var a=m*k-g*h;var f=g*k+m*h;n.debug.moveTo(a+c[e].position[0],f+c[e].position[1]);for(d=1;d<l.length;d++){k=l[d][0]+c[e].shapeOffsets[o][0];h=l[d][1]+c[e].shapeOffsets[o][1];a=m*k-g*h;f=g*k+m*h;n.debug.lineTo(a+c[e].position[0],f+c[e].position[1])}k=l[0][0]+c[e].shapeOffsets[o][0];h=l[0][1]+c[e].shapeOffsets[o][1];a=m*k-g*h;f=g*k+m*h;n.debug.lineTo(a+c[e].position[0],f+c[e].position[1])}}}}};ZPhys.prototype.Process=function(){if(!this.world){return}this.world.step(1/8);ZObj.UpdatePositions()};ZPhys.prototype.SetAsSensor=function(a){var c;for(c=0;c<a.shapes.length;c++){a.shapes[c].sensor=true;a.shapes[c].collisionGroup=ZPhys.GRP_SENSOR;a.shapes[c].collisionMask=ZPhys.COL_ALL}};ZPhys.prototype.CreateBox=function(a,g,c,e,b){var d=new p2.Rectangle(c,e),f=new p2.Body({mass:b==true?0:c*e,position:[a,g]});f.addShape(d);this.world.addBody(f);return f};ZPhys.prototype.CreateCircle=function(b,g,e,c,a){var f=new p2.Circle(e),d=new p2.Body({mass:c==true?0:1,position:[b,g]});if(c){f.collisionGroup=ZPhys.GRP_STATIC}else{f.collisionGroup=ZPhys.GRP_DYNAMIC}f.collisionMask=ZPhys.COL_ALL;d.addShape(f);if(!a){this.world.addBody(d)}return d};ZPhys.prototype.CreatePoly=function(d,b){var a=new p2.Convex(d),c=new p2.Body({mass:b==true?0:12,position:[0,0]});c.addShape(a);this.world.addBody(c);return c};ZPool=function(){this.objects={};ZPool.Inst=this;return this};ZPool.prototype.Fill=function(b,e,a){if(this.objects[b]==undefined){this.objects[b]=[]}for(var c=0;c<e;c++){var d=a();d.poolName=b;this.objects[b].push(d)}};ZPool.prototype.Pop=function(a){if(this.objects[a]==undefined){console.warn("Error: not found '"+a+"' in pool.");return undefined}if(this.objects[a].length==0){console.warn("Error: pool empty. Element '"+a+"'");return undefined}return this.objects[a].pop()};ZPool.prototype.Push=function(a){if(a.poolName==undefined){console.warn("Error: Can't push unnamed element in pool.");return}this.objects[a.poolName].push(a)};var ZTemplates={Items:{},Find:function(a){if(this.Items[a]==undefined){console.warn("Can't find template '"+a+"'");return}return this.Items[a]},Load:function(b){for(var a=0;a<b.length;a++){var c=JSON.parse(b[a].data);this.Items[b[a].label]=c.objects}}};var ZCTemplate=function(){ZObj.apply(this);this.template="";this.templateDim=vec2.create();this.baseDim=vec2.fromValues(64,64);this.templateDim=vec2.fromValues(64,64);this.PublicFields+="template,"};extend(ZCTemplate,ZObj);ZCTemplate.MAX_RECURSION=3;ZCTemplate.IsRecursionFirst=true;ZCTemplate.RecursionDepth=0;ZCTemplate.prototype.Initialize=function(){var d=ZCTemplate.IsRecursionFirst;if(ZCTemplate.IsRecursionFirst){ZCTemplate.RecursionDepth=0;ZCTemplate.IsRecursionFirst=false}ZCTemplate.RecursionDepth++;if(ZCTemplate.RecursionDepth>ZCTemplate.MAX_RECURSION){ZCTemplate.IsRecursionFirst=d;ZCTemplate.RecursionDepth--;this.Destroy();return}if(this.template==""){this.Destroy();return}var c=ZTemplates.Find(this.template);if(c!=undefined){var b=ZObj.items.length;var e=ZObj.DeserializeArray(c);for(var a=0;a<e.length;a++){e[a].x=this.x;e[a].y=this.y;if(e[a].body){e[a].body.position[0]=this.x;e[a].body.position[1]=this.y}e[a].Initialize()}}ZCTemplate.RecursionDepth--;ZCTemplate.IsRecursionFirst=d;this.Destroy()};ZCJoint=function(){ZObj.apply(this);this.breakOnForce=0;this.body1Id="";this.body2Id="";this.joint=null;this.motor=null;this.angleJoint=null;this.collideConnected=false;this.rate=0;this.angleConstraint=false;this.angleMin=0;this.angleMax=0;this.damping=0.1;this.frequency=10;this.isStopped=false;this.baseDim=vec2.fromValues(32,32);this.PublicFields+="body1Id,body2Id,collideConnected,breakOnForce,angleConstraint,angleMin,angleMax,frequency,damping,rate,isStopped,"};extend(ZCJoint,ZObj);ZCJoint.prototype.FindBodyByObjectId=function(f,e){var c;if(f.length==0){return}var d=f.length;for(c=0;c<d;c++){var a=f[c];if(a.zobj!=undefined){if((a.zobj.id==e)&&(a.zobj.body==a)){return a}}}return};ZCJoint.prototype.CreateMotor=function(){if(!this.joint){return}if(Math.abs(this.rate)>0.000001){this.joint.enableMotor();this.joint.setMotorSpeed(-this.rate*this.joint.bodyA.mass/20)}};ZCJoint.prototype.RemoveDuplicates=function(c){var b=[];for(var a=0;a<c.length;a++){if(b.indexOf(c[a])==-1){b.push(c[a])}}return b};ZCJoint.prototype.Initialize=function(){ZObj.prototype.Initialize.apply(this);var a=vec2.fromValues(this.x,this.y);var f=ZPhys.Inst.world.hitTest(a,ZPhys.Inst.world.bodies,0);f=this.RemoveDuplicates(f);var c;var b;var e=[0,0];var d=[0,0];if(f.length==1){c=f[0];if(this.body1Id!=""){c=this.FindBodyByObjectId(f,this.body1Id)}if(c!=null){if(c.motionState!=p2.Body.STATIC){b=ZPhys.Inst.groundBody;c.toLocalFrame(e,a);this.joint=new p2.RevoluteConstraint(c,e,b,a);c.angularDamping=0.99}}}else{if(f.length==2){c=f[0];b=f[1];if(this.body1Id!=""){c=this.FindBodyByObjectId(f,this.body1Id)}if(this.body2Id!=""){b=this.FindBodyByObjectId(f,this.body2Id)}if(c!=null&&b!=null){if(!((c.motionState==p2.Body.STATIC)&&(b.motionState==p2.Body.STATIC))){c.toLocalFrame(e,a);b.toLocalFrame(d,a);this.joint=new p2.RevoluteConstraint(c,e,b,d)}}}}if(this.joint!=undefined){this.joint.collideConnected=this.collideConnected;this.CreateMotor();ZPhys.Inst.world.addConstraint(this.joint)}c=null;b=null;this.Destroy()};var ZCTeleport=function(){ZObj.apply(this);this.linkedTo="";this.acceptClasses="";this.classes=[];this.dontTeleportObjs=[];this.target=null;this.PublicFields+="linkedTo,acceptClasses,"};extend(ZCTeleport,ZObj);ZCTeleport.prototype.Destroy=function(){this.dontTeleportObjs=null;this.classes=null;this.target=null;ZObj.prototype.Destroy.apply(this)};ZCTeleport.prototype.onTeleport=function(a){return true};ZCTeleport.prototype.Initialize=function(){var c;this.dontTeleportObjs=[];if(this.body){if(this.acceptClasses!=""){var a=this.acceptClasses.replace(" ","").split(",");var b=a.length;if(b!=0){this.classes=[];for(c=0;c<b;++c){this.classes.push(a[c].toLowerCase())}}}ZPhys.Inst.SetAsSensor(this.body)}if(this.linkedTo!=""){this.target=ZObj.FindObject(this.linkedTo)}ZObj.prototype.Initialize.apply(this)};ZCTeleport.prototype.SensorEnd=function(c){var a=this.dontTeleportObjs.indexOf(c);if(a!=-1){this.dontTeleportObjs.splice(a,1)}};ZCTeleport.prototype.SensorBegin=function(a){if(this.dontTeleportObjs.indexOf(a)!=-1){return}if(this.classes&&a.zobj){if(this.classes.length!=0){var d;var c=this.classes.length;for(d=0;d<c;++d){if(this.classes[d]){if(a.zobj.cls.toLowerCase().indexOf(this.classes[d])!=-1){break}}}if(d==c){return}}}if(this.target){if(!this.target.isDestroyed){if(this.target.dontTeleportObjs){this.target.dontTeleportObjs.push(a)}if(this.onTeleport(a)){a.position[0]=this.target.x;a.position[1]=this.target.y}}}};var ZButton=function(b,a){PIXI.Sprite.apply(this,arguments);this.alignPivot();this.onClick=a;this.setInteractive(true);this.mousedown=ZButton._mouseDown;this.touchstart=ZButton._mouseDown;this.mouseup=ZButton._mouseUp;this.touchend=ZButton._mouseUp};extend(ZButton,PIXI.Sprite);ZButton.prevent=false;ZButton._mouseDown=function(a){if(a.target.constructor==ZButton){if(a.target.onClick){a.target.onClick(a)}a.target.scale.x=0.9;a.target.scale.y=0.9;ZButton.prevent=true}};ZButton._mouseUp=function(a){a.prevent=true;if(a.target.constructor==ZButton){a.target.scale.x=1;a.target.scale.y=1;a.originalEvent.stopPropagation();ZButton.prevent=false}};var ZGame=function(){this.oldState=0;this.state=0};ZGame.STATE_NONE=0;ZGame.STATE_GAME=1;ZGame.STATE_WIN=2;ZGame.STATE_DIED=3;ZGame.prototype.ChangeState=function(a){if(this.state==a){return}this.oldState=this.state;this.state=a;switch(this.state){case ZGame.STATE_GAME:this.OnGame();break;case ZGame.STATE_WIN:this.OnWin();break;case ZGame.STATE_DIED:this.OnDie();break}};ZGame.prototype.OnGame=function(){};ZGame.prototype.OnWin=function(){};ZGame.prototype.OnDie=function(){};var ZStorage={};ZStorage.IsSupported=function(){try{return"localStorage" in window&&window.localStorage!==null}catch(a){return false}};ZStorage.Set=function(a,c){if(!ZStorage.IsSupported()){console.error("Local storage is not supported!");return}try{if(c==null){delete window.localStorage[a]}else{window.localStorage[a]=c}}catch(b){console.error(b)}};ZStorage.Get=function(a){if(!ZStorage.IsSupported()){console.error("Local storage is not supported!");return}var b=undefined;try{b=window.localStorage[a]}catch(c){console.error(c);b=null}return b};ZStorage.SetLevelScore=function(a,b){ZStorage.Set("lvs"+a,b)};ZStorage.GetLevelScore=function(a){var b=ZStorage.Get("lvs"+a);if(b==undefined){b=0}return parseInt(b)};ZStorage.SetLevelEnabled=function(b,a){if(a==false){ZStorage.Set("lve"+b,null)}else{ZStorage.Set("lve"+b,a)}};ZStorage.IsLevelEnabled=function(a){var b=ZStorage.Get("lve"+a);if(b==undefined){b=false}return b};ZStorage.GetTotalScore=function(a){var b;var c=0;for(b=0;b<a;b++){c+=ZStorage.GetLevelScore(b+1)}return c};var ZSound={available:false};ZSound.Init=function(b){this.available=createjs.Sound.initializeDefaultPlugins();if(!this.available){return}var a="res/snd/";createjs.Sound.alternateExtensions=["mp3"];createjs.Sound.registerManifest(b,"res/snd/")};ZSound.Play=function(a){if(!this.available){return}try{createjs.Sound.play(a,createjs.Sound.INTERRUPT_NONE,0,0,false,1)}catch(b){}};var Game=function(){ZGame.apply(this)};extend(Game,ZGame);Game.prototype.OnGame=function(){hud.TotalGoal=goCandy.Total;hud.goal=0;hud.score=1000;hud.Show();winScr.Hide();hud.toolbox.Init(hud.balls)};Game.prototype.OnWin=function(){var a=ZStorage.GetLevelScore(LevelManager.curLevel);if(hud.score>a){ZStorage.SetLevelScore(LevelManager.curLevel,hud.score)}ZStorage.SetLevelEnabled(LevelManager.curLevel+1,true);winScr.Show()};Game.prototype.OnDie=function(){game.ChangeState(ZGame.STATE_NONE);LevelManager.LoadLevel(LevelManager.curLevel)};Game.prototype.Process=function(){hud.toolbox.Process();if(this.state==ZGame.STATE_WIN){winScr.Process()}};function InitializeContacts(){ZPhys.Inst.world.on("beginContact",BeginContact);ZPhys.Inst.world.on("endContact",EndContact)}function BeginContact(c){var b=c.bodyA;var a=c.bodyB;CheckBeginContact(b,a);CheckBeginContact(a,b)}function EndContact(c){var b=c.bodyA;var a=c.bodyB;CheckEndContact(b,a);CheckEndContact(a,b)}function CheckBeginContact(b,a){if(b.zobj&&a.zobj){if(b.zobj.constructor==goTeleport){b.zobj.SensorBegin(a)}if(a.zobj.constructor==goBoy){if(b.shapes[0].sensor){a.zobj.onSensor(b)}if(b.zobj.constructor==goAir){b.zobj.StartCollide(a)}}}}function CheckEndContact(b,a){if(b.zobj&&a.zobj){if(b.zobj.constructor==goTeleport){b.zobj.SensorEnd(a)}if(a.zobj.constructor==goBoy){if(b.zobj.constructor==goAir){b.zobj.EndCollide(a)}}}}var LevelManager={LevelPath:"res/lvl/",Levels:{},curLevel:8,bgCont:null,bg:null,bgTex:null};LevelManager.Init=function(){this.bgTex=new PIXI.RenderTexture(SCR_WIDTH,SCR_HEIGHT);this.bgCont=new PIXI.DisplayObjectContainer();this.bg=new PIXI.Sprite(this.bgTex)};LevelManager.Clear=function(){ZUtils.Remove(this.bg);goCandy.Total=0;hud.balls=[];hud.score=0;hud.UpdateScoreText();ZPhys.Inst.world.clear();ZPhys.Inst.world.gravity=[0,9.82];ZObj.DestroyAll();Particles.Clear();phys.world.addContactMaterial(new p2.ContactMaterial(phys.staticMaterial,goBoy.material,{friction:1,restitution:0}));phys.world.addContactMaterial(new p2.ContactMaterial(goBoy.material,goBoy.material,{friction:1,restitution:0}))};LevelManager.LoadLevel=function(b){var d=this;var a=d.LevelPath+"level"+b+".json";if(b==-1){a=d.LevelPath+"menu.json"}if(d.Levels[a]!=undefined){console.log("Loading level: "+a);LevelManager.Clear();ZObj.DeserializeArray(d.Levels[a].objects);var c=[];ZObj.InitializeAll();LevelManager.PrecacheBackground();game.ChangeState(ZGame.STATE_GAME);if(b==-1){hud.Hide()}}};LevelManager.PrecacheBackground=function(){var d=0;var c=ZLayers.Get("game");while(this.bgCont.children.length!=0){ZUtils.Remove(this.bgCont.children[0])}while(d<c.children.length){var b=false;var a=c.children[d];if(a.zobj){if(!a.zobj.body){b=true}if(a.zobj.body){if(a.zobj.body.motionState==p2.Body.STATIC){if((a.zobj.constructor!=goTeleport)&&(a.zobj.constructor!=goStar)&&(a.zobj.constructor!=goCandy)&&(a.zobj.constructor!=goAir)&&(a.zobj.constructor!=goBoy)&&(a.zobj.constructor!=goBonus)){b=true}}}if(b){this.bgCont.addChild(a);continue}}d++}this.bgTex.render(this.bgCont);while(this.bgCont.children.length!=0){ZUtils.Remove(this.bgCont.children[0])}ZLayers.Get("bg").addChild(this.bg)};Particles={};Particles.AddStars=function(a,f){var d;var c;var e;for(var b=0;b<5;b++){d=ZPool.Inst.Pop("star");d.alignPivot();d.scale.x=1;d.scale.y=1;d.x=a;d.y=f;d.rotation=Math.random()*3.14*2;ZLayers.Get("particles").addChild(d);TweenMax.to(d,1,{x:d.x+ZMath.rand(-100,100),y:d.y+ZMath.rand(-100,100),rotation:Math.random()*3.14*2});TweenMax.to(d.scale,0.8,{delay:0.2,x:0,y:0,onCompleteParams:[d],onComplete:Particles.Remove})}};Particles.AddBeam=function(a,h,c,b,e){var f;var d;var g;f=ZPool.Inst.Pop("pixelWhite");if(f){f.alignPivot();f.alpha=1;f.x=a+ZMath.rand(-24,24)-c*28;f.y=h+ZMath.rand(-24,24)-b*28;f.rotation=e;f.scale.x=20;f.scale.y=2;ZLayers.Get("particles").addChild(f);TweenMax.to(f,1,{alpha:0,y:f.y-b*360,x:f.x-c*360,onCompleteParams:[f],onComplete:function(i){TweenMax.killTweensOf(i);ZUtils.Remove(i);ZPool.Inst.Push(i)}})}};Particles.Remove=function(a){TweenMax.killTweensOf(a);TweenMax.killTweensOf(a.scale);TweenMax.killTweensOf(a.position);ZUtils.Remove(a);ZPool.Inst.Push(a)};Particles.Clear=function(){var a=ZLayers.Get("particles");while(a.children.length!=0){TweenMax.killTweensOf(a.children[0]);TweenMax.killTweensOf(a.children[0].scale);ZPool.Inst.Push(a.children[0]);ZUtils.Remove(a.children[0])}};var goStar=function(){ZObj.apply(this);this.isCollected=false;this.randOffset=Math.random();return this};extend(goStar,ZObj);goStar.prototype.Initialize=function(){ZObj.prototype.Initialize.apply(this);this.body.motionState==p2.Body.STATIC;ZPhys.Inst.SetAsSensor(this.body)};goStar.prototype.Collect=function(){if(this.isCollected){return}this.isCollected=true;ZSound.Play("coin"+ZMath.rand(1,3).toString());Particles.AddStars(this.x,this.y);hud.AddScore(300);this.Destroy()};goStar.prototype.Process=function(){if(!this.isCollected){this.clip.position.y=this.y+Math.cos((getTimer()+this.randOffset)*4)*4}};var goCandy=function(){ZObj.apply(this);this.isCollected=false;this.type=0;this.randOffset=Math.random();this.particles=[];this.cnt=5;goCandy.Total++};extend(goCandy,ZObj);goCandy.Total=0;goCandy.material=new p2.Material();goCandy.prototype.Destroy=function(){var a;for(a=0;a<this.cnt;a++){this.particles[a].Destroy()}this.particles=[];ZObj.prototype.Destroy.apply(this)};goCandy.prototype.Initialize=function(){this.type=this.clipSrc.substr(this.clipSrc.length-1,1);this.body.motionState==p2.Body.STATIC;ZPhys.Inst.SetAsSensor(this.body);var a;for(a=0;a<this.cnt;a++){var b=new goCandyParticle();ZObj.items.splice(ZObj.items.length-1,1);b.x=this.x;b.y=this.y;b.dx=(Math.random()-Math.random())*4;b.dy=-3-Math.random()*2;this.particles.push(b);this.particles[a].clip=new PIXI.Sprite(PIXI.Texture.fromFrame("target"+this.type+".png"));this.particles[a].clipSrc=this.clipSrc;this.particles[a].clip.scale.x=0.5;this.particles[a].clip.scale.y=0.5;this.particles[a].clip.alignPivot();this.particles[a].clip.visible=false}ZObj.prototype.Initialize.apply(this)};goCandy.prototype.Process=function(){if(this.isCollected){return}this.clip.y=this.clip.y-Math.cos((getTimer()+this.randOffset)*2)/2;ZObj.prototype.Process.apply(this)};goCandy.prototype.Collect=function(){if(this.isCollected){return}this.isCollected=true;ZPhys.Inst.world.removeBody(this.body);ZSound.Play("yum"+ZMath.rand(1,3).toString());var a;for(a=0;a<this.cnt;a++){this.particles[a].x=this.x;this.particles[a].y=this.y;this.particles[a].clip.visible=true;ZObj.items.push(this.particles[a]);ZLayers.Get("game").addChild(this.particles[a].clip)}ZSound.Play("collect"+ZMath.rand(1,3).toString());TweenMax.to(this.clip,0.5,{y:this.clip.y-40,rotation:-2});TweenMax.to(this.clip.scale,0.5,{x:0,y:0});hud.AddScore();hud.goal+=1};var goCandyParticle=function(){ZObj.apply(this);this.dx=0;this.dy=0};extend(goCandyParticle,ZObj);goCandyParticle.prototype.Process=function(){ZObj.prototype.Process.apply(this);this.x+=this.dx;this.y+=this.dy;this.dy+=0.1;this.dx*=0.99;if(this.y>SCR_HEIGHT+32){this.Destroy()}};var goAir=function(){ZObj.apply(this);this.dx=0;this.dy=0;this.force=1;this.prevTime=0;this.colliders=[];this.PublicFields+="force,";this.isClip=true;this.clipSrc="obj.png.ven01";this.autoPlay=true;this.fps=10};extend(goAir,ZObj);goAir.prototype.Initialize=function(){this.body=new p2.Body({mass:0,position:[this.x,this.y]});this.body.zobj=this;var a=new p2.Rectangle(400,72);this.body.addShape(a,[-200,0]);ZPhys.Inst.SetAsSensor(this.body);this.body.angle=this.clip.rotation;ZPhys.Inst.world.addBody(this.body);this.dx=Math.cos(this.clip.rotation);this.dy=Math.sin(this.clip.rotation);this.clip.scale.x=1;this.clip.scale.y=0.8;TweenMax.to(this.clip.scale,0.3,{x:0.8,y:1,yoyo:true,repeat:-1});ZObj.prototype.Initialize.apply(this)};goAir.prototype.Destroy=function(){TweenMax.killTweensOf(this.clip.scale);ZObj.prototype.Destroy.apply(this)};goAir.prototype.StartCollide=function(a){if(!a){return}if(a.motionState==p2.Body.DYNAMIC){if(this.colliders.indexOf(a)==-1){this.colliders.push(a)}}};goAir.prototype.EndCollide=function(c){if(!c){return}if(c.motionState==p2.Body.DYNAMIC){var a=this.colliders.indexOf(c);if(a!=-1){this.colliders.splice(a,1)}}};goAir.prototype.Process=function(){if(game.state!=ZGame.STATE_GAME){return}var b;for(b=0;b<this.colliders.length;b++){this.colliders[b].applyForce([-this.dx*this.colliders[b].mass*15,-this.dy*this.colliders[b].mass*15],this.colliders[b].position)}var a=getTimer();if(a-this.prevTime>0.1){this.prevTime=a;Particles.AddBeam(this.x,this.y,this.dx,this.dy,this.clip.rotation)}};var goBonus=function(){ZObj.apply(this);this.isCollected=false;this.isClip=true;this.autoplay=true;this.fps=30};extend(goBonus,ZObj);goBonus.prototype.Initialize=function(){this.body.motionState==p2.Body.STATIC;ZPhys.Inst.SetAsSensor(this.body);ZObj.prototype.Initialize.apply(this)};goBonus.prototype.Collect=function(a){if(this.isCollected){return}if(this.clipSrc.toLowerCase().indexOf("grav")!=-1){ZSound.Play("pop"+ZMath.rand(1,2).toString());a.ShowBubble();a.body.gravityScale*=-1}else{if(this.clipSrc.toLowerCase().indexOf("sizeup")!=-1){ZSound.Play("pop"+ZMath.rand(1,2).toString());a.body.shapes[0].radius*=1.4;a.clip.scale.x*=1.4;a.clip.scale.y*=1.4}else{if(this.clipSrc.toLowerCase().indexOf("sizedown")!=-1){ZSound.Play("pop"+ZMath.rand(1,2).toString());a.body.shapes[0].radius*=0.6;a.clip.scale.x*=0.6;a.clip.scale.y*=0.6}else{if(this.clipSrc.toLowerCase().indexOf("speed")!=-1){ZSound.Play("pop3");a.isSpeedup=true;a.startSpeedTime=getTimer()}}}}this.isCollected=true;this.Destroy()};var goSpike=function(){ZObj.apply(this)};extend(goSpike,ZObj);goSpike.prototype.Initialize=function(){ZPhys.Inst.SetAsSensor(this.body)};var goBoy=function(){ZObj.apply(this);this.type=-1;this.isSpeedup=false;this.prevTime=0;this.startSpeedTime=0;this.isDied=false;this.bubble=null;this.prevBubbleTime=0};extend(goBoy,ZObj);goBoy.material=new p2.Material();goBoy.prototype.Initialize=function(){this.type=parseInt(this.clipSrc.substr(this.clipSrc.length-1,1));hud.balls.push(this);this.body.shapes[0].material=goBoy.material;this.body.setDensity(1);this.body.mass=8000;this.body.damping=0;this.body.angularDamping=0;ZPhys.Inst.world.removeBody(this.body);this.bubble=new PIXI.Sprite(PIXI.Texture.fromFrame("bubble.png"));this.bubble.alignPivot();ZObj.prototype.Initialize.apply(this)};goBoy.prototype.Destroy=function(){if(this.bubble){TweenMax.killTweensOf(this.bubble);TweenMax.killTweensOf(this.bubble.scale);ZUtils.Remove(this.bubble)}ZObj.prototype.Destroy.apply(this)};goBoy.prototype.ShowBubble=function(){if(this.bubble.parent){this.bubble.parent.removeChild(this.bubble);return}this.bubble.position.x=this.clip.x;this.bubble.position.y=this.clip.y;this.bubble.scale.x=0;this.bubble.scale.y=0;TweenMax.to(this.bubble.scale,1,{x:this.clip.scale.x,y:this.clip.scale.y,ease:Elastic.easeOut});this.clip.parent.addChildAt(this.bubble,this.clip.parent.children.indexOf(this.clip)+1)};goBoy.prototype.onSensor=function(a){if(this.isDied){return}if(!a.zobj){return}if(a.zobj.constructor==goCandy){if(a.zobj.type==this.type){a.zobj.Collect()}}else{if(a.zobj.constructor==goBonus){a.zobj.Collect(this)}else{if(a.zobj.constructor==goStar){a.zobj.Collect()}else{if(a.zobj.constructor==goSpike&&this.type!=5){this.isDied=true;ZPhys.Inst.world.removeBody(this.body);this.clip.alpha=0.5;var c=(SCR_HEIGHT+this.clip.height-this.clip.position.y)/SCR_HEIGHT*1.5;TweenMax.to(this.clip,c*1.5,{rotation:this.clip.rotation+Math.PI*2,ease:Linear.easeNone});TweenMax.to(this.clip.position,c*1.5,{y:2*SCR_HEIGHT+this.clip.height+400,onComplete:this.EndDie,ease:Back.easeIn})}}}}};goBoy.prototype.EndDie=function(){game.ChangeState(ZGame.STATE_DIED)};goBoy.prototype.Process=function(){var a=getTimer();if(this.bubble.parent!=null){if(a-this.prevBubbleTime>0.1){this.prevBubbleTime=a}this.bubble.x=this.clip.x;this.bubble.y=this.clip.y}if(this.isDied){return}if(this.isSpeedup){if(this.body.velocity.length!=0){this.body.applyForce([this.body.velocity[0]*this.body.mass/4,this.body.velocity[1]*this.body.mass/4],this.body.position);this.body.damping=1}if(a-this.startSpeedTime>2){this.isSpeedup=false}else{if(a-this.prevTime>0.05){this.prevTime=a}}}ZObj.prototype.Process.apply(this)};var goTeleport=function(){ZCTeleport.apply(this);this.flare=null;this.prevTime=0};extend(goTeleport,ZCTeleport);goTeleport.prototype.Initialize=function(){ZPhys.Inst.SetAsSensor(this.body);this.body.mass=0;this.flare=new PIXI.Sprite(PIXI.Texture.fromFrame("flare.png"));this.flare.alignPivot();this.flare.position.x=this.x;this.flare.position.y=this.y;this.flare.alpha=0.7;this.flare.rotation=Math.random()*Math.PI*2;TweenMax.to(this.flare,10,{rotation:this.flare.rotation+Math.PI*2,repeat:-1,ease:Linear.easeNone});ZLayers.Get("fg").addChild(this.flare);ZCTeleport.prototype.Initialize.apply(this)};goTeleport.prototype.Destroy=function(){ZUtils.Remove(this.flare);ZCTeleport.prototype.Destroy.apply(this)};goTeleport.prototype.Process=function(){if(this.flare&&this.clip){this.flare.position.x=this.clip.position.x;this.flare.position.y=this.clip.position.y}ZObj.prototype.Process.apply(this)};goTeleport.prototype.onTeleport=function(a){if(a.zobj){if(a.zobj.clip){if(a.zobj.clip.constructor=PIXI.Sprite&&a.zobj.clipSrc!=""){ZSound.Play("teleport");var e=a.zobj.clip.scale.x;var d=a.zobj.clip.scale.y;a.zobj.clip.scale.x=0;a.zobj.clip.scale.y=0;var c=ZPool.Inst.Pop(a.zobj.clipSrc);if(c){c.alignPivot();c.alpha=1;c.x=a.zobj.clip.x;c.y=a.zobj.clip.y;c.scale.x=e;c.scale.y=d;c.rotation=a.zobj.clip.rotation;ZLayers.Get("particles").addChild(c);TweenMax.to(c.scale,0.3,{x:0,y:0});TweenMax.to(c.position,0.3,{x:this.clip.x,y:this.clip.y,onComplete:Particles.Remove,onCompleteParams:[c]})}TweenMax.to(a.zobj.clip.scale,0.3,{x:e,y:d});return true}}}return false};var GameToolbox=function(){this.curBall=-1;this.canPlace=false;this.bl=[];this.followX=0;this.followY=0;this.oy=-48;this.ballMoved=false;this.firstChange=true;this.collidedBodies=0};GameToolbox.prototype.Init=function(d){this.sensor=ZPhys.Inst.CreateCircle(100,100,40,true);ZPhys.Inst.SetAsSensor(this.sensor);this.sensor.motionState=p2.Body.KINEMATIC;ZPhys.Inst.world.addBody(this.sensor);this.curBall=-1;this.ballMoved=false;if(d.length==0){return}var c;var b;var a=hud.panel.x+20;for(c=0;c<d.length;c++){b=d[c].clip;b.scale.x=0.8;b.scale.y=0.8;a+=b.width/2;b.position.x=a;a+=b.width/2;b.position.y=32;ZLayers.Get("ui").addChild(b)}this.GetNext()};GameToolbox.prototype.GetNext=function(){this.curBall++;this.ballMoved=false;if(this.curBall>hud.balls.length-1){this.curBall=-1;return}var a=hud.balls[this.curBall];a.clip.x=hud.panel.x+20+a.clip.width/2;a.clip.scale.x=1;a.clip.scale.y=1;this.followX=a.clip.position.x;this.followY=a.clip.position.y;this.firstChange=true;ZLayers.Get("ui").addChild(a.clip);TweenMax.to(a.clip.scale,0.3,{x:1.2,y:1.2,yoyo:true,repeat:-1})};GameToolbox.prototype.Process=function(){if(this.curBall!=-1&&this.ballMoved){var g=hud.balls[this.curBall];if(this.sensor){this.sensor.position[0]=this.followX;this.sensor.position[1]=this.followY}g.clip.position.x=this.followX;g.clip.position.y=this.followY;this.canPlace=true;g.clip.alpha=1;var e=true;for(var d=0;d<ZPhys.Inst.world.bodies.length;d++){if(ZPhys.Inst.world.bodies[d]!=hud.toolbox.sensor){if(ZPhys.Inst.world.bodies[d].shapes[0].sensor!=true){if(ZPhys.Inst.world.broadphase.boundingVolumeCheck(hud.toolbox.sensor,ZPhys.Inst.world.bodies[d])){for(var b=0;b<360;b+=40){var f=ZPhys.Inst.world.hitTest([hud.toolbox.sensor.position[0]+Math.cos(b*ZMath.DEG_TO_RAD)*hud.toolbox.sensor.shapes[0].radius,hud.toolbox.sensor.position[1]+Math.sin(b*ZMath.DEG_TO_RAD)*hud.toolbox.sensor.shapes[0].radius],ZPhys.Inst.world.bodies,0);var c=0;while(c<f.length){if(f[c]==hud.toolbox.sensor){f.splice(c,1)}else{if(f[c].shapes[0].sensor==true){f.splice(c,1)}else{c++}}}if(f.length!=0){e=false;break}}if(e){break}}}}}if(!e){this.canPlace=false}if(this.firstChange){TweenMax.killTweensOf(g.clip.scale);this.firstChange=false;g.clip.scale.x=1;g.clip.scale.y=1;TweenMax.to(g.clip.scale,0.3,{x:1.2,y:1.2,yoyo:true,repeat:-1})}if(this.canPlace){g.clip.alpha=1}else{g.clip.alpha=0.6}}};GameToolbox.prototype.UpdateState=function(){if(this.curBall!=-1&&this.ballMoved){var a=hud.balls[this.curBall];if(this.collidedBodies==0){a.clip.alpha=1;a.clip.color=16777215}else{a.clip.alpha=0.5;a.clip.color=16711680}}};GameToolbox.prototype.Place=function(){if(this.curBall==-1){return}if(!this.canPlace){return}var a=hud.balls[this.curBall];TweenMax.killTweensOf(a.clip);TweenMax.killTweensOf(a.clip.position);TweenMax.killTweensOf(a.clip.scale);a.clip.scale.x=1;a.clip.scale.y=1;a.body.position[0]=this.followX;a.body.position[1]=this.followY;ZPhys.Inst.world.addBody(a.body);ZLayers.Get("game").addChild(a.clip);ZSound.Play("place");this.MoveBalls();this.GetNext()};GameToolbox.prototype.MoveBalls=function(){if(this.ballMoved){return}if(this.curBall<=hud.balls.length-2){var b=hud.panel.x+20;var a;for(var c=this.curBall+1;c<hud.balls.length;c++){a=hud.balls[c].clip;b+=a.width/2;TweenMax.killTweensOf(a.position);TweenMax.to(a.position,1,{delay:0.01*c,x:b});b+=a.width/2}}};var menuScreen=function(){this.clip=new PIXI.DisplayObjectContainer();this.btnPlay=new ZButton(PIXI.Texture.fromFrame("menu_play.png"),this.onPlayClick);this.btnPlay.x=Math.round(SCR_WIDTH/2);this.btnPlay.y=Math.round(SCR_HEIGHT/2)+30;this.clip.addChild(this.btnPlay);this.title=new PIXI.Sprite(PIXI.Texture.fromFrame("title.png"));this.title.alignPivot();this.title.position.x=SCR_WIDTH/2;this.title.position.y=this.title.height/2;this.clip.addChild(this.title);this.btnMute=new PIXI.MovieClip(getTextures("snd"),1);this.btnMute.stop();this.btnMute.position.x=SCR_WIDTH-this.btnMute.width-4;this.btnMute.position.y=2;this.clip.addChild(this.btnMute)};menuScreen.prototype.Show=function(){if(this.clip.parent!=null){return}ZLayers.Get("ui").addChild(this.clip);game.ChangeState(ZGame.STATE_NONE);LevelManager.LoadLevel(-1)};menuScreen.prototype.Hide=function(){if(this.clip.parent==null){return}ZUtils.Remove(this.clip)};menuScreen.prototype.onPlayClick=function(){LevelManager.Clear();menu.Hide();lvlScr.Show()};var hudScreen=function(){var a=28;this.clip=new PIXI.DisplayObjectContainer();this._goal=0;this.TotalGoal=0;this.toolbox=new GameToolbox();this.score=0;this.prevScoreTime=0;this.balls=[];this.panel=new PIXI.Sprite(PIXI.Texture.fromFrame("pnl.png"));this.panel.position.x=SCR_WIDTH-this.panel.width;this.panel.y=-20;this.clip.addChild(this.panel);this.btnReset=new ZButton(PIXI.Texture.fromFrame("menu_replay.png"),this.Reset);this.btnReset.position.x=Math.round(SCR_WIDTH-this.btnReset.width/2);this.btnReset.position.y=Math.round(SCR_HEIGHT-this.btnReset.height/2);this.clip.addChild(this.btnReset);this.btnMenu=new ZButton(PIXI.Texture.fromFrame("menu_home.png"),this.onMenuTouch);this.btnMenu.x=Math.round(this.btnMenu.width/2)-4;this.btnMenu.y=Math.round(SCR_HEIGHT-this.btnMenu.height/2)+4;this.clip.addChild(this.btnMenu);this.lblScore=new PIXI.BitmapText("Score:",{font:a+"px fnt",align:"left"});this.lblScore.y=-14;this.clip.addChild(this.lblScore);this.txtScore=new PIXI.BitmapText("0000",{font:"fnt",align:"left"});this.txtScore.x=140;this.txtScore.y=-12;this.clip.addChild(this.txtScore);this.txtGoal=new PIXI.BitmapText("",{font:a+"px fnt",align:"right"});this.txtGoal.x=this.panel.x-90;this.txtGoal.y=-12;this.clip.addChild(this.txtGoal);this.__defineGetter__("goal",function(){return this._goal});this.__defineSetter__("goal",function(b){this._goal=b;this.UpdateGoalText();if(this.goal==this.TotalGoal&&this.TotalGoal!=0){TweenMax.killDelayedCallsTo(hud.ChangeToWinState);TweenMax.delayedCall(2,hud.ChangeToWinState)}return true})};hudScreen.prototype.Reset=function(){game.ChangeState(ZGame.STATE_NONE);TweenMax.killDelayedCallsTo(hud.ChangeToWinState);LevelManager.LoadLevel(LevelManager.curLevel)};hudScreen.prototype.Show=function(){if(this.clip.parent!=null){return}ZLayers.Get("ui").addChild(this.clip)};hudScreen.prototype.Hide=function(){if(this.clip.parent==null){return}for(var a=0;a<this.balls.length;a++){ZUtils.Remove(this.balls[a].clip)}ZUtils.Remove(this.clip)};hudScreen.prototype.UpdateGoalText=function(){this.txtGoal.setText(this.goal.toString()+"/"+this.TotalGoal.toString());this.txtGoal.scale.x=1.3;this.txtGoal.scale.y=1.3;TweenMax.to(this.txtGoal.scale,0.2,{x:1,y:1});this.txtGoal.fontSize=640/SCR_HEIGHT*SCR_SCALE*28};hudScreen.prototype.ChangeToWinState=function(){game.ChangeState(ZGame.STATE_WIN)};hudScreen.prototype.onMove=function(a){if(game.state!=ZGame.STATE_GAME){return}if(this.toolbox.curBall!=-1){this.toolbox.MoveBalls();this.toolbox.ballMoved=true;this.toolbox.followX=a.global.x/SCR_SCALE;this.toolbox.followY=a.global.y/SCR_SCALE}};hudScreen.prototype.onTouch=function(a){if(game.state!=ZGame.STATE_GAME){return}if(this.toolbox.curBall!=-1){this.toolbox.MoveBalls();this.toolbox.ballMoved=true;this.toolbox.followX=a.global.x/SCR_SCALE;this.toolbox.followY=a.global.y/SCR_SCALE;this.toolbox.Place()}};hudScreen.prototype.AddScore=function(a){if(a==undefined){this.score+=250}else{this.score+=a}this.UpdateScoreText()};hudScreen.prototype.UpdateScoreText=function(){this.txtScore.setText(this.score.toString());this.txtScore.fontSize=640/SCR_HEIGHT*SCR_SCALE*28};hudScreen.prototype.Process=function(){if(game.state==ZGame.STATE_GAME){var a=getTimer();if(a-this.prevScoreTime>=1){this.prevScoreTime=a;this.score-=1;if(this.score<0){this.score=0}this.UpdateScoreText()}}};hudScreen.prototype.onMenuTouch=function(){menu.Show()};var winScreen=function(){var a=28;this.toScore=0;this.sc=0;this.prevExpTime=0;this.state=0;this.clip=new PIXI.DisplayObjectContainer();this.pnl=new PIXI.Sprite(PIXI.Texture.fromFrame("res/bg002.jpg"));this.clip.addChild(this.pnl);this.btnNext=new ZButton(PIXI.Texture.fromFrame("menu_play.png"),this.onNextClick);this.btnNext.x=Math.round(this.pnl.width/2);this.btnNext.y=Math.round(this.pnl.height/2+30);this.clip.addChild(this.btnNext);this.lblWin=new PIXI.BitmapText("Level complete!",{font:a+"px fnt",align:"right"});this.lblWin.scale.x=2;this.lblWin.scale.y=2;this.lblWin.position.x=190;this.lblWin.position.y=0;this.clip.addChild(this.lblWin);this.lblScore=new PIXI.BitmapText("Score:",{font:a+"px fnt",align:"right"});this.lblTotalScore=new PIXI.BitmapText("Total:",{font:a+"px fnt",align:"right"});this.lblScore.x=Math.round(this.pnl.width/2-120);this.lblScore.y=130;this.lblTotalScore.position.x=this.lblScore.x;this.lblTotalScore.position.y=this.lblScore.position.y+48;this.clip.addChild(this.lblScore);this.clip.addChild(this.lblTotalScore);this.txtScore=new PIXI.BitmapText("0000",{font:a+"px fnt",align:"left"});this.txtTotalScore=new PIXI.BitmapText("0000",{font:a+"px fnt",align:"left"});this.txtScore.position.x=this.lblTotalScore.position.x+140;this.txtScore.position.y=this.lblScore.position.y;this.txtTotalScore.position.x=this.lblTotalScore.position.x+140;this.txtTotalScore.position.y=this.lblTotalScore.position.y;this.clip.addChild(this.txtScore);this.clip.addChild(this.txtTotalScore)};winScreen.prototype.Hide=function(){if(this.clip.parent==null){return}ZUtils.Remove(this.clip)};winScreen.prototype.Show=function(){if(this.clip.parent!=null){return}ZLayers.Get("fg").addChild(this.clip);ZSound.Play("count");this.prevExpTime=getTimer();this.btnNext.visible=false;hud.Hide();this.toScore=hud.score;this.sc=0;this.txtTotalScore.setText(ZStorage.GetTotalScore(30).toString());this.txtTotalScore.fontSize=640/SCR_HEIGHT*SCR_SCALE*28;TweenMax.to(this,3,{sc:this.toScore,onUpdate:this.UpdateScoreText,ease:Linear.easeNone,onComplete:this.ShowNextButton});this.txtTotalScore.scale.x=0;this.txtTotalScore.scale.y=0;TweenMax.to(this.txtTotalScore.scale,0.5,{delay:3,x:1,y:1,ease:Elastic.easeOut});this.clip.position.y=-SCR_HEIGHT;TweenMax.to(this.clip.position,1,{y:0,ease:Elastic.easeOut})};winScreen.prototype.ShowNextButton=function(){winScr.btnNext.scale.x=0;winScr.btnNext.scale.y=0;winScr.btnNext.visible=true;TweenMax.to(winScr.btnNext.scale,0.5,{x:1,y:1,ease:Elastic.easeOut})};winScreen.prototype.UpdateScoreText=function(){winScr.txtScore.setText(Math.round(winScr.sc).toString());winScr.txtScore.fontSize=640/SCR_HEIGHT*SCR_SCALE*28};winScreen.prototype.Process=function(){var a=getTimer();if(a-this.prevExpTime>0.4){this.prevExpTime=a;Particles.AddStars(ZMath.rand(0,SCR_WIDTH),ZMath.rand(0,SCR_HEIGHT))}};winScreen.prototype.onNextClick=function(){LevelManager.curLevel++;if(LevelManager.curLevel<=30){LevelManager.LoadLevel(LevelManager.curLevel)}else{lvlScr.Show()}winScr.Hide()};var levelsScreen=function(){this.clip=new PIXI.DisplayObjectContainer();this.bg=new PIXI.Sprite(PIXI.Texture.fromFrame("res/bg003.jpg"));this.clip.addChild(this.bg);this.btnMenu=new ZButton(PIXI.Texture.fromFrame("menu_home.png"),this.onMenuClick);this.btnMenu.x=Math.round(this.btnMenu.width/2);this.btnMenu.y=Math.round(SCR_HEIGHT-this.btnMenu.height/2)+4;this.clip.addChild(this.btnMenu)};levelsScreen.prototype.Show=function(){if(this.clip.parent!=null){return}ZLayers.Get("ui").addChild(this.clip);this.CreateBoxes()};levelsScreen.prototype.Hide=function(){if(this.clip.parent==null){return}for(var a=0;a<this.boxes.length;a++){this.boxes[a].img.setInteractive(false);this.boxes[a].img.mousedown=null;this.boxes[a].img.touchstart=null;ZUtils.Remove(this.boxes[a].img);ZUtils.Remove(this.boxes[a].txt);ZUtils.Remove(this.boxes[a].score)}ZUtils.Remove(this.clip)};levelsScreen.prototype.onMenuClick=function(){lvlScr.Hide();menu.Show()};levelsScreen.prototype.CreateBoxes=function(){var e;var b=110;var a=20;this.boxes=[];var l=PIXI.Texture.fromFrame("boxUnlocked.png");var h=PIXI.Texture.fromFrame("boxLocked.png");for(e=0;e<30;e++){var g=ZStorage.IsLevelEnabled(e+1)||(e+1)==1;var k=g?l:h;var f=new PIXI.Sprite(k);f.alignPivot();f.level=e+1;f.position.x=Math.round(b+e%6*f.width*1.1+f.width/2);f.position.y=Math.round(a+Math.floor(e/6)*f.height*0.95+f.height/2);this.clip.addChild(f);var d=new PIXI.BitmapText((e+1).toString(),{font:"32px fnt",align:"left"});if(e<10){d.position.x=Math.round(f.position.x-16)}else{d.position.x=Math.round(f.position.x-26)}d.position.y=Math.round(f.position.y-37);this.clip.addChild(d);var j=ZStorage.GetLevelScore(e+1);var c=new PIXI.BitmapText(j.toString(),{font:"16px fnt",align:"left"});if(j==0){c.position.x=Math.round(f.position.x+42-f.width/2)}else{c.position.x=Math.round(f.position.x+26-f.width/2)}c.position.y=Math.round(f.y+34*2-f.width/2);this.clip.addChild(c);this.boxes.push({img:f,txt:d,score:c,enabled:g})}for(var e=0;e<this.boxes.length;e++){this.boxes[e].img.scale.x=0;this.boxes[e].img.scale.y=0;TweenMax.killTweensOf(this.boxes[e].img.scale);TweenMax.to(this.boxes[e].img.scale,0.4,{delay:e*0.05,x:1,y:1,ease:Elastic.easeOut});this.boxes[e].txt.scale.x=0;this.boxes[e].txt.scale.y=0;TweenMax.killTweensOf(this.boxes[e].txt.scale);TweenMax.to(this.boxes[e].txt.scale,0.4,{delay:e*0.05,x:1,y:1,ease:Elastic.easeOut});this.boxes[e].score.scale.x=0;this.boxes[e].score.scale.y=0;TweenMax.killTweensOf(this.boxes[e].score.scale);TweenMax.to(this.boxes[e].score.scale,0.4,{delay:e*0.05,x:1,y:1,ease:Elastic.easeOut});this.boxes[e].img.setInteractive(true);this.boxes[e].img.mousedown=this.onLvlBoxClick;this.boxes[e].img.touchstart=this.onLvlBoxClick}};levelsScreen.prototype.onLvlBoxClick=function(a){ZButton.prevent=true;if(a.target){if(a.target.level){if(ZStorage.IsLevelEnabled(a.target.level)||a.target.level==1){game.ChangeState(ZGame.STATE_NONE);LevelManager.curLevel=a.target.level;LevelManager.LoadLevel(LevelManager.curLevel);lvlScr.Hide()}}}};