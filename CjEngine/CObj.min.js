function Deserialize(e){if(e.cls!=undefined&&e.cls!=""&&e.cls!="ZEngine::ZObj"){var t=e.cls;if(t.indexOf("::")!=-1)t=t.split("::")[1];if(window[t]){if(t=="ZObj")t="CObj";else{}o=new window[t];o.cls=t}else o=new CObj}else o=new CObj;if(o.PublicFields){var n=o.PublicFields.replace(" ","").split(";");var r;var i;var s=n.length;for(i=0;i<s;i++)if(n[i]!=""){var u=n[i].split(",");var a=u.length;for(r=0;r<a;r++){var f=u[r];if(f!=""){if(f.substr(0,1)=="[")continue;if(e[f]!=undefined)o[f]=e[f]}}}}return o}CObj=function(e,t,n,r){this.PublicFields="allowRotation,drawAsTexture,userData,[Graphics],isClip,fps,autoPlay,scaleX,scaleY,offsetX,offsetY,offsetR;";this._isConductor=false;this.connected;this._x=0;this._y=0;this._sensor=false;this.vx=0;this.vy=0;this._body=null;this.baseDim={};this._rotation=0;if(!CObj.objects)CObj.objects=[];CObj.objects.push(this);this.clipSrc="";this.userData=null;this.oX=0;this.oY=0;if(this.offsetX==undefined)this.offsetX=0;if(this.offsetY==undefined)this.offsetY=0;if(this.offsetR==undefined)this.offsetR=0;this.doRemove=false;if(n){var i=PIXI.Texture.fromFrame(n+".png");this.gfx=new PIXI.Sprite(i);this.gfx.gameobject=this;this.gfx.anchor.x=.5;this.gfx.anchor.y=.5;stage.addChild(this.gfx)}if(r){this.body=r;CObj.setDefaultCG(this.body);this.body.position[0]=e;this.body.position[1]=t}this.x=e;this.y=t;this.rotation=0};CObj.updateGfxDelay=.3;CObj.prototype.init=function(){if(this.body&&this.body.type==p2.Body.STATIC&&this.isConductor){var e=CObj.objects.length;for(var t=0;t<e;++t){if(CObj.objects[t]==this||!CObj.objects[t].isConductor||!CObj.objects[t].body||CObj.objects[t].body.motionState!=p2.Body.STATIC)continue;if(!this.connected)var n=-1;else n=this.connected.indexOf(CObj.objects[t]);if(n>=0)continue;this.body.type=p2.Body.DYNAMIC;for(var r=0;r<this.body.shapes.length;++r){this.body.shapes[r].collisionGroup=world.cgDYNAMIC}for(var r=0;r<CObj.objects[t].body.shapes.length;++r){CObj.objects[t].body.shapes[r].collisionGroup=world.cgDYNAMIC}world.step(1/1e7);if(this.body.overlaps(CObj.objects[t].body)){this.connected.push(CObj.objects[t]);CObj.objects[t].connected.push(this)}for(var r=0;r<this.body.shapes.length;++r){this.body.shapes[r].collisionGroup=world.cgSTATIC}for(var r=0;r<CObj.objects[t].body.shapes.length;++r){CObj.objects[t].body.shapes[r].collisionGroup=world.cgSTATIC}this.body.type=p2.Body.STATIC}}};CObj.conductClips=["tracktor","tracktorwheel","engine","guiBGitem","powerField0001","propeller","generatorRound","bomb1","tomato","chest","block1","blockmetal","balka1","generator","chickentestsmall","mister chicken","metalstatic"];CObj.prototype.updateElectroGfx=function(e){if(e.sensor)return;TweenMax.delayedCall(CObj.updateGfxDelay,e.updateElectroGfx,[e])};CObj.prototype.enableMotorConstraints=function(e){var t=world.constraints.length;for(var n=0;n<t;++n){if((world.constraints[n].bodyA==this.body||world.constraints[n].bodyB==this.body)&&world.constraints[n].motor){if(e!=null){world.constraints[n].enableMotor();world.constraints[n].setMotorSpeed(e)}else{world.constraints[n].motorEnabled=false;world.constraints[n].setMotorSpeed(0)}}}};CObj.prototype.findFirstConstraint=function(){var e=world.constraints.length;for(var t=0;t<e;++t){if(world.constraints[t].bodyA==this.body||world.constraints[t].bodyB==this.body)return world.constraints[t]}};CObj.prototype.setElectricity=function(e){this.sElectricity=e;if(e){if(this.setOffDelay){this.setOffDelay.kill();this.setOffDelay=null}if(!this.mcLightning){if(Math.abs(this.baseDim.x-this.baseDim.y)<.45*Math.min(this.baseDim.x,this.baseDim.y))this.mcLightning=pool.Pop("roundElectro");else this.mcLightning=pool.Pop("rectElectro");if(this.mcLightning){this.mcLightning.anchor.x=.5;this.mcLightning.anchor.y=.5;this.mcLightning.animationSpeed=20/FRAME_RATE;this.mcLightning.gotoAndPlay(1);this.mcLightning.scale.x=.5+this.baseDim.x/this.mcLightning.width;this.mcLightning.scale.y=.5+this.baseDim.y/this.mcLightning.height;if(this.baseDim.x<this.baseDim.y)this.mcLightning.rotation=Math.PI/2;this.gfx.addChild(this.mcLightning)}}else this.mcLightning.visible=true;if(this.gfx)this.gfx.tint=13421823;if(this.motorSpeed!=undefined){this.enableMotorConstraints(this.motorSpeed)}}else{if(this.motorSpeed!=undefined){this.enableMotorConstraints(null);this.body.angularVelocity=0}this.setOffDelay=TweenMax.delayedCall(.1,this.setOffCallback,[this])}};CObj.prototype.setOffCallback=function(e){if(e.mcLightning)e.mcLightning.visible=false;if(e.gfx)e.gfx.tint=16777215};CObj.prototype.onContactBegin=function(e){if(this==gameStage.dragObject){if(!this.concount)this.concount=0;this.concount++}else{if(e.userData&&this.isConductor){this.connected.push(e.userData)}}};CObj.prototype.onContactEnd=function(e){if(gameStage.dragObject&&this==gameStage.dragObject){this.concount--}else{if(e.userData&&this.isConductor){var t=this.connected.indexOf(e.userData);if(t>=0){this.connected.splice(t,1)}}}};CObj.prototype.process=function(){this.updateGraphics()};CObj.prototype.move=function(){this.x=this.x+this.vx;this.y=this.y+this.vy};CObj.prototype.setVelocity=function(e,t){this.vx=e;this.vy=t};CObj.prototype._destroy=function(){if(!this.doRemove)return;if(this.gfx&&this.gfx.parent)this.gfx.parent.removeChild(this.gfx);this.gfx=null;if(this.mcLightning){if(this.mcLightning.parent)this.mcLightning.parent.removeChild(this.mcLightning);pool.Push(this.mcLightning);this.mcLightning=null}if(this.body)world.removeBody(this.body)};CObj.prototype.destroy=function(){if(this.poolName)return;this.doRemove=true};CObj.getById=function(e){for(var t=0;t<CObj.objects.length;++t){if(CObj.objects[t].id==e)return CObj.objects[t]}};CObj.checkType=function(e,t){return e.constructor==t};CObj.destroyAll=function(){var e=CObj.objects.length;for(var t=0;t<e;++t){CObj.objects[t].mechanicalDestroy=true;CObj.objects[t].destroy()}CObj.processAll()};CObj.prototype.updateGraphics=function(e){if(this.gfx&&this.gfx.position){this.gfx.rotation=this.rotation+this.offsetR;if(e||this.prevRotation==undefined||Math.abs(this.gfx.rotation-this.prevRotation)>.01){var t=Math.cos(this.rotation);var n=Math.sin(this.rotation);this.oX=this.offsetX*t-this.offsetY*n;this.oY=this.offsetX*n+this.offsetY*t;this.prevRotation=this.gfx.rotation}this.gfx.position.x=this.x+this.oX;this.gfx.position.y=this.y+this.oY}};CObj.prototype.constructor=CObj;Object.defineProperty(CObj.prototype,"isConductor",{get:function(){return this._isConductor},set:function(e){this._isConductor=e;if(e&&!this.connected){TweenMax.delayedCall(CObj.updateGfxDelay,this.updateElectroGfx,[this]);this.connected=[]}}});Object.defineProperty(CObj.prototype,"x",{get:function(){if(this.body){return this.body.position[0]}else return this._x},set:function(e){if(this.body){this.body.position[0]=e}else this._x=e;this.updateGraphics()}});CObj.processAll=function(){var e=CObj.objects.length;for(var t=0;t<e;t++){CObj.objects[t].process();if(CObj.objects[t].doRemove){CObj.objects[t]._destroy();CObj.objects.splice(t,1);t--;e--}}};Object.defineProperty(CObj.prototype,"sensor",{get:function(){return this._sensor},set:function(e){this._sensor=e;if(this._body){var t=this.body.shapes.length;for(var n=0;n<t;++n)this.body.shapes[n].sensor=e}}});Object.defineProperty(CObj.prototype,"y",{get:function(){if(this.body){return this.body.position[1]}else return this._y},set:function(e){if(this.body){this.body.position[1]=e}else this._y=e;this.updateGraphics()}});Object.defineProperty(CObj.prototype,"body",{get:function(){return this._body},set:function(e){if(this._body){world.removeBody(this._body);this._body.userData=null}if(e){this._body=e;this._body.userData=this;world.addBody(this._body)}}});Object.defineProperty(CObj.prototype,"rotation",{get:function(){if(this.body){return this.body.angle}else return this._rotation},set:function(e){if(this.body){this.body.angle=e}else this._rotation=e;this.updateGraphics()}});CObj.DeserializeArray=function(e){var t=e.objects.length;var n=[];for(i=0;i<t;i++){if(e.objects[i].clip=="pussyatlas.png.bg"){continue}n.push(CObj.DeserializeCObj(e.objects[i]))}return n};CObj.ExtractFrameName=function(e){var t=e.indexOf("0");if(t==-1)return e;return e.substring(0,t)};CObj.ExtractFrameNum=function(e){var t=e.indexOf("0");if(t==-1)return 0;var n=e.substring(t,e.length);var r=n.indexOf(".");if(~r)n=n.slice(0,-4);var i=parseInt(n);if(isNaN(i))return 0;else return i};CObj.createMovieClip=function(e){var t=CObj.ExtractFrameName(e);var n=[];var r=0;var i=0;for(var s in PIXI.TextureCache){if(e==s)r=i;var o=CObj.ExtractFrameName(s);if(o==t){n.push(PIXI.TextureCache[s]);i++}}var u=new PIXI.MovieClip(n);u.gotoAndStop(r);return u};CObj.AssignTexturesToObjects=function(e,t){var n=e.length;for(var r=0;r<n;r++)if(e[r].clipSrc!=""&&e[r].clipSrc!=null){var i=null;if(e[r].sAtlasName!=""){i=PIXI.Texture.fromFrame(e[r].clipSrc+".png")}else{var s=e[r].clipSrc.indexOf(".");if(s==-1)i=PIXI.Texture.fromFrame(e[r].clipSrc+".png");else i=PIXI.Texture.fromFrame(e[r].clipSrc.substr(0,s)+".png")}if(!i)continue;var o=null;if(e[r].isClip){o=CObj.createMovieClip(e[r].clipSrc);o.animationSpeed=e[r].fps/FRAME_RATE;if(e[r].autoPlay){o.play()}}else{if(e[r].drawAsTexture){o=new PIXI.TilingSprite(i,e[r].baseDim.x,e[r].baseDim.y)}else{o=new PIXI.Sprite(i);e[r].isConductor=false}}o.anchor.x=.5;o.anchor.y=.5;o.x=e[r].x;o.y=e[r].y;o.width=e[r].baseDim.x+2;o.height=e[r].baseDim.y+2;o.rotation=e[r].rotation;o.scale.x=e[r].scaleX;o.scale.y=e[r].scaleY;o.width+=1;o.height+=1;e[r].gfx=o;if(t)t.addChild(o)}};CObj.setBodyMass=function(e,t){var n=e.getArea();e.mass=n*t/50};CObj.getBodyFromJSON=function(e){var t=false;if(!CObj.steelMaterialHiFriction){CObj.steelMaterialHiFriction=new p2.Material;CObj.mediumRestitution=new p2.Material;CObj.strongRestitution=new p2.Material;world.cgSTATIC=Math.pow(2,0);world.cgDYNAMIC=Math.pow(2,1);world.materials=[CObj.steelMaterialHiFriction,CObj.mediumRestitution,CObj.strongRestitution];world.defaultContactMaterial.friction=.5;world.setGlobalStiffness(50);world.defaultContactMaterial.stiffness=50;world.addContactMaterial(new p2.ContactMaterial(CObj.mediumRestitution,CObj.mediumRestitution,{friction:2.5,relaxation:70}));world.addContactMaterial(new p2.ContactMaterial(CObj.steelMaterialHiFriction,CObj.steelMaterialHiFriction,{friction:3.4,relaxation:4,stiffness:3e4}));world.addContactMaterial(new p2.ContactMaterial(CObj.steelMaterialHiFriction,CObj.mediumRestitution,{friction:.4,stiffness:1e3,restitution:.4}));world.addContactMaterial(new p2.ContactMaterial(CObj.steelMaterialHiFriction,CObj.strongRestitution,{restitution:.5,friction:.5}));world.addContactMaterial(new p2.ContactMaterial(CObj.mediumRestitution,CObj.strongRestitution,{restitution:1,friction:.5}))}switch(e.body.type){case"DYNAMIC":t=false;break;case"STATIC":t=true;break}var n=e.density;if(e.cls=="Chicken"){e.elasticity=.5;e.density=1}if(t)n=0;var r=new p2.Body({mass:n,fixedRotation:!e.allowRotation});r.motionState=t?p2.Body.STATIC:p2.Body.DYNAMIC;var i=e.body.shapes.length;if(i!=0){for(var s=0;s<i;s++){switch(e.body.shapes[s].type){case"CIRCLE":{var u=new p2.Circle(e.body.shapes[s].radius);break};case"POLYGON":{var a=e.body.shapes[s].localVerts;var f=[];for(j=0;j<a.length;j++){f.push([a[j].x,a[j].y])}u=new p2.Convex(f);break}}if(u)r.addShape(u);if(o.elasticity<.2){u.material=CObj.steelMaterialHiFriction}else if(o.elasticity<=.5){u.material=CObj.mediumRestitution}else u.material=CObj.strongRestitution}}CObj.setDefaultCG(r);CObj.setBodyMass(r,e.density);return r};CObj.setDefaultCG=function(e){if(e.motionState==p2.Body.STATIC||e.mass==0)var t=world.cgSTATIC;else var t=world.cgDYNAMIC;for(var n=0;n<e.shapes.length;++n){if(t==world.cgSTATIC)e.shapes[n].collisionMask=world.cgDYNAMIC;else e.shapes[n].collisionMask=world.cgSTATIC|world.cgDYNAMIC;e.shapes[n].collisionGroup=t}};CObj.DeserializeCObj=function(e,t){var n=Deserialize(e);n.clipSrc=e.clip;if(n.clipSrc){var r=e.clip;var i=r.lastIndexOf(".");if(r.lastIndexOf(".",i-1)!=-1){var s=r.substring(0,i);n.sAtlasName=r.substring(0,i);n.clipSrc=r.substring(i+1,r.length);i=n.sAtlasName.indexOf(".");if(i!=-1){n.sAtlasName=n.sAtlasName.substr(0,i)}}}if(e.density!=undefined)n.density=e.density;if(e.elasticity!=undefined)n.elasticity=e.elasticity;if(e.friction!=undefined)n.friction=e.friction;if(e.frictionStatic!=undefined)n.frictionStatic=e.frictionStatic;if(e.frictionRolling!=undefined)n.frictionRolling=e.frictionRolling;if(e.isSensor!=undefined)n.isSensor=e.isSensor;if(e.layer)n.layer=e.layer;n.id=e.id;var o;var u=60.5;if(e.body){n.body=CObj.getBodyFromJSON(e)}if(e.baseDim){n.baseDim.x=e.baseDim.x;n.baseDim.y=e.baseDim.y}var a=2;n.scaleX=e.scaleX/a;n.scaleY=e.scaleY/a;if(e.x!=undefined)n.x=e.x;if(e.y!=undefined)n.y=e.y;if(e.rotation!=undefined)n.rotation=e.rotation;return n}