var CG_GROUND=1,CG_MONSTER=2,CG_PLAYER=4,CG_BULLET=8;function extractName(a){return a.name?(a.name+" "+a.last_name).substring(0,16):"\u0410\u043d\u043e\u043d\u0438\u043c"}function findByProp(a,b,c){for(var d=a.length,e=0;e<d;++e)if(a[e][b]==c)return a[e];return null}function getRand(a){return a[Math.floor(Math.random()*a.length)]}function OpenInNewTab(a){window.open(a,"_blank").focus()}function clone(a){return JSON.parse(JSON.stringify(a))}
function superRand(a){for(var b=0,c=0;c<a;++c)b+=Math.random();return b/a}function dateDiff(a,b){var c=(new Date).getTime()-a.getTime(),c=(6E4*b-c)/1E3,d=Math.floor(c/3600),c=c%3600,e=Math.floor(c/60),c=c%60,f=Math.floor(c%60);return{d:c,m:e,h:d,s:f,timeString:(10>d?"0"+d:d)+" : "+(10>e?"0"+e:e)+" : "+(10>f?"0"+f:f)}}function crsp(a){var b=4<=a.length&&"."!=a.charAt(a.length-4)?".png":"";a=new PIXI.Sprite(PIXI.Texture.fromFrame(a+b));a.anchor.x=.5;a.anchor.y=.5;return a}
function rp(a){a&&a.parent&&a.parent.removeChild(a)}function extend(a,b,c){c=function(){};c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.superclass=b.prototype}function hslToRgb(a,b,c){if(0==b)c=b=a=c;else{var d=function(a,b,c){0>c&&(c+=1);1<c&&--c;return c<1/6?a+6*(b-a)*c:.5>c?b:c<2/3?a+(b-a)*(2/3-c)*6:a},e=.5>c?c(1+b):c+b-c*b,f=2*c-e;c=d(f,e,a+1/3);b=d(f,e,a);a=d(f,e,a-1/3)}return[Math.round(255*c),Math.round(255*b),Math.round(255*a)]}
rgbtoint=function(a,b,c){return 16777216+(a<<16)+(b<<8)+c};function rgbToHsl(a,b,c){a/=255;b/=255;c/=255;var d=Math.max(a,b,c),e=Math.min(a,b,c),f,g=(d+e)/2;if(d==e)f=e=0;else{var k=d-e,e=.5<g?k/(2-d-e):k/(d+e);switch(d){case a:f=(b-c)/k+(b<c?6:0);break;case b:f=(c-a)/k+2;break;case c:f=(a-b)/k+4}f/=6}return[f,e,g]}
var ZSound={available:!1,loaded:!1,Init:function(a){createjs.FlashAudioPlugin.swfPath="res/snd/";createjs.Sound.registerPlugins([createjs.WebAudioPlugin,createjs.HTMLAudioPlugin,createjs.FlashAudioPlugin]);ZSound.available=createjs.Sound.initializeDefaultPlugins();ZSound.available?(createjs.Sound.alternateExtensions=["mp3"],ZSound.loaded=0,ZSound.total=a.length,createjs.Sound.addEventListener("fileload",function(){ZSound.loaded++;ZSound.loaded==a.length&&ZSound.soundLoadedFunction&&(console.log("ZSound loaded "+
ZSound.loaded.toString()+" / "+a.length.toString()),ZSound.loaded=!0,ZSound.soundLoadedFunction())}),createjs.Sound.registerSounds(a,"res/snd/")):(console.log("ZSound loaded without plugins [NO SOUND]"),ZSound.loaded=!0)},PlayMusic:function(a){ZSound.loaded?ZSound.PlayMusicInner(a):soundLoadedFunction=function(){ZSound.PlayMusicInner(a);ZSound.loaded=!0}},UnMute:function(){ZSound.available||(ZSound.available=!0,createjs.Sound.setMute(!1))},Mute:function(){ZSound.available=!1;createjs.Sound.setMute(!0)},
PlayMusicInner:function(a){if(ZSound.musicInstanceName!=a||!ZSound.musicInstance){ZSound.musicInstance&&createjs.Sound.stop(ZSound.musicInstance);try{ZSound.musicInstanceName=a,ZSound.musicInstance=createjs.Sound.play(a,{interrupt:createjs.Sound.INTERRUPT_NONE,loop:999999})}catch(b){}}},Play:function(a){if(ZSound.available)try{createjs.Sound.play(a,createjs.Sound.INTERRUPT_NONE,0,0,!1,1)}catch(b){}}};LevelManager=function(){};
LevelManager.onComplete=function(){LevelManager.layer||(LevelManager.layer=SM.inst.ol);CObj.AssignTexturesToObjects(LevelManager.objs,LevelManager.layer);for(var a=0;a<LevelManager.objs.length;++a)LevelManager.objs[a].init();if(LevelManager.onVeryComplete)LevelManager.onVeryComplete()};LevelManager.removeLastLevel=function(){for(;0<LevelManager.objs.length;)LevelManager.objs[0].destroy(),LevelManager.objs.splice(0,1);objs=null};
LevelManager.loadLevel=function(a,b,c){LevelManager.objs=CObj.DeserializeArray(LevelManager.levels["levels/"+a+".json"]);LevelManager.layer=c;LevelManager.objs.sort(function(a,b){return a.layer==b.layer?0:a.layer<b.layer?-1:1});a=[];for(c=0;c<LevelManager.objs.length;++c)void 0!=LevelManager.objs[c].sAtlasName&&""!=LevelManager.objs[c].sAtlasName&&0>a.indexOf(LevelManager.objs[c].sAtlasName)&&a.push(LevelManager.objs[c].sAtlasName);LevelManager.onVeryComplete=b;b=[];for(c=0;c<a.length;++c){var d=
"imgtps/"+a[c];PIXI.BaseTextureCache[d+".png"]||b.push(d+".json")}if(0<b.length)b=new PIXI.AssetLoader(b),b.load(),b.onComplete=LevelManager.onComplete;else LevelManager.onComplete();return LevelManager.objs};LevelManager.inst=new LevelManager;LevelManager.levels={};
function SM(){this.fg=new PIXI.DisplayObjectContainer;this.bg=new PIXI.DisplayObjectContainer;this.ol=new PIXI.DisplayObjectContainer;this.guiLayer=new PIXI.DisplayObjectContainer;this.superGuiLayer=new PIXI.DisplayObjectContainer;this.fontLayer=new PIXI.DisplayObjectContainer;this.superStage=new PIXI.DisplayObjectContainer;this.bg.interactive=!0;this.fg.interactive=!1;this.ol.interactive=!1;this.guiLayer.interactive=!0;this.superGuiLayer.interactive=!0;this.fontLayer.interactive=!1;this.currentStage=
null;this.transStart=0;this.transTime=600;this.doTrans=!1;$(document).mousewheel(function(a,b,c,d){if(CObj.objects)for(var e=0;e<CObj.objects.length;++e)if(CObj.checkType(CObj.objects[e],CScrollbar),CObj.objects[e].mover)CObj.objects[e].onWheel(a,b,c,d);a.stopPropagation();a.stopImmediatePropagation();a.preventDefault()})}SM.inst=new SM;
SM.prototype.addDisableWindow=function(a,b){var c=new PIXI.DisplayObjectContainer,d=new PIXI.Graphics;d.fillColor=571552546;d.beginFill();d.drawRect(0,0,SCR_WIDTH,SCR_HEIGHT);d.endFill();d.alpha=.5;c.addChild(d);a&&(d=CTextField.createTextField({text:a,fontSize:25,align:"center"}),d.text=a,d.updateText(),d.position.x=SCR_WIDTH/2,d.position.y=SCR_HEIGHT/2,d.position.x-=d.getLocalBounds().width/2,d.position.y-=d.getLocalBounds().height/2,c.addChild(d));c.interactive=!1;c.trans=!0;b?b.addChild(c):this.superStage.addChild(c);
return c};SM.prototype.addLayersToStage=function(){this.superStage.addChild(this.bg);this.superStage.addChild(this.ol);this.superStage.addChild(this.fg);this.superStage.addChild(this.guiLayer);this.superStage.addChild(this.superGuiLayer);this.superStage.addChild(this.fontLayer);window.stage.addChild(this.superStage);window.mouseX=SCR_WIDTH/2;window.mouseY=SCR_HEIGHT/2;this.bg.mousemove=function(a){window.mouseX=a.global.x/SCR_SCALE;window.mouseY=a.global.y/SCR_SCALE}};
SM.prototype.fadeBegin=function(a){this.currentStage&&(this.currentStage.killing=!0,this.currentStage.onHide(a),this.currentStage.doProcess=!1);a.doProcess=!0;this.fadeEnd(a);a.onShow()};SM.prototype.soundplay=function(){};SM.prototype.fadeEnd=function(a){this.currentStage=a};SM.prototype.transEnd=function(){};SM.prototype.process=function(){this.currentStage&&this.currentStage.doProcess&&this.currentStage.process()};
SM.prototype.openStage=function(a,b){this.doTrans||((a.previousStage=this.currentStage)?this.currentStage.doProcess&&(this.currentStage.doProcess=!1,this.fadeBegin(a)):(this.currentStage=a,this.currentStage.doProcess=!0,this.currentStage.killing=!1,a.onShow()))};function CustomStage(){this.visible=!1;this.doProcess=!0}CustomStage.prototype.process=function(){};CustomStage.prototype.onRemove=function(){};CustomStage.prototype.onHide=function(a){};CustomStage.prototype.onShow=function(){};
function LevSel(){CustomStage.apply(this)}extend(LevSel,CustomStage);LevSel.prototype.onShow=function(){CustomStage.prototype.onShow.call(this);ZSound.PlayMusic("trackmenu");LevelManager.loadLevel("levelselect",this.onShowContinue)};
LevSel.prototype.onShowContinue=function(){var a=dataStorage.completedLevels;0>a&&(a=0);CObj.getById("btnmenu").click=function(){SM.inst.openStage(mainMenu)};for(var b=1;40>=b;++b){var c=CObj.getById("btn"+b.toString());c.gfx.levelNum=b;c.click=levelClick;c.textField.visible=!0;c.lock=new PIXI.Sprite(PIXI.Texture.fromFrame("locklevel.png"));c.lock.scale.x=.35;c.lock.scale.y=.35;c.lock.anchor.x=.5;c.lock.anchor.y=.5;c.lock.visible=!1;c.gfx.addChild(c.lock);b>a+1&&(c.click=null,c.gfx.tint=10066329,
c.textField.visible=!1,c.lock.visible=!0);var d=new CObj(c.x-32,c.y+22);d.gfx=CObj.createMovieClip("star0001");d.gfx.interactive=!1;d.gfx.scale.x=.4*window.addScale;d.gfx.scale.y=.4*window.addScale;d.gfx.anchor.x=.5;d.gfx.anchor.x=.5;SM.inst.guiLayer.addChild(d.gfx);var e=new CObj(c.x,c.y+22);e.gfx=CObj.createMovieClip("star0001");e.gfx.interactive=!1;e.gfx.scale.x=.4*window.addScale;e.gfx.scale.y=.4*window.addScale;e.gfx.anchor.x=.5;e.gfx.anchor.x=.5;SM.inst.guiLayer.addChild(e.gfx);c=new CObj(c.x+
32,c.y+22);c.gfx=CObj.createMovieClip("star0001");c.gfx.interactive=!1;c.gfx.scale.x=.4*window.addScale;c.gfx.scale.y=.4*window.addScale;c.gfx.anchor.x=.5;c.gfx.anchor.x=.5;SM.inst.guiLayer.addChild(c.gfx);var f=dataStorage["lvlst"+b.toString()];f||(f=0);1==f&&d.gfx.gotoAndStop(1);2==f&&(d.gfx.gotoAndStop(1),e.gfx.gotoAndStop(1));3==f&&(d.gfx.gotoAndStop(1),e.gfx.gotoAndStop(1),c.gfx.gotoAndStop(1))}};function levelClick(a){gameStage.currentLevel=a.target.levelNum;SM.inst.openStage(gameStage)}
LevSel.prototype.onHide=function(a){CustomStage.prototype.onHide.call(this,null);CObj.destroyAll();CObj.processAll()};LevSel.prototype.process=function(){CObj.processAll()};function GameStage(){this.invFR=1/window.FRAME_RATE}extend(GameStage,CustomStage);
Object.defineProperty(GameStage.prototype,"worldSpeed",{get:function(){return this._worldSpeed},set:function(a){this._worldSpeed=a;for(var b=CObj.objects.length,c=0;c<b;++c)CObj.objects[c].gfx&&CObj.checkType(CObj.objects[c].gfx,PIXI.MovieClip)&&(CObj.objects[c].gfx.animationSpeed=a*CObj.objects[c].fps/FRAME_RATE)}});
GameStage.prototype.createHPBar=function(a,b,c){a=new CObj(a,b);b=PIXI.Texture.fromFrame("health dead.png");a.gfx=new PIXI.DisplayObjectContainer;var d=new PIXI.TilingSprite(b,b.width-.5,b.height-.5);a.id="hpbar";d.width=c*b.width;a.gfx.addChild(d);a.updateGraphics();a.texW=b.width;b=PIXI.Texture.fromFrame("health.png");d=new PIXI.TilingSprite(b,b.width-.5,b.height-.5);d.height=b.height-1;d.width=c*b.width;a.gfx.addChild(d);SM.inst.fg.addChild(a.gfx);a.tweenProp=function(a){gameStage.player&&(this.gfx.getChildAt(1).width=
gameStage.player.maxHp*this.texW*a,this.gfx.getChildAt(0).width=gameStage.player.maxHp*this.texW)}};GameStage.prototype.createCircle=function(a,b,c,d){a=new PIXI.Graphics;var e=2*Math.PI/100,f=0,g,k;a.moveTo(0,0);for(var h=0;100>h;++h)g=b+Math.cos(f)*d,k=c+Math.sin(f)*d,f+=e,a.lineTo(g,k),a.moveTo(g,k);return a};GameStage.prototype.process=function(){window.focus();CObj.processAll();var a=Math.floor(LauncherBG.inst.distance);gameStage.distText&&(gameStage.distText.text=a.toString()+" M");MM.inst.process()};
GameStage.prototype.onHide=function(a){gameStage.menuBtn=null;gameStage.player=null;gameStage.barXP=null;gameStage.floor=null;gameStage.winDelayedCall&&(gameStage.winDelayedCall.kill(!1),gameStage.winDelayedCall=null);gameStage.losing=!1;gameStage.scoreObj=null;gameStage.preWinText=null;gameStage.curweapon=null;gameStage.ammobar=null;gameStage.ammoico=null;TweenMax.killAll(!0,!0,!0);CustomStage.prototype.onHide.call(this,null);$(function(){$(document).off("keydown",this.doKeyDown);$(document).off("keyup",
this.doKeyUp);$(document).off("mousedown",this.fdown);$(document).off("mouseup",this.fup)});CObj.destroyAll();gameStage.preWinText=null;gameStage.dragObject=null;stage.touchmove=null;stage.mousemove=null;stage.mousedown=null;stage.touchstart=null;stage.mouseup=null;stage.touchend=null;gameStage.pauseSprite&&(gameStage.pauseSprite.parent.removeChild(gameStage.pauseSprite),gameStage.pauseTexture&&(gameStage.pauseTexture.destroy(!0),gameStage.pauseTexture=null),gameStage.pauseSprite=null);gameStage.distText=
null;LauncherBG.inst.destroy();LauncherBG.inst=null};GameStage.prototype.loseGame=function(){};GameStage.prototype.remGfx=function(a){a&&a.parent&&a.parent.removeChild(a)};GameStage.prototype.updateXP=function(){gameStage.barXP.prop=PlayerData.inst.playerItem.xp/PlayerData.inst.xpLevel[PlayerData.inst.playerItem.lvl].xp};
GameStage.prototype.updateItems=function(){for(var a=0;a<PlayerData.inst.items_enabled.length;++a){var b=PlayerData.inst.getItemById(PlayerData.inst.items_enabled[a].id_item);b.type==tWeapon&&PlayerData.inst.items_enabled[a].equipped&&("Rifle"==b.name&&(gameStage.curweapon=w_rifle),"PPS"==b.name&&(gameStage.curweapon=w_pps),"AK-74"==b.name&&(gameStage.curweapon=w_ak74),"Minigun"==b.name&&(gameStage.curweapon=w_minigun),"Grenade launcher"==b.name&&(gameStage.curweapon=w_grenadel),"Plazma Cannon"==
b.name&&(gameStage.curweapon=w_laser))}gameStage.player.weapon=gameStage.curweapon};
GameStage.prototype.shAfterLife=function(){if(!SM.inst.currentStage.killing){var a=new CircleBar(SCR_WIDTH/2,SCR_HEIGHT/2);a.init("bodrost cover.png","bodrost bar.png","bodrost bar bg.png");SM.inst.guiLayer.addChild(a.gfx);removeafterlife=function(){f.parent.removeChild(f);c.parent.removeChild(c);g.parent.removeChild(g);a.gfx.visible=!1};openScoreWnd=function(){SM.inst.currentStage.killing||(removeafterlife(),LevelManager.loadLevel("levelgameover",gameStage.openEndWindowLoaded,SM.inst.guiLayer))};
var b=new TweenMax(a,3,{pos:1,onComplete:openScoreWnd,ease:Circ.easeOut}),c=new PIXI.Sprite(PIXI.Texture.fromFrame("bodrost text.png"));c.anchor.x=.5;c.anchor.y=.5;c.x=SCR_WIDTH/2;c.y=SCR_HEIGHT/2-108;SM.inst.guiLayer.addChild(c);a.gfx.interactive=!0;a.gfx.click=function(){b.pause();var c=function(){b.resume();ZSound.Play("vzbodritsa");TweenMax.killTweensOf(a);removeafterlife();gameStage.removeFade();gameStage.unpause();gameStage.state="game";incMetric("USED REVEAL");PlayerData.inst.playerItem.crystals-=
gameStage.revealPrice;gameStage.revealPrice*=2;gameStage.player.reveal();PlayerData.inst.savePlayerData();new TweenMax(LauncherBG.inst,2,{maxVelocity:LauncherBG.inst.preVelocity})};if(PlayerData.inst.playerItem.crystals>gameStage.revealPrice)c();else{var d=gameStage.revealPrice-PlayerData.inst.playerItem.crystals;3>=d?order("item4"):15>=d?order("item5"):order("item6");VK.orderComplete=function(){PlayerData.inst.playerItem.crystals>price&&c()};d=function(){b.resume()};VK.orderFail=d;VK.orderCancel=
d}};var d=a.gfx.scale.x,e=a.gfx.scale.y;a.gfx.mouseover=function(b){TweenMax.killTweensOf(a.gfx.scale);a.gfx.tint=CButton.tintColor;new TweenMax(a.gfx.scale,.6,{y:e+.05,ease:Elastic.easeOut});new TweenMax(a.gfx.scale,.4,{x:d+.05,ease:Elastic.easeOut})};a.gfx.mouseout=function(b){a.gfx.tint=16777215;new TweenMax(a.gfx.scale,.3,{x:d,y:e,ease:Elastic.easeOut})};var f=new PIXI.Sprite(PIXI.Texture.fromFrame("bodrost star.png"));f.anchor.x=.5;f.anchor.y=.5;f.x=SCR_WIDTH/2;f.y=SCR_HEIGHT/2+120;SM.inst.guiLayer.addChild(f);
var g=CTextField.createTextField({text:gameStage.revealPrice.toString(),fontSize:22,align:"center"});g.tint=3355443;g.updateText();g.x=8+SCR_WIDTH/2;g.y=SCR_HEIGHT/2+107;SM.inst.guiLayer.addChild(g)}};
GameStage.prototype.openEndWindowLoaded=function(){function a(a){var b=CObj.getById("div").y+20,c=new CTextField(SCR_WIDTH/2-100+-70,b+45*a);c.text=(a+1).toString()+".";c.fontSize=18;c.init();c.id="tf"+(a+1).toString()+"1";c=new CTextField(SCR_WIDTH/2+-70,b+45*a);c.text="---";c.align="center";c.fontSize=18;c.init();c.id="tf"+(a+1).toString()+"2";b=new CTextField(SCR_WIDTH/2+15,b+45*a);b.text="---";b.fontSize=18;b.init();b.id="tf"+(a+1).toString()+"3"}CObj.getById("tfmon").text=PlayerData.inst.score.toString();
CObj.getById("tfprev").text=Math.round(LauncherBG.inst.distance).toString()+" \u043c";var b=Math.round(PlayerData.inst.playerItem.maxdistance);LauncherBG.inst.distance>PlayerData.inst.playerItem.maxdistance&&(b=Math.round(LauncherBG.inst.distance));CObj.getById("tfrec").text=b.toString()+" \u043c";CObj.getById("bmenu").click=function(){gameStage.doProcess=!0;SM.inst.openStage(charStage)};for(var c=1;5>=c;++c)CObj.getById("b"+c.toString()).gfx.visible=!1,CObj.getById("b"+c.toString()).text="";PlayerData.inst.playerItem.money+=
PlayerData.inst.score;PlayerData.inst.playerItem.maxdistance=b;PlayerData.inst.savePlayerData();CObj.getById("bshare").click=function(){VK.api("wall.post",{owner_id:vkparams.viewerid,message:"\u042f \u043f\u0440\u043e\u0435\u0445\u0430\u043b "+b.toString()+" \u043c\u0435\u0442\u0440\u043e\u0432.\nhttps://vk.com/app4654201",attachments:["photo90523698_359515843","https://vk.com/app4654201"]},function(a){})};for(c=0;5>c;++c)a(c);azureclient.invokeApi("get_scores",{body:{filter:vkparams.friendsIngameIDs,
take:5,skip:scoreStage.skip},method:"post"}).done(function(a){a=a.result;for(var c=0;c<Math.min(5,a.length);++c)CObj.getById("tf"+(c+1).toString()+"2").text=extractName(a[c]),CObj.getById("tf"+(c+1).toString()+"3").text=a[c].maxdistance.toString(),b>a[c].maxdistance&&(CObj.getById("b"+(c+1).toString()).gfx.visible=!0,CObj.getById("b"+(c+1).toString()).text="\u042f \u0442\u0435\u0431\u044f \u0443\u0434\u0435\u043b\u0430\u043b",function(a,c){CObj.getById("b"+(a+1).toString()).click=function(){VK.api("wall.post",
{owner_id:c.vkapi,message:"\u042f \u043f\u0440\u043e\u0435\u0445\u0430\u043b "+b.toString()+" \u043c\u0435\u0442\u0440\u043e\u0432. *id"+c.vkapi.toString()+"("+c.name+") "+c.last_name+",  \u043d\u0438\u043a\u043e\u0433\u0434\u0430 \u043d\u0435 \u043f\u043e\u0431\u044c\u0435\u0448\u044c \u043c\u043e\u0439 \u0440\u0435\u043a\u043e\u0440\u0434!!\nhttps://vk.com/app4654201",attachments:["photo90523698_359515827","https://vk.com/app4654201"]},function(a){})}}(c,a[c]));for(a=c;5>a;++a)CObj.getById("b"+
(a+1).toString()).gfx.visible=!0,CObj.getById("b"+(a+1).toString()).text="\u041f\u0440\u0438\u0433\u043b\u0430\u0441\u0438\u0442\u044c \u0432 \u0438\u0433\u0440\u0443",CObj.getById("b"+(a+1).toString()).click=function(){VK.callMethod("showInviteBox")}},function(a){})};GameStage.prototype.sessionEnd=function(){"game"==gameStage.state&&(gameStage.state="endsession",gameStage.pause(),gameStage.fadeScreen(),gameStage.shAfterLife(),incMetric("DIED on pattern="+MM.inst.patterns[MM.inst.currentPattern.pid].mons))};
GameStage.prototype.updateWindowLevWin=function(){gameStage.doPhys=!1};GameStage.prototype.updateScore=function(){gameStage.scoreObj&&(gameStage.scoreObj.text=PlayerData.inst.score.toString())};function getChar(a){return null==a.which?32>a.keyCode?null:String.fromCharCode(a.keyCode):0!=a.which&&0!=a.charCode?32>a.which?null:String.fromCharCode(a.which):null}
GameStage.prototype.doKeyDown=function(a){if("game"==gameStage.state){a=a||window.event;var b=String.fromCharCode(a.which);if(CBooster.list)for(var c=0;c<CBooster.list.length;++c)if(CBooster.list[c].key==b&&CBooster.list[c].activate)CBooster.list[c].onActivate();if((87==a.which||17==a.which||32==a.which)&&gameStage.player)gameStage.player.onJump();a.preventDefault()}};GameStage.prototype.doKeyUp=function(a){"game"==gameStage.state&&(a=a||window.event,getChar(a),a.preventDefault())};
GameStage.prototype.showTutorial=function(){showText=function(a,b,c){var d=new CTextField(b,c);d.text=a;d.fontFamily="dedgamecaps";d.align="center";d.fontSize=27;d.init();d.gfx.scale.x=1.3;d.gfx.alpha=0;TweenMax.delayedCall(4.8,function(){new TweenMax(d.gfx.scale,.2,{x:1.3});new TweenMax(d.gfx,.2,{alpha:0})});TweenMax.delayedCall(5,function(){d.destroy()});new TweenMax(d.gfx.scale,.2,{x:1});new TweenMax(d.gfx,.2,{alpha:1})};MM.inst.monsterQueue="........l..l..l..l.l........s...s...s....0000000........c...c...c.....+....+...+.......ss...s.s.s.g.g.s.s.c";
TweenMax.delayedCall(3,showText,["\u0414\u0415\u0414\u0423\u041b\u042c, \u0416\u041c\u0418 'W' \u0418\u041b\u0418 \u041f\u041a\u041c==\u0427\u0422\u041e\u0411\u042b \u041f\u0420\u042b\u0413\u0410\u0422\u042c",SCR_WIDTH/2,140]);TweenMax.delayedCall(10,showText,["\u041a\u041b\u0418\u041a\u0410\u0419 \u0427\u0422\u041e\u0411\u042b \u0421\u0422\u0420\u0415\u041b\u042f\u0422\u042c",SCR_WIDTH/2,140]);TweenMax.delayedCall(16,showText,["\u0421\u041e\u0411\u0418\u0420\u0410\u0419 \u041c\u041e\u041d\u0415\u0422\u042b",
SCR_WIDTH/2,140]);TweenMax.delayedCall(22,showText,["\u041d\u0410\u0416\u041c\u0418 'W' \u0414\u0412\u0410\u0416\u0414\u042b==\u0427\u0422\u041e\u0411\u042b \u041f\u0420\u042b\u0413\u041d\u0423\u0422\u042c \u0412\u042b\u0428\u0415",SCR_WIDTH/2,140]);TweenMax.delayedCall(28,showText,["\u0412\u042b\u0421\u0422\u0420\u0415\u041b\u0418 \u0412 \u0414\u0420\u041e\u041d\u0410==\u0427\u0422\u041e\u0411\u042b \u0417\u0410\u0411\u0420\u0410\u0422\u042c \u0411\u0423\u0421\u0422\u0415\u0420",SCR_WIDTH/2,140]);
TweenMax.delayedCall(38,showText,["\u041f\u041e\u0417\u0414\u0420\u0410\u0412\u041b\u042f\u042e, \u0422\u0412\u041e\u0415 \u041e\u0411\u0423\u0427\u0415\u041d\u0418\u0415 \u041e\u041a\u041e\u041d\u0427\u0415\u041d\u041e",SCR_WIDTH/2,140]);TweenMax.delayedCall(43,function(){gameStage.tutComplete=!0;SM.inst.openStage(charStage)})};
GameStage.prototype.onShow=function(){ZSound.PlayMusic("m_ded");PlayerData.inst.score=0;gameStage.tutorial=vkparams.registered?!0:!1;CustomStage.prototype.onShow.call(this);gameStage.killing=!1;gameStage.slowMoCoef=1;gameStage.rightReleased=!0;this.state="game";this.doProcess=!1;gameStage.revealPrice=1;LauncherBG.inst=new LauncherBG(0,0);LauncherBG.inst.addLevel("plantPart2");for(var a=0;500>a;++a)LauncherBG.inst.process(!0);LauncherBG.inst.distance=0;MM.inst.init();LevelManager.loadLevel("hud",gameStage.onShowContinue,
SM.inst.guiLayer)};GameStage.prototype.fdown=function(a){1==a.which&&(gameStage.fireState=!0);3==a.which&&gameStage.rightReleased&&(gameStage.rightReleased=!1,gameStage.player.onJump())};GameStage.prototype.fup=function(a){3==a.which&&(gameStage.rightReleased=!0);1==a.which&&(gameStage.fireState=!1,gameStage.player&&gameStage.player.weapon.mouseUp())};
GameStage.prototype.onShowContinue=function(){gameStage.doProcess=!0;gameStage.stepSize=gameStage.invFR;gameStage.doPhys=!0;var a=gameStage.createCircle(20,100,100,100);SM.inst.guiLayer.addChild(a);if(vkparams.friendsIngame){LauncherBG.inst.graves=[];for(a=0;a<vkparams.friendsIngame.length;++a)1<vkparams.friendsIngame[a].maxdistance&&LauncherBG.inst.graves.push({text:vkparams.friendsIngame[a].name+" "+vkparams.friendsIngame[a].last_name,dist:vkparams.friendsIngame[a].maxdistance});1<PlayerData.inst.playerItem.maxdistance&&
LauncherBG.inst.graves.push({text:vkparams.first_name+" "+vkparams.last_name,dist:PlayerData.inst.playerItem.maxdistance})}gameStage.floor=new FloorObj(SCR_WIDTH/2,SCR_HEIGHT-60,null);gameStage.floor.gfx=new PIXI.DisplayObjectContainer;gameStage.floor.gfx.width=SCR_WIDTH;gameStage.floor.gfx.height=120;gameStage.floor.gfx.visible=!1;gameStage.createHPBar(10,5,5);gameStage.ammobar=CObj.getById("ammot");gameStage.ammoico=CObj.getById("ammoico");gameStage.reloadBar=new CircleBar(gameStage.ammoico.x,gameStage.ammoico.y);
gameStage.reloadBar.init("recharge icon.png","recharge icon bar.png","recharge icon.png");gameStage.reloadBar.pos=.5;gameStage.reloadBar.gfx.visible=!1;SM.inst.guiLayer.addChild(gameStage.reloadBar.gfx);gameStage.player=new CPlayer(140,SCR_HEIGHT-160);gameStage.player.gfx.pivot.y=-190;gameStage.player.gfx.scale.x=.22;gameStage.player.gfx.scale.y=.22;gameStage.player.playable=!0;LauncherBG.inst.pllayer.addChild(gameStage.player.gfx);5==PlayerData.inst.getUpgrade(null,"Health").upgr&&(gameStage.player.maxHp+=
1,gameStage.player.hp+=1);gameStage.updateItems();gameStage.barXP=CObj.getById("barxp");gameStage.player.updateAppearence(!0,!0,"idle");TweenMax.delayedCall(1.3,function(){gameStage.player&&gameStage.player.gfx.skeleton.setAttachment("head","head1")});gameStage.player.weapon.state=gameStage.player.weapon.sFire;gameStage.player.weapon.recoilValue=0;gameStage.player.weapon.ammo=gameStage.player.weapon.magCapacity;gameStage.player.weapon.updateAmmo();gameStage.player.process();gameStage.scoreObj=CObj.getById("score");
gameStage.updateScore();gameStage.worldSpeed=1;gameStage.createPools();gameStage.distText=CObj.getById("dist");gameStage.visibleAllText=function(a){for(var b=0;b<SM.inst.fontLayer.children.length;++b)SM.inst.fontLayer.children[b].visible=a};gameStage.menuBtn=CObj.getById("menu");gameStage.menuBtn.click=function(){gameStage.doProcess&&gameStage.doPhys&&(gameStage.state="paused",gameStage.pause(),gameStage.fadeScreen(),gameStage.visibleAllText(!1),TweenMax.killTweensOf(gameStage.menuBtn,!0),LevelManager.loadLevel("levelmenu",
gameStage.makePause,SM.inst.fontLayer))};var b=gameStage.doKeyDown,c=gameStage.doKeyUp;$(function(){$(document).on("keydown",b);$(document).on("keyup",c);$(document).mousedown(gameStage.fdown);$(document).mouseup(gameStage.fup)});gameStage.updateXP();LauncherBG.inst.maxVelocity=.1;new TweenMax(LauncherBG.inst,3,{maxVelocity:10,ease:Sine.easeIn});gameStage.tutorial&&!gameStage.tutComplete?gameStage.showTutorial():PlayerData.inst.progressAch("Gold medal 1",1,!1)};
GameStage.prototype.makePause=function(){removePause=function(){gameStage.state="game";gameStage.doProcess=!0;LevelManager.removeLastLevel();LevelManager.objs=null;gameStage.visibleAllText(!0);gameStage.doPhys=!0;gameStage.unpause();gameStage.removeFade()};charStage.updateMusicButton(CObj.getById("bmute"));CObj.getById("bresume").click=function(){removePause()};CObj.getById("blevs").click=function(){removePause();SM.inst.openStage(charStage)}};
GameStage.prototype.createPools=function(){0==pool.Size("textParticle")&&pool.Fill("textParticle",0,function(){var a=new CTextField(0,0);a.fontFamily=0;a.fontSize=25;a.align="center";a.gfx=CTextField.createTextField(a);a.gfx.scale.x*=window.addScale;a.gfx.scale.y*=window.addScale;return a});0==pool.Size("smoke")&&pool.Fill("smoke",20,function(){return crsp("smoke")});0==pool.Size("fxsmallblink")&&pool.Fill("fxsmallblink",10,function(){var a=CObj.createMovieClip("fxsmallblink");a.scale.x=1.8;a.scale.y=
1.8;a.anchor.x=.5;a.anchor.y=.5;return a});0==pool.Size("coinCollect")&&pool.Fill("coinCollect",10,function(){var a=CObj.createMovieClip("coinfx.png");a.scale.x=.7;a.scale.y=.7;a.anchor.x=.5;a.anchor.y=.5;return a});0==pool.Size("expl")&&pool.Fill("expl",4,function(){var a=CObj.createMovieClip("Boom");a.anchor.x=.5;a.anchor.y=.5;a.scale.x=1;a.scale.y=1;return a});0==pool.Size("blood")&&pool.Fill("blood",11,function(){var a=CObj.createMovieClip("blood");a.anchor.x=.5;a.anchor.y=.5;a.scale.x=1;a.scale.y=
1;return a});0==pool.Size("bloodblow")&&pool.Fill("bloodblow",6,function(){var a=CObj.createMovieClip("bloodblow");a.anchor.x=.5;a.anchor.y=.5;a.scale.x*=1;a.scale.y*=1;return a})};GameStage.prototype.removeFade=function(){TweenMax.killTweensOf(gameStage.pauseSprite);gameStage.pauseSprite.parent.removeChild(gameStage.pauseSprite);gameStage.pauseSprite=null;PIXI.Texture.removeTextureFromCache(gameStage.pauseTexture);gameStage.pauseTexture&&(gameStage.pauseTexture.destroy(),gameStage.pauseTexture=null)};
GameStage.prototype.fadeScreen=function(){gameStage.pauseSprite=new PIXI.Graphics;gameStage.pauseSprite.beginFill(5636061,.4);gameStage.pauseSprite.drawRect(0,0,SCR_WIDTH,SCR_HEIGHT);gameStage.pauseSprite.endFill();gameStage.pauseSprite.alpha=0;gameStage.pauseSprite.blendMode=PIXI.blendModes.DIFFERENCE;new TweenMax(gameStage.pauseSprite,1.1,{alpha:1,ease:Elastic.easeOut});SM.inst.guiLayer.addChild(gameStage.pauseSprite)};
GameStage.prototype.unpause=function(){gameStage.doProcess=!0;gameStage.player&&(gameStage.player.gfx.autoUpdate=!0);PauseTimer.resume()};GameStage.prototype.pause=function(){gameStage.doProcess&&(gameStage.doProcess=!1,gameStage.player&&(gameStage.player.gfx.autoUpdate=!1),PauseTimer.pause())};GameStage.prototype.updateSoundBtn=function(a){ZSound.available?a.gfx.gotoAndStop(0):a.gfx.gotoAndStop(1)};function Credits(){CustomStage.apply(this)}extend(Credits,CustomStage);
Credits.prototype.onShow=function(){this.doProcess=!1;CustomStage.prototype.onShow.call(this);LevelManager.loadLevel("credits",this.onShowContinue)};
Credits.prototype.onShowContinue=function(){credStage.doProcess=!0;gameStage.createPools();var a=new CObj(SCR_WIDTH/2,SCR_HEIGHT/2,"BG2");a.gfx.parent.removeChild(a.gfx);a.gfx.width=SCR_WIDTH;a.gfx.height=SCR_HEIGHT;SM.inst.ol.addChildAt(a.gfx,0);var a=CObj.getById("cd1"),b=CObj.getById("cd2"),c=CObj.getById("cd3"),d=CObj.getById("cd4");a.gfx.alpha=.01;b.gfx.alpha=.01;c.gfx.alpha=.01;d.gfx.alpha=.01;a.gfx.scale.x=.01;b.gfx.scale.x=.01;c.gfx.scale.x=.01;d.gfx.scale.x=.01;a.gfx.scale.y=.01;b.gfx.scale.y=
.01;c.gfx.scale.y=.01;d.gfx.scale.y=.01;a.rotation=-.1;b.rotation=-.1;c.rotation=-.1;d.rotation=-.1;new TweenMax(a.gfx.scale,.7,{delay:.8,x:1,y:1});new TweenMax(a.gfx,.7,{delay:.8,alpha:1});new TweenMax(a,.7,{delay:.8,rotation:0,yoyo:!0,repeat:2});new TweenMax(b.gfx.scale,.7,{delay:.9,x:1,y:1});new TweenMax(b.gfx,.7,{delay:.9,alpha:1});new TweenMax(b,.7,{delay:.9,rotation:0,yoyo:!0,repeat:2});new TweenMax(c.gfx.scale,.7,{delay:2.8,x:1,y:1});new TweenMax(c.gfx,.7,{delay:2.8,alpha:1});new TweenMax(c,
.7,{delay:2.8,rotation:0,yoyo:!0,repeat:2});new TweenMax(d.gfx.scale,.7,{delay:2.9,x:1,y:1});new TweenMax(d.gfx,.7,{delay:2.9,alpha:1});new TweenMax(d,.7,{delay:2.9,rotation:0,yoyo:!0,repeat:2});CObj.getById("bback").click=function(){SM.inst.openStage(mainMenu)};TweenMax.delayedCall(.6,function(){CObj.getById("wall5").destroy()})};Credits.prototype.onHide=function(a){CustomStage.prototype.onHide.call(this,null);CObj.destroyAll();CObj.processAll();TweenMax.killAll()};
Credits.prototype.process=function(){world.step(gameStage.invFR);Generator.resetElectricity();if(Generator.gens){var a=Generator.gens.length;if(Generator.gens)for(var b=0;b<a;++b)Generator.gens[b].genProcess()}a=CObj.objects.length;for(b=0;b<a;++b)CObj.objects[b].isConductor&&CObj.objects[b]!=this.dragObject&&CObj.objects[b].setElectricity(CObj.objects[b].sElectricity);CObj.processAll()};function AchStage(){CustomStage.apply(this)}extend(AchStage,CustomStage);
AchStage.prototype.onShow=function(){this.doProcess=!1;charStage.unreadAch=!1;CustomStage.prototype.onShow.call(this);LevelManager.loadLevel("levach",this.onShowContinue)};AchStage.prototype.createDesc=function(){var a=crsp("yashick");a.interactive=!1;a.anchor.x=-.2;a.anchor.y=-.2;var b=CTextField.createTextField({align:"left",fontSize:"24"});a.addChild(b);b.x=20;b.y=10;b=CTextField.createTextField({align:"left",fontSize:"24"});b.x=20;a.addChild(b);a.alpha=0;return a};
AchStage.prototype.updateDesc=function(a){var b=achStage.desc.getChildAt(0),c=achStage.desc.getChildAt(1);b.text=a.name;(c.text=a.desc)&&c.updateText();a.name&&b.updateText()};
AchStage.prototype.updateAchievements=function(){for(var a=0;a<PlayerData.inst.achs_progress.length;++a){for(var b=PlayerData.inst.achs_progress[a].id_ach,c=0;c<PlayerData.inst.achs.length&&PlayerData.inst.achs[c].id!=b;++c);b=PlayerData.inst.achs[c];achObject=1>PlayerData.inst.achs_progress[a].progress?crsp("empty orden"):crsp(b.gfx);achObject.x=95+a%4*200;achObject.y=120+220*Math.floor(a/4);achObject.width=90;achObject.scale.y=achObject.scale.x;achObject.anchor.x=.5;achObject.anchor.y=.5;achObject.interactive=
!0;b=CTextField.createTextField({text:b.desc,align:"center",fontSize:"17"});b.x=achObject.x-b.width/2;b.y=achObject.y+100;achStage.bar.container.addChild(b);achStage.bar.container.addChild(achObject)}achStage.bar.pos=0};AchStage.prototype.onHide=function(a){CustomStage.prototype.onHide.call(this,null);CObj.destroyAll();CObj.processAll()};
AchStage.prototype.onShowContinue=function(){achStage.doProcess=!0;CObj.getById("btnback2").click=function(){SM.inst.openStage(charStage)};achStage.bar=new CScrollbar(400,338,"",SCR_WIDTH,524,"ordena background 1 px.png");achStage.bar.gfx.parent.removeChild(achStage.bar.gfx);SM.inst.bg.addChild(achStage.bar.gfx);achStage.updateAchievements()};AchStage.prototype.process=function(){CObj.processAll()};function CharStage(){CustomStage.apply(this)}extend(CharStage,CustomStage);
CharStage.prototype.onShow=function(){this.doProcess=this.unreadActions=this.unreadAch=!1;charStage.skipFriends=0;CustomStage.prototype.onShow.call(this);charStage.icons=[];ZSound.PlayMusic("m_room");LevelManager.loadLevel("levchar",function(){shopStage.createStatsPanel(charStage.onShowContinue)},SM.inst.ol)};
CharStage.prototype.onHide=function(a){for(a=0;a<charStage.icons.length;++a)charStage.icons[a].texture.destroy(!0);charStage.eventsArray=[];for(a=0;a<CObj.objects.length;++a)CObj.checkType(CObj.objects[a],CEActionGUI)&&charStage.eventsArray.push({id:CObj.objects[a].eventpl.id,acting:CObj.objects[a].acting,startTime:CObj.objects[a].startTime,execTime:CObj.objects[a].execTime,pos:CObj.objects[a].pos});charStage.icons=null;charStage.pl=null;charStage.frp.parent.removeChild(charStage.frp);charStage.frp=
null;CustomStage.prototype.onHide.call(this,null);CObj.destroyAll();CObj.processAll()};
CharStage.prototype.createFriendsPanel=function(){for(var a=new PIXI.DisplayObjectContainer,b="",c=[],d=charStage.skipFriends,e=0+d;e<5+d;++e){var f=new CButton(91+95*(e-d),5,"add friend"),g=f.gfx;g.parent.removeChild(g);f.fontFamily="dedgamedesc";f.fontSize=14;f.tint=16777215;g.anchor.x=.5;g.anchor.y=.5;f.hover=!0;f.deltaHoverY=17;vkparams.friendsIngame&&e<vkparams.friendsIngame.length&&(f.text=vkparams.friendsIngame[e].name+" "+vkparams.friendsIngame[e].last_name);f.addToSameLayer=!0;f.init();a.addChild(g);
if(!vkparams.friendsIngame||e>=vkparams.friendsIngame.length)g.click=function(){VK.callMethod("showInviteBox")};else{var f=function(a,b,c){c.click=function(){VK.api("wall.post",{owner_id:b,message:a+", \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0439\u0441\u044f \u0432 \u0438\u0433\u0440\u0443, \u0434\u0440\u0443\u0436\u0438\u0449\u0435\nhttps://vk.com/app4654201",attachments:["photo90523698_359515858","https://vk.com/app4654201"]},function(a){})}},k=vkparams.friendsIngame[e].name,h=vkparams.friendsIngame[e].vkapi;
k&&h&&f(k,h,g);vkparams.friendsIngame[e].vkapi&&(""!=b&&(b+=","),b+=vkparams.friendsIngame[e].vkapi.toString(),g.vkapi=vkparams.friendsIngame[e].vkapi);c.push(g)}}VK&&""!=b&&VK.api("users.get",{user_ids:b,fields:"photo"},function(a){if(a.response)for(var b=0;b<a.response.length;++b){var d=a.response[b].photo;if(!a.response||0==a.response.length)break;var e=c[b];e.loader=new PIXI.ImageLoader(d);(function(a,b){a.loader.onLoaded=function(){var c=new PIXI.Sprite(PIXI.TextureCache[b]);c.anchor.x=.5;c.anchor.y=
.5;a.addChild(c);charStage.icons.push(c)}})(e,d);e.loader.load()}});a.x=215;a.y=SCR_HEIGHT-50;SM.inst.guiLayer.addChild(a);return a};
CharStage.prototype.openPremiumWindow=function(){CObj.enableButtons(!1);charStage.disableWnd=SM.inst.addDisableWindow(null,SM.inst.fontLayer);LevelManager.loadLevel("levelpremium",function(){close=function(){LevelManager.removeLastLevel();CObj.enableButtons(!0);charStage.disableWnd.parent.removeChild(charStage.disableWnd)};charStage.skipFriends=0;orderFunc=function(a){ZSound.Play("buy");order(a);shopStage.updateStatsPanel()};CObj.getById("btnfree").click=function(){VK.callMethod("showOrderBox",{type:"offers",
currency:"true"})};CObj.getById("buy1").click=function(){orderFunc("item1")};CObj.getById("buy2").click=function(){orderFunc("item2")};CObj.getById("buy3").click=function(){orderFunc("item3")};CObj.getById("buy4").click=function(){orderFunc("item4")};CObj.getById("buy5").click=function(){orderFunc("item5")};CObj.getById("buy6").click=function(){orderFunc("item6")};CObj.getById("btnclose").click=close},SM.inst.fontLayer)};
CharStage.prototype.openEnergyWindow=function(){CObj.enableButtons(!1);charStage.disableWnd=SM.inst.addDisableWindow(null,SM.inst.fontLayer);charStage.disableWnd.interactive=!0;LevelManager.loadLevel("energywindow",function(){CObj.getById("breplenish").click=function(){order("item7");VK.orderComplete=function(a){shopStage.updateStatsPanel();close()}};close=function(){rp(charStage.disableWnd);CObj.enableButtons(!0);LevelManager.removeLastLevel();charStage.disableWnd.click=null};charStage.disableWnd.click=
function(){var a=CObj.getById("energybg");a.gfx.getBounds();window.mouseX>a.x-a.gfx.width/2&&window.mouseX<a.x+a.gfx.width/2&&window.mouseY>a.y-a.gfx.height/2&&window.mouseY<a.y+a.gfx.height/2||close()}},SM.inst.fontLayer)};CharStage.prototype.updateMusicButton=function(a){ZSound.available?a.gfx.gotoAndStop(0):a.gfx.gotoAndStop(1);a.click=function(){ZSound.available?ZSound.Mute():ZSound.UnMute();ZSound.available?a.gfx.gotoAndStop(0):a.gfx.gotoAndStop(1)}};
CharStage.prototype.updateNotifications=function(){this.unreadAch?CObj.getById("notach").gfx.visible=!0:CObj.getById("notach").gfx.visible=!1;!this.unreadActions||charStage.bar&&0!=charStage.bar.gfx.visible?CObj.getById("notaction").gfx.visible=!1:CObj.getById("notaction").gfx.visible=!0};
CharStage.prototype.onShowContinue=function(){charStage.doProcess=!0;charStage.updateNotifications();charStage.skip=0;charStage.tab="total";charStage.showRecords=10;PlayerData.inst.eventsplayer.sort(function(a,c){return PlayerData.inst.getEventById(a.id_edevent).reqlvl-PlayerData.inst.getEventById(c.id_edevent).reqlvl});CObj.getById("frprev").click=function(){charStage.skipFriends-=5;0>charStage.skipFriends&&(charStage.skipFriends=0);charStage.frp.parent.removeChild(charStage.frp);charStage.frp=charStage.createFriendsPanel()};
CObj.getById("frnext").click=function(){charStage.skipFriends+=5;charStage.frp.parent.removeChild(charStage.frp);charStage.frp=charStage.createFriendsPanel()};CObj.getById("bbuy1").click=charStage.openPremiumWindow;CObj.getById("bbuy2").click=charStage.openPremiumWindow;CObj.getById("tname").text=vkparams.first_name.toUpperCase()+" "+vkparams.last_name.toUpperCase();CObj.getById("bpubl").click=function(){OpenInNewTab("https://vk.com/thanksgradpa")};charStage.updateMusicButton(CObj.getById("bmusic"));
CObj.getById("bshop").click=function(){SM.inst.openStage(shopStage)};CObj.getById("bscore").click=function(){charStage.openScore()};CObj.getById("btnachs").click=function(){SM.inst.openStage(achStage)};CObj.getById("btnfight").click=function(){if(1<=PlayerData.inst.playerItem.energy)--PlayerData.inst.playerItem.energy,SM.inst.openStage(gameStage);else{var a=CObj.getById("tfenergy"),c=CObj.getById("energyback");new TweenMax(a,.1,{y:a.y-10,repeat:3,yoyo:!0,ease:Linear.easeInOut});new TweenMax(c,.1,
{y:c.y-10,repeat:3,yoyo:!0,ease:Linear.easeInOut});charStage.openEnergyWindow()}};var a=new CPlayer(400,430);charStage.pl=a;a.gfx.scale.x=.34;a.gfx.scale.y=.34;a.updateAppearence(!0,!1,"breath");SM.inst.ol.addChild(a.gfx);a.gfx.interactive=!0;CObj.getById("bsofa").click=function(){CObj.enableButtons(!1);charStage.disableWnd=SM.inst.addDisableWindow(null,SM.inst.fontLayer);charStage.disableWnd.interactive=!0;for(var a=0;a<CObj.objects.length;++a)CObj.checkType(CObj.objects[a],CEActionGUI)&&CObj.objects[a].btnReward&&
(CObj.objects[a].btnReward.gfx.interactive=!0);charStage.closeEventsWnd=function(){rp(charStage.disableWnd);CObj.enableButtons(!0);charStage.bar.gfx.visible=!1};charStage.disableWnd.click=function(){var a=charStage.bar;window.mouseX>a.x-a.gfx.width/2&&window.mouseX<a.x+a.gfx.width/2&&window.mouseY>a.y-a.gfx.height/2&&window.mouseY<a.y+a.gfx.height/2||charStage.closeEventsWnd()};charStage.bar.gfx.parent.removeChild(charStage.bar.gfx);SM.inst.fontLayer.addChild(charStage.bar.gfx);charStage.bar.gfx.visible=
!0;charStage.unreadActions=!1;charStage.updateNotifications()};PlayerData.inst.comboCheck();charStage.bar=new CScrollbar(180,309,"",380,524,"podlozhka actions.png","scroll line actions.png","scroll.png",50);charStage.bar.gfx.scale.x=.7;charStage.bar.gfx.scale.y=.7;charStage.bar.gfx.visible=!1;charStage.updateEvents();shopStage.updateStatsPanel();charStage.frp=charStage.createFriendsPanel()};
CharStage.prototype.updateEvents=function(){charStage.bar.clear();for(var a=0;a<PlayerData.inst.eventsplayer.length;++a){var b=new CEActionGUI(50,70+150*a),c=PlayerData.inst.getEventById(PlayerData.inst.eventsplayer[a].id_edevent);b.init(PlayerData.inst.eventsplayer[a],c,c.gfx,"progress fore.png","progress bg.png");b.updateGraphics();charStage.eventsArray&&(c=findByProp(charStage.eventsArray,"id",PlayerData.inst.eventsplayer[a].id))&&(b.acting=c.acting,b.startTime=c.startTime,b.execTime=c.execTime,
b.pos=c.pos,b.acting&&(b.progressbg.visible=!0,b.progressfore.visible=!0));charStage.bar.container.addChild(b.gfx)}charStage.bar.updateHeight();charStage.bar.pos=0};
CharStage.prototype.process=function(){shopStage.updateEnergyText();CObj.processAll();for(var a=0,b=0;b<CObj.objects.length;++b)if(CObj.checkType(CObj.objects[b],CEActionGUI)&&CObj.objects[b].acting){var c=(window.time-CObj.objects[b].startTime)/CObj.objects[b].execTime;1<=c?(CObj.objects[b].pos=1,CObj.objects[b].endAction(),this.unreadActions=!0,this.updateNotifications()):CObj.objects[b].pos=c;a++}};
CharStage.prototype.updateFriends=function(){PlayerData.inst.savePlayerData();azureclient.invokeApi("get_scores",{body:{filter:vkparams.friendsIngameIDs,take:charStage.showRecords,skip:charStage.skip},method:"post"}).done(function(a){charStage.updateSB(a.result)},function(a){})};CharStage.prototype.updateTotal=function(){azureclient.invokeApi("get_scores",{body:{filter:null,take:charStage.showRecords,skip:charStage.skip},method:"post"}).done(function(a){charStage.updateSB(a.result)},function(a){})};
CharStage.prototype.openScore=function(){CObj.enableButtons(!1);charStage.disableWnd=SM.inst.addDisableWindow(null,SM.inst.fontLayer);LevelManager.loadLevel("levscore",function(){charStage.container=new PIXI.DisplayObjectContainer;charStage.container.x=170;charStage.container.y=170;SM.inst.fontLayer.addChild(charStage.container);var a="0";PlayerData.inst.playerItem.maxdistance&&(a=PlayerData.inst.playerItem.maxdistance.toString());var b="";PlayerData.inst.playerItem.rank&&(b=PlayerData.inst.playerItem.rank.toString()+
".");CObj.getById("tplscore").text=a+"\u043c.";CObj.getById("tplace").text=b;CObj.getById("bfriends").click=function(){charStage.skip=0;"friends"==charStage.tab?(CObj.getById("bfriends").text="\u0412\u0441\u0435 \u043e\u0447\u043a\u0438",charStage.tab="total",charStage.updateTotal()):(CObj.getById("bfriends").text="\u041e\u0447\u043a\u0438 \u0434\u0440\u0443\u0437\u0435\u0439",charStage.tab="friends",charStage.updateFriends())};charStage.tab="friends";CObj.getById("bfriends").click();CObj.getById("bforwardlist").click=
function(){charStage.skip+=charStage.showRecords;"total"==charStage.tab&&charStage.updateTotal();"friends"==charStage.tab&&charStage.updateFriends()};CObj.getById("bback").click=function(){CObj.enableButtons(!0);for(LevelManager.removeLastLevel();0<charStage.container.children.length;)rp(charStage.container.getChildAt(0));rp(charStage.container);rp(charStage.disableWnd);charStage.container=null};CObj.getById("bbacklist").click=function(){charStage.skip-=charStage.showRecords;0>charStage.skip&&(charStage.skip=
0);"total"==charStage.tab&&charStage.updateTotal();"friends"==charStage.tab&&charStage.updateFriends()}},SM.inst.fontLayer)};
CharStage.prototype.updateSB=function(a){for(;0<charStage.container.children.length;)rp(charStage.container.getChildAt(0));for(var b=[],c="",d=0;d<a.length;++d){var e=new PIXI.DisplayObjectContainer,f=CTextField.createTextField({tint:3355443,fontSize:17,text:(charStage.skip+d+1).toString()+"."}),g=CTextField.createTextField({tint:3355443,fontSize:17,text:extractName(a[d])}),k=CTextField.createTextField({tint:3355443,fontSize:17,text:Math.round(a[d].maxdistance).toString()+"\u043c."}),h=crsp("ava cover");
b.push(h);b[d].vkapi=a[d].vkapi;""!=c&&(c+=",");c+=a[d].vkapi;if(3>charStage.skip+d){var l;0==charStage.skip+d&&(l="1st place");1==charStage.skip+d&&(l="2nd place");2==charStage.skip+d&&(l="3rd place");var m=crsp(l);m.x=4;m.y=10;m.scale.x=.8;m.scale.y=.8;e.addChild(m)}h.y=10;h.x=35;e.x=20;e.y=15+28*d;g.x=55;k.x=370;e.addChild(h);e.addChild(g);e.addChild(f);e.addChild(k);charStage.container.addChild(e)}VK&&""!=c&&VK.api("users.get",{user_ids:c,fields:"photo"},function(a){if(a.response)for(var c=0;c<
a.response.length;++c){var d=a.response[c].photo;if(!a.response||0==a.response.length)break;var e=b[c];e.loader=new PIXI.ImageLoader(d);(function(a,b){a.loader.onLoaded=function(){var c=new PIXI.Sprite(PIXI.TextureCache[b]);c.scale.x=.5;c.scale.y=.5;c.anchor.x=.5;c.anchor.y=.5;a.addChild(c)}})(e,d);e.loader.load()}})};function ShopStage(){CustomStage.apply(this)}extend(ShopStage,CustomStage);
ShopStage.prototype.createStatsPanel=function(a){setHover=function(a,c){a.gfx.interactive=!0;a.gfx.mouseover=function(a){var b=CObj.getById("descpanel");b&&setTimeout(function(){b.text=c;CObj.getById("descbg").gfx.visible=!0},100)};a.gfx.mouseout=function(a){var b=CObj.getById("descpanel");b&&setTimeout(function(){b.text=" ";CObj.getById("descbg").gfx.visible=!1},0)}};LevelManager.loadLevel("upperPanel",function(){CObj.getById("descbg").gfx.visible=!1;CObj.getById("descpanel").text=" ";setHover(CObj.getById("xpback"),
"\u0428\u043a\u0430\u043b\u0430 \u0443\u0432\u0430\u0436\u0435\u043d\u0438\u044f \u0432\u0435\u0442\u0435\u0440\u0430\u043d\u043e\u0432. \u0411\u043e\u043b\u044c\u0448\u0435 \u0443\u0432\u0430\u0436\u0435\u043d\u0438\u044f - \u0432\u044b\u0448\u0435 \u0443\u0440\u043e\u0432\u0435\u043d\u044c \u0434\u0435\u0434\u0430");setHover(CObj.getById("moneyback"),"\u041c\u043e\u043d\u0435\u0442\u044b. \u041d\u0443\u0436\u043d\u044b \u0434\u043b\u044f \u043f\u043e\u043a\u0443\u043f\u043a\u0438 \u043d\u043e\u0432\u044b\u0445 \u0432\u0435\u0449\u0435\u0439");
setHover(CObj.getById("energyback"),"\u0411\u0438\u043e\u0434\u043e\u0431\u0430\u0432\u043a\u0438 \u043d\u0443\u0436\u043d\u044b \u0434\u0435\u0434\u0443, \u0447\u0442\u043e\u0431\u044b \u0432\u043e\u0435\u0432\u0430\u0442\u044c");setHover(CObj.getById("starback"),"\u0417\u0432\u0435\u0437\u0434\u044b. \u041e\u043d\u0438 \u043e\u0431\u043b\u0435\u0433\u0447\u0430\u044e\u0442 \u0438\u0433\u0440\u043e\u0432\u043e\u0439 \u043f\u0440\u043e\u0446\u0435\u0441\u0441");a()},SM.inst.ol)};
ShopStage.prototype.onShow=function(){azureclient.getTable("tb_players").update(PlayerData.inst.playerItem);LevelManager.loadLevel("levshop",function(){shopStage.createStatsPanel(shopStage.onShowContinue)})};ShopStage.prototype.checkEq=function(a){for(var b=0;b<PlayerData.inst.items_enabled.length;++b)if(PlayerData.inst.items_enabled[b].id_item==a.id&&1==PlayerData.inst.items_enabled[b].equipped)return!0;return!1};
ShopStage.prototype.checkOwned=function(a){for(var b=0;b<PlayerData.inst.items_enabled.length;++b)if(a.id==PlayerData.inst.items_enabled[b].id_item)return!0;return!1};ShopStage.prototype.unequipAll=function(){for(var a=0;a<PlayerData.inst.items_enabled.length;++a)PlayerData.inst.getItemById(PlayerData.inst.items_enabled[a].id_item).type==shopStage.currentFilter&&(PlayerData.inst.items_enabled[a].equipped=!1)};
ShopStage.prototype.buyItem=function(a,b){var c=a.target.btn.item;!b&&0<c.price&&PlayerData.inst.playerItem.money>=c.price||b&&0<c.pricecrys&&PlayerData.inst.playerItem.crystals>=c.pricecrys?(shopStage.transScreen=SM.inst.addDisableWindow("\u041f\u0420\u041e\u0412\u041e\u0414\u0418\u0422\u0421\u042f \u0422\u0420\u0410\u041d\u0417\u0410\u041a\u0426\u0418\u042f\n\u041f\u041e\u0416\u0410\u041b\u0423\u0419\u0421\u0422\u0410 \u041f\u041e\u0414\u041e\u0416\u0414\u0418\u0422\u0415"),b&&0<c.pricecrys?PlayerData.inst.playerItem.crystals-=
c.pricecrys:PlayerData.inst.playerItem.money-=c.price,ZSound.Play("buy"),azureclient.invokeApi("buy_item",{body:{id_item:c.id,id_player:PlayerData.inst.playerItem.id},method:"post"}).done(function(a){shopStage.updateStatsPanel();PlayerData.inst.savePlayerData(function(){PlayerData.inst.loadData(function(){incMetric("BUY ITEM"+c.name);PlayerData.inst.equipItem(c);shopStage.pl.updateAppearence(!0,!1,null,null,null);shopStage.updateBar(shopStage.currentTab,shopStage.currentFilter,shopStage.bar.pos);
shopStage.updateStatsPanel();shopStage.transScreen.parent.removeChild(shopStage.transScreen);shopStage.transScreen=null})},function(a){shopStage.transScreen.parent.removeChild(shopStage.transScreen);shopStage.transScreen=null})})):charStage.openPremiumWindow()};
ShopStage.prototype.createItemBtn=function(a){function b(a){shopStage.buyItem(a,!0)}function c(b){PlayerData.inst.equipItem(a);shopStage.pl.updateAppearence(!0,!1,null,null,null);shopStage.updateBar(shopStage.currentTab,shopStage.currentFilter,shopStage.bar.pos)}function d(a){shopStage.buyItem(a,!1)}var e=new PIXI.DisplayObjectContainer,f="bstuff"==shopStage.currentTab;if(f){var g=PlayerData.inst.getUpgrade(a),k=g.upgr;if(g.idNext)a=PlayerData.inst.getItemById(g.idNext);else{var h=!0;a=PlayerData.inst.getItemById(g.id)}}var l=
crsp(a.gfx);l.x=0;l.scale.x=.5;l.scale.y=.5;l.y=l.height/2;e.addChild(l);l.interactive=!0;l.mouseover=function(b){if(a.type==tWeapon||a.type==tApp+tHat){var c=b=null;a.type==tWeapon&&(c=a.gfx);a.type==tApp+tHat&&(b=a.gfx);shopStage.pl.updateAppearence(!0,!1,null,c,b)}TweenMax.killTweensOf(l.scale);l.tint=CButton.tintColor;new TweenMax(l.scale,.6,{y:.55,ease:Elastic.easeOut});new TweenMax(l.scale,.4,{x:.55,ease:Elastic.easeOut});c=a.desc.split("|");b=c[0];1<c.length&&(b=c[1]);c=CObj.getById("tfdescd");
c.setTextSafe(b);c.item=a};l.mouseout=function(b){b=CObj.getById("tfdescd");b.item==a&&b.setTextSafe("");a.type!=tWeapon&&a.type!=tApp+tHat||shopStage.pl.updateAppearence(!0,!1,null,null,null);l.tint=16777215;l.currentFrame&&l.gotoAndStop(1);new TweenMax(l.scale,.3,{x:.5,y:.5,ease:Elastic.easeOut})};if(f)for(var m=0;5>m;++m){var n=m<k?crsp("improve point on"):crsp("improve point off");n.x=25*(m-2);n.scale.x=.8;n.scale.y=.8;n.y=3;e.addChild(n)}m=this.checkOwned(a);n=this.checkEq(a);tftext="";f&&(h?
tftext="":m||(tftext=0>a.pricecrys&&0>a.price?"":0<a.pricecrys?a.pricecrys.toString():a.price.toString()));var q,h="",p="buy button",r;!m||f?f&&5==k?p="equipped button":a.reqlvl>PlayerData.inst.playerItem.lvl?(q=b,p="unlock button",h="\u041c\u0418\u041d "+a.reqlvl.toString()+" \u0423\u0420.",r="price star.png",tftext=a.pricecrys.toString()):(q=d,r="price coin.png",p="buy button",tftext=a.price.toString()):1==n?p="equipped button":(q=c,p="wear button");k=new CButton(0,129,p);"equipped button"==p&&
(k.gfx.mouseout=null,k.gfx.mouseover=null);k.fontSize=33;k.addToSameLayer=!0;k.gfx.anchor.x=.5;k.gfx.anchor.y=.5;k.gfx.scale.x=.8;k.gfx.scale.y=.8;k.init();k.gfx.parent.removeChild(k.gfx);k.item=f?PlayerData.inst.getItemById(g.idNext):a;k.gfx.btn=k;k.click=q;e.addChild(k.gfx);k.text&&(k.text=k.text);e.btn=k;tftext&&r&&(f=crsp(r),f.x=0,f.y=80,f.scale.x=.75,f.scale.y=.75,e.addChild(f));f=new CTextField;f.tint="0x333333";f.fontSize=15;f.align="center";f.init();e.infoTF=f;f.x=0;f.y=158;f.gfx.parent.removeChild(f.gfx);
f.text=h;e.addChild(f.gfx);f=new CTextField;f.tint="0x333333";f.fontSize=15;f.align="center";f.text=tftext;f.init();e.tfprice=f;f.x=10;f.y=70;f.gfx.parent.removeChild(f.gfx);e.addChild(f.gfx);f.text=f.text;e.destroy=function(){e.tfprice.destroy();e.btn&&(e.btn.destroy(),e.btn=null);e.tfprice=null;e.parent.removeChild(e)};return e};
ShopStage.prototype.updateBar=function(a,b,c){shopStage.updateStatsPanel();shopStage.currentTab=a;shopStage.currentFilter=b;CObj.getById("bstuff").gfx.alpha=.1;CObj.getById("bweap").gfx.alpha=.1;CObj.getById("bcloth").gfx.alpha=.1;CObj.getById(a).gfx.alpha=1;for(var d=0;d<this.bar.container.children.length;++d)this.bar.container.children[d].destroy(),d--;var e=2;"bweap"==a&&(e=2);a=this.bar.gfx.width/e-6;for(var f=0,d=0;d<PlayerData.inst.items.length;++d)if(!(0>PlayerData.inst.items[d].type.indexOf(b)||
0<=PlayerData.inst.items[d].name.indexOf("$"))){var g=shopStage.createItemBtn(PlayerData.inst.items[d]);g.x=a/2+f%e*a;g.y=40+195*Math.floor(f/e);this.bar.container.addChild(g);f++}c||(c=0);this.bar.pos=c};
ShopStage.prototype.updateStatsPanel=function(){var a=CObj.getById("bar");a.gfx.width=200;var b=PlayerData.inst.playerItem.xp,c=PlayerData.inst.xpLevel[PlayerData.inst.playerItem.lvl].xp;a.prop=b/c;CObj.getById("tflev").text=PlayerData.inst.playerItem.lvl.toString();CObj.getById("bar").gfx.parent||SM.inst.fg.addChild(CObj.getById("bar").gfx);CObj.getById("tfexp").text=Math.floor(b).toString()+"/"+Math.floor(c).toString();CObj.getById("tfmoney").text=PlayerData.inst.playerItem.money.toString();CObj.getById("tfcry").text=
PlayerData.inst.playerItem.crystals.toString();CObj.getById("tfenergy").text=Math.floor(PlayerData.inst.playerItem.energy).toString()};
ShopStage.prototype.onShowContinue=function(){CustomStage.prototype.onShow.call(this);CObj.getById("photo").click=function(){vkparams.novk||(CObj.enableButtons(!1),shopStage.transScreen=SM.inst.addDisableWindow("\u0424\u041e\u0422\u041e\u0413\u0420\u0410\u0424\u0418\u0420\u0423\u0415\u041c... \u041e\u0416\u0418\u0414\u0410\u0419\u0422\u0415"),uploadPhoto(vkparams.viewerid,!1,function(){CObj.enableButtons(!0);rp(shopStage.transScreen);shopStage.transScreen=null}))};CObj.getById("ava").click=function(){vkparams.novk||
(CObj.enableButtons(!1),shopStage.transScreen=SM.inst.addDisableWindow("\u0424\u041e\u0422\u041e\u0413\u0420\u0410\u0424\u0418\u0420\u0423\u0415\u041c... \u041e\u0416\u0418\u0414\u0410\u0419\u0422\u0415"),uploadPhoto(vkparams.viewerid,!0,function(){CObj.enableButtons(!0);rp(shopStage.transScreen);shopStage.transScreen=null}))};shopStage.bar=new CScrollbar(610,335,"",380,524);shopStage.bar.gfx.parent.removeChild(shopStage.bar.gfx);SM.inst.ol.addChildAt(shopStage.bar.gfx,1);shopStage.updateStatsPanel();
CObj.getById("bbuy1").click=charStage.openPremiumWindow;CObj.getById("bbuy2").click=charStage.openPremiumWindow;CObj.getById("bback").click=function(){SM.inst.openStage(charStage)};CObj.getById("bstuff").click=function(){shopStage.updateBar("bstuff",tBoost)};CObj.getById("bweap").click=function(){shopStage.updateBar("bweap",tWeapon)};CObj.getById("bcloth").click=function(){shopStage.updateBar("bcloth",tApp)};shopStage.updateBar("bstuff",tBoost);var a=new CPlayer(180,400);shopStage.pl=a;shopStage.pl.updateAppearence(!0,
!1,"breath",null,null);a.gfx.scale.x=.4;a.gfx.scale.y=.4;SM.inst.ol.addChild(a.gfx)};function levelClick(a){gameStage.currentLevel=a.target.levelNum;SM.inst.openStage(gameStage)}ShopStage.prototype.onHide=function(a){shopStage.pl=null;CustomStage.prototype.onHide.call(this,null);CObj.destroyAll();CObj.processAll()};
ShopStage.prototype.updateEnergyText=function(){var a=CObj.getById("tfdelay");if(a&&1>PlayerData.inst.playerItem.energy){if(Math.round(PlayerData.inst.playerItem.energy)<Math.round(PlayerData.inst.maxEnergy)){var b=dateDiff(PlayerData.inst.playerItem.updateDate,PlayerData.inst.delayEnergyMS/6E4);a.text=b.timeString}else a.text="";a.gfx.visible=!0}else a.gfx.visible=!1};ShopStage.prototype.process=function(){this.updateEnergyText();CObj.processAll()};function ScoreStage(){CustomStage.apply(this)}
extend(ScoreStage,CustomStage);ScoreStage.prototype.updateFriends=function(){PlayerData.inst.savePlayerData();azureclient.invokeApi("get_scores",{body:{filter:vkparams.friendsIngameIDs,take:scoreStage.showRecords,skip:scoreStage.skip},method:"post"}).done(function(a){scoreStage.updateSB(a.result)},function(a){})};
ScoreStage.prototype.updateTotal=function(){azureclient.invokeApi("get_scores",{body:{filter:null,take:scoreStage.showRecords,skip:scoreStage.skip},method:"post"}).done(function(a){scoreStage.updateSB(a.result)},function(a){})};
ScoreStage.prototype.updateSB=function(a){for(;0<scoreStage.container.children.length;)rp(scoreStage.container.getChildAt(0));for(var b=[],c="",d=0;d<a.length;++d){var e=new PIXI.DisplayObjectContainer,f=CTextField.createTextField({tint:3355443,fontSize:15,text:(scoreStage.skip+d+1).toString()+"."}),g=CTextField.createTextField({tint:3355443,fontSize:15,text:a[d].name+" "+a[d].last_name}),k=CTextField.createTextField({tint:3355443,fontSize:15,text:Math.round(a[d].maxdistance).toString()+"\u043c."}),
h=crsp("buy small button");b.push(h);b[d].vkapi=a[d].vkapi;""!=c&&(c+=",");c+=a[d].vkapi;if(3>scoreStage.skip+d){var l;0==scoreStage.skip+d&&(l="1st place");1==scoreStage.skip+d&&(l="2nd place");2==scoreStage.skip+d&&(l="3rd place");var m=crsp(l);m.x=4;m.y=10;m.scale.x=.8;m.scale.y=.8;e.addChild(m)}h.y=10;h.x=35;e.x=20;e.y=15+28*d;g.x=55;k.x=370;e.addChild(h);e.addChild(g);e.addChild(f);e.addChild(k);scoreStage.container.addChild(e)}VK&&""!=c&&VK.api("users.get",{user_ids:c,fields:"photo"},function(a){for(var c=
0;c<a.response.length;++c){var d=a.response[c].photo;if(!a.response||0==a.response.length)break;var e=b[c];e.loader=new PIXI.ImageLoader(d);(function(a,b){a.loader.onLoaded=function(){var c=new PIXI.Sprite(PIXI.TextureCache[b]);c.scale.x=.5;c.scale.y=.5;c.anchor.x=.5;c.anchor.y=.5;a.addChild(c)}})(e,d);e.loader.load()}})};
ScoreStage.prototype.onShow=function(){CustomStage.prototype.onShow.call(this);scoreStage.skip=0;scoreStage.tab="total";scoreStage.showRecords=10;LevelManager.loadLevel("levscore",this.onShowContinue);scoreStage.container=new PIXI.DisplayObjectContainer;scoreStage.container.x=170;scoreStage.container.y=170;SM.inst.ol.addChild(scoreStage.container)};
ScoreStage.prototype.onHide=function(a){for(;0<scoreStage.container.children.length;)rp(scoreStage.container.getChildAt(0));CustomStage.prototype.onHide.call(this,null);CObj.destroyAll();CObj.processAll()};
ScoreStage.prototype.onShowContinue=function(){CObj.getById("tplscore").text=PlayerData.inst.playerItem.maxdistance.toString()+"\u043c.";CObj.getById("tplace").text=PlayerData.inst.playerItem.rank.toString()+".";CObj.getById("bfriends").click=function(){scoreStage.skip=0;"friends"==scoreStage.tab?(CObj.getById("bfriends").text="\u0412\u0441\u0435 \u043e\u0447\u043a\u0438",scoreStage.tab="total",scoreStage.updateTotal()):(CObj.getById("bfriends").text="\u041e\u0447\u043a\u0438 \u0434\u0440\u0443\u0437\u0435\u0439",
scoreStage.tab="friends",scoreStage.updateFriends())};CObj.getById("bfriends").click();CObj.getById("bforwardlist").click=function(){scoreStage.skip+=scoreStage.showRecords;"total"==scoreStage.tab&&scoreStage.updateTotal();"friends"==scoreStage.tab&&scoreStage.updateFriends()};CObj.getById("bback").click=function(){SM.inst.openStage(charStage)};CObj.getById("bbacklist").click=function(){scoreStage.skip-=scoreStage.showRecords;0>scoreStage.skip&&(scoreStage.skip=0);"total"==scoreStage.tab&&scoreStage.updateTotal();
"friends"==scoreStage.tab&&scoreStage.updateFriends()}};ScoreStage.prototype.process=function(){CObj.processAll()};function ComixStage(){CustomStage.apply(this)}extend(ComixStage,CustomStage);
ComixStage.prototype.onShow=function(){comixStage.comixContainer=new PIXI.DisplayObjectContainer;SM.inst.ol.addChild(comixStage.comixContainer);this.buttonNext=new CButton(SCR_WIDTH-60,SCR_HEIGHT-60,"next button");this.buttonNext.gfx.width=80;this.buttonNext.gfx.scale.y=this.buttonNext.gfx.scale.x;this.buttonNext.fontSize=17;this.buttonNext.hover=!1;this.buttonNext.click=function(){comixStage.goNext()};this.buttonNext.init();this.buttonNext.gfx.interactive=!0;this.comixData=[{frame:"ded clicking",
duration:5.5,objects:[{tex:"1top_frame.png",s1:[1.5,1.5],s2:[1,1],rot1:-.05,rot2:0,vx:0,vy:-.1,p1:[SCR_WIDTH/2,15+SCR_HEIGHT/4-450],p2:[SCR_WIDTH/2,15+SCR_HEIGHT/4],delay:.1,tweenTime:.4,ease:Back.easeOut},{tex:"1buttom_frame.png",s1:[1.5,1.5],s2:[1,1],rot1:.05,rot2:0,vx:0,vy:-.05,p1:[SCR_WIDTH/2-SCR_WIDTH,.75*SCR_HEIGHT-20+400],p2:[SCR_WIDTH/2-25,.75*SCR_HEIGHT-20],delay:1.1,tweenTime:.55,ease:Sine.easeIn},{tex:"1buttom_click.png",rot1:-1,rot2:0,vx:0,vy:-.08,s1:[.1,.1],s2:[1,1],p1:[550,300],p2:[550,
290],delay:1.9,alphaHide:1,tweenTime:.15,ease:Sine.easeIn},{tex:"1buttom_click.png",rot1:-1,rot2:0,vx:0,vy:-.08,s1:[.1,.1],s2:[1,1],p1:[480,360],p2:[480,350],delay:2,alphaHide:1,tweenTime:.15,ease:Sine.easeIn},{tex:"1buttom_click.png",rot1:-1,rot2:0,vx:0,vy:-.08,s1:[.1,.1],s2:[1,1],p1:[520,390],p2:[520,380],delay:2.34,alphaHide:1,tweenTime:.15,ease:Sine.easeIn},{tex:"1top_bubble.png",vx:0,vy:-.08,s1:[.1,.1],s2:[1,1],p1:[540,80],p2:[540,70],delay:3,alphaHide:2.5,tweenTime:.15,ease:Sine.easeIn}]},{frame:"screen",
duration:5.5,objects:[{tex:"2frame.png",s1:[1.2,1.2],s2:[1.1,1.1],vx:0,vy:-.2,p1:[SCR_WIDTH/2,SCR_HEIGHT/2+SCR_HEIGHT],p2:[SCR_WIDTH/2,SCR_HEIGHT/2+15],delay:0,tweenTime:.6,ease:Back.easeOut},{tex:"2frame_comment1.png",vx:0,vy:-.1,p1:[SCR_WIDTH/2-80,SCR_HEIGHT/2+260-20],p2:[SCR_WIDTH/2-80,SCR_HEIGHT/2+110-20],delay:1.4,tweenTime:.4,ease:Back.easeOut},{tex:"2frame_comment2.png",vx:0,vy:-.1,p1:[SCR_WIDTH/2+20,SCR_HEIGHT/2+305-20],p2:[SCR_WIDTH/2+20,SCR_HEIGHT/2+155-20],delay:1.88,tweenTime:.4,ease:Back.easeOut},
{tex:"2frame_comment3.png",vx:0,vy:-.1,p1:[SCR_WIDTH/2+20,SCR_HEIGHT/2+350-20],p2:[SCR_WIDTH/2+20,SCR_HEIGHT/2+200-20],delay:2.3,tweenTime:.35,ease:Back.easeOut}]},{frame:"anger",duration:5.5,objects:[{tex:"StoryBackground.png",vx:0,vy:0,s1:[150,150],p1:[SCR_WIDTH/2,SCR_HEIGHT/2+1.3*SCR_HEIGHT],p2:[SCR_WIDTH/2,SCR_HEIGHT/2],delay:0,tweenTime:.3,ease:Sine.easeIn},{tex:"3frame_top.png",rot1:2,rot2:0,vx:0,vy:.15,p1:[SCR_WIDTH/2+600,SCR_HEIGHT/2-SCR_HEIGHT/4+700],p2:[SCR_WIDTH/2,SCR_HEIGHT/2-120],delay:.45,
tweenTime:.6,ease:Back.easeOut},{tex:"3top_frame_signs.png",va:-4E-4,rot1:-2,rot2:0,vx:0,vy:-.15,p1:[SCR_WIDTH/2+600,SCR_HEIGHT/2-SCR_HEIGHT/4+700],p2:[SCR_WIDTH/2,SCR_HEIGHT/2-120],delay:.45,tweenTime:.6,ease:Back.easeOut},{tex:"3frame_bottom.png",rot1:.05,rot2:0,vx:0,vy:-.15,p1:[SCR_WIDTH/2,SCR_HEIGHT/2-SCR_HEIGHT],p2:[SCR_WIDTH/2,SCR_HEIGHT/2+138],delay:2.7,tweenTime:.33,ease:Back.easeOut}]},{frame:"way of war",duration:5.5,objects:[{tex:"StoryBackground.png",vx:0,vy:0,s1:[150,150],p1:[SCR_WIDTH/
2,SCR_HEIGHT/2+1.3*SCR_HEIGHT],p2:[SCR_WIDTH/2,SCR_HEIGHT/2],delay:0,tweenTime:.3,ease:Sine.easeIn},{tex:"4top_frame2.png",rot1:.5,vx:0,vy:.05,s1:[3,3],s2:[1,1],p1:[1100,-440],p2:[605,160],delay:.2,tweenTime:.45,ease:Back.easeOut},{tex:"4top_frame1.png",vx:0,vy:.07,s1:[3,3],s2:[1,1],p1:[730,-420],p2:[225,180],delay:2,tweenTime:.45,ease:Back.easeOut},{tex:"4frame_bottom.png",s1:[2,2],s2:[.99,.99],vx:0,vy:-.05,p1:[SCR_WIDTH/2,SCR_HEIGHT/2+SCR_HEIGHT],p2:[SCR_WIDTH/2,SCR_HEIGHT/2+138],delay:3.3,tweenTime:.5,
ease:Sine.easeOut},{tex:"4bottom_bubble.png",s1:[2,2],s2:[1.05,1.05],vx:0,vy:-.05,p1:[SCR_WIDTH/2-50,SCR_HEIGHT/2+SCR_HEIGHT],p2:[SCR_WIDTH/2-50,SCR_HEIGHT/2+138],delay:3.36,tweenTime:.5,ease:Sine.easeOut}]}];comixStage.goNext()};
ComixStage.prototype.goNext=function(){comixStage.dcNext&&comixStage.dcNext.kill();TweenMax.killAll(!0,!0,!0);var a=this.comixData.shift();a&&a.objects||SM.inst.openStage(gameStage);for(var b=0;b<a.objects.length;++b){var c=a.objects[b],d=crsp(c.tex);comixStage.comixContainer.addChild(d);d.visible=!1;c.rot1||(c.rot1=0);c.rot2||(c.rot2=0);c.p1||(c.p1=[0,0]);c.p2||(c.p2=c.p1);c.s1||(c.s1=[1,1]);c.s2||(c.s2=c.s1);d.scale.x=1.1*c.s1[0];d.scale.y=1.1*c.s1[1];d.rotation=c.rot1;d.x=c.p1[0];d.y=c.p1[1];d.vx=
0;d.vy=0;d.va=0;c.ease||(c.ease=Sine.easeOut);new TweenMax(d.scale,c.tweenTime,{x:1.1*c.s2[0],y:1.1*c.s2[1],delay:c.delay});(function(a,b){new TweenMax(a,b.tweenTime,{ease:b.ease,rotation:b.rot2,x:b.p2[0],y:b.p2[1],delay:b.delay,onComplete:function(){a.vx=b.vx;a.vy=b.vy;a.va=b.va}})})(d,c);c.delay||(c.delay=0);setVisible=function(a){c.alphaHide&&new TweenMax(a,.1,{delay:c.alphaHide+c.delay,alpha:0});TweenMax.delayedCall(c.delay,function(){a.visible=!0})};setVisible(d)}};
ComixStage.prototype.onHide=function(a){PIXI.TextureCache["2frame.png"].destroy(!0);rp(comixStage.comixContainer);comixStage.comixContainer=null;CObj.destroyAll()};
ComixStage.prototype.process=function(){for(var a=0;a<this.comixContainer.children.length;++a)this.comixContainer.children[a].x+=this.comixContainer.children[a].vx,this.comixContainer.children[a].y+=this.comixContainer.children[a].vy,this.comixContainer.children[a].rotation+=this.comixContainer.children[a].va,this.comixContainer.children[a].vx*=.986,this.comixContainer.children[a].vy*=.986,this.comixContainer.children[a].va*=.986;CObj.processAll()};
ZPool=function(){this.objects={};ZPool.Inst=this;return this};ZPool.prototype.Fill=function(a,b,c){void 0==this.objects[a]&&(this.objects[a]=[]);for(var d=0;d<b;d++){var e=c();e.poolName=a;this.objects[a].push(e)}};ZPool.prototype.Pop=function(a){if(void 0==this.objects[a])console.warn("Error: not found '"+a+"' in pool.");else if(0==this.objects[a].length)console.warn("Error: pool empty. Element '"+a+"'");else return this.objects[a].pop()};
ZPool.prototype.Size=function(a){return void 0==this.objects[a]?0:this.objects[a].length};ZPool.prototype.Push=function(a){void 0==a.poolName?console.warn("Error: Can't push unnamed element in pool."):this.objects[a.poolName].push(a)};
CObj=function(a,b,c,d){CObj.objects||(CObj.objects=[]);CObj.objects.push(this);this.PublicFields="allowRotation,drawAsTexture,userData,[Graphics],isClip,fps,autoPlay,scaleX,scaleY,offsetX,offsetY,offsetR;";this.allowTrackSpeed=!1;this._y=this._x=0;this._sensor=!1;this.av=this.vy=this.vx=0;this._body=null;this.baseDim={};this._rotation=0;this.clipSrc="";this.userData=null;this.oY=this.oX=0;void 0==this.offsetX&&(this.offsetX=0);void 0==this.offsetY&&(this.offsetY=0);void 0==this.offsetR&&(this.offsetR=
0);this.doRemove=!1;this.gravPower=.24;c&&(c=PIXI.Texture.fromFrame(c+".png"),this.gfx=new PIXI.Sprite(c),this.gfx.gameobject=this,this.gfx.anchor.x=.5,this.gfx.anchor.y=.5,LauncherBG.inst?LauncherBG.inst.ol.addChild(this.gfx):SM.inst.ol.addChild(this.gfx));d&&(this.body=d,CObj.setDefaultCG(this.body),this.body.position[0]=a,this.body.position[1]=b);this.bornTime=PauseTimer.getTimer();this.colGroup=this.colMask=0;this.x=a;this.y=b;this.radius=1;this.rotation=0;this.gravityEnabled=!1};
CObj.debugView=!1;
Function.prototype.generateProperty=function(a,b){var c="__"+a;b=b||{};b.get="undefined"===typeof b.get?!0:b.get;b.set="undefined"===typeof b.set?!0:b.set;b.defaultValue&&(this.prototype[c]=b.defaultValue);var d={},e="__get_"+a,f="__set_"+a;this.prototype[e]=!0===b.get?function(){return this[c]}:b.get?b.get:function(){throw Error("Cannot get: "+a);};d.get=function(){return this[e].call(this)};this.prototype[f]=!0===b.set?function(a){this[c]=a}:b.set?b.set:function(){throw Error("Cannot set: "+a);
};d.set=function(a){this[f].call(this,a)};Object.defineProperty(this.prototype,a,d)};CObj.prototype.init=function(){};CObj.prototype.updateElectroGfx=function(a){a.sensor||TweenMax.delayedCall(CObj.updateGfxDelay,a.updateElectroGfx,[a])};CObj.prototype.findFirstConstraint=function(){for(var a=world.constraints.length,b=0;b<a;++b)if(world.constraints[b].bodyA==this.body||world.constraints[b].bodyB==this.body)return world.constraints[b]};CObj.prototype.onContactBegin=function(a){};
CObj.prototype.onContactEnd=function(a){};CObj.prototype.collide=function(a){};
CObj.prototype.process=function(){0!=this.av&&(this.rotation+=this.av*gameStage.slowMoCoef);0!=this.vx&&(this.x+=this.vx*gameStage.slowMoCoef);0!=this.vy&&(this.y+=this.vy*gameStage.slowMoCoef);CObj.debugView&&this.debugGfx&&(this.debugGfx.position.x=this.x,this.debugGfx.position.y=this.y);this.gravityEnabled&&(this.vy+=this.gravPower);this.lifeTime&&this.bornTime-PauseTimer.getTimer()>this.lifeTime&&this.destroy();this.allowTrackSpeed&&(this.x-=LauncherBG.inst.maxVelocity);this.updateGraphics()};
CObj.prototype._destroy=function(){this.doRemove&&(CObj.debugView&&this.debugGfx&&(this.debugGfx.parent.removeChild(this.debugGfx),this.debugGfx=null),this.gfx&&this.gfx.parent&&this.gfx.parent.removeChild(this.gfx),this.gfx=null)};CObj.prototype.destroy=function(){!this.doRemove&&this.return2Pool&&(pool.Push(this.return2Pool),this.return2Pool=null);this.doRemove=!0};CObj.getById=function(a){for(var b=0;b<CObj.objects.length;++b)if(CObj.objects[b].id==a)return CObj.objects[b]};
CObj.checkType=function(a,b){return a.constructor==b};CObj.destroyAll=function(){for(var a=CObj.objects.length,b=0;b<a;++b)CObj.objects[b].mechanicalDestroy=!0,CObj.objects[b].destroy();CObj.processAll()};
CObj.prototype.updateGraphics=function(a){if(this.gfx&&this.gfx.position){this.gfx.rotation=this.rotation+this.offsetR;if(a||void 0==this.prevRotation||.01<Math.abs(this.gfx.rotation-this.prevRotation)){a=Math.cos(this.rotation);var b=Math.sin(this.rotation);this.oX=this.offsetX*a-this.offsetY*b;this.oY=this.offsetX*b+this.offsetY*a;this.prevRotation=this.gfx.rotation}this.gfx.position.x=this.x+this.oX;this.gfx.position.y=this.y+this.oY}};CObj.prototype.constructor=CObj;
Object.defineProperty(CObj.prototype,"radius",{get:function(){return this._radius},set:function(a){if(this._radius=a)this._sqr=a*a;if(CObj.debugView&&this.debugGfx){this.debugGfx.clear();this.debugGfx.beginFill(0,.2);if(this.hitTestCircles)for(a=0;a<this.hitTestCircles.length;++a)this.debugGfx.drawCircle(this.hitTestCircles[a].x,this.hitTestCircles[a].y,this.hitTestCircles[a].r);else 1<=this.radius&&this.debugGfx.drawCircle(0,0,a);this.debugGfx.endFill()}}});
Object.defineProperty(CObj.prototype,"x",{get:function(){return this.body?this.body.position[0]:this._x},set:function(a){this.body?this.body.position[0]=a:this._x=a;this.updateGraphics()}});CObj.enableButtons=function(a){for(var b=0;b<CObj.objects.length;++b)CObj.checkType(CObj.objects[b],CButton)&&(CObj.objects[b].gfx.interactive=a)};
CObj.processAll=function(){for(var a=CObj.objects.length,b=0;b<a;b++)if(!CObj.objects[b].gui&&(CObj.objects[b].x>1.8*SCR_WIDTH||CObj.objects[b].x<.8*-SCR_WIDTH||CObj.objects[b].y>1.8*SCR_HEIGHT||CObj.objects[b].y<-SCR_HEIGHT))CObj.checkType(CObj.objects[b],CHPBar)||CObj.objects[b].destroy();else if(0<CObj.objects[b].colMask)for(var c=0;c<a;c++)if(b!=c){var d=CObj.objects[b],e=CObj.objects[c];if(!(d.doRemove||e.doRemove||0==(d.colMask&e.colGroup)&&0==(e.colMask&d.colGroup)))if(d.hitTestCircles)for(var f=
d.hitTestCircles.length,g=0;g<f;++g){var k=e.x-(d.x+d.hitTestCircles[g].x),h=e.y-(d.y+d.hitTestCircles[g].y),l=e.radius+d.hitTestCircles[g].r;if(k*k+h*h<l*l){0!=(d.colMask&e.colGroup)&&d.collide(e);0!=(e.colMask&d.colGroup)&&e.collide(d);break}}else k=d.x-e.x,h=d.y-e.y,k*k+h*h<(e.radius+d.radius)*(e.radius+d.radius)&&(0!=(d.colMask&e.colGroup)&&d.collide(e),0!=(e.colMask&d.colGroup)&&e.collide(d))}for(b=0;b<a;b++)CObj.objects[b].process(),CObj.objects[b].doRemove&&(CObj.objects[b]._destroy(),CObj.objects.splice(b,
1),b--,a--)};Object.defineProperty(CObj.prototype,"sensor",{get:function(){return this._sensor},set:function(a){this._sensor=a;if(this._body)for(var b=this.body.shapes.length,c=0;c<b;++c)this.body.shapes[c].sensor=a}});Object.defineProperty(CObj.prototype,"y",{get:function(){return this.body?this.body.position[1]:this._y},set:function(a){this.body?this.body.position[1]=a:this._y=a;this.updateGraphics()}});
Object.defineProperty(CObj.prototype,"body",{get:function(){return this._body},set:function(a){this._body&&(world.removeBody(this._body),this._body.userData=null);a&&(this._body=a,this._body.userData=this,world.addBody(this._body))}});Object.defineProperty(CObj.prototype,"rotation",{get:function(){return this.body?this.body.angle:this._rotation},set:function(a){this.body?this.body.angle=a:this._rotation=a;this.updateGraphics()}});
CObj.DeserializeArray=function(a){sortlayers=function(a,b){return a.layer==b.layer?a.creationIndex>b.creationIndex?1:-1:a.layer>b.layer?1:-1};var b=a.objects.length,c=[];for(i=0;i<b;i++){var d=CObj.DeserializeCObj(a.objects[i]);d.creationIndex=i;c.push(d)}c.sort(sortlayers);return c};CObj.ExtractFrameName=function(a){var b=a.indexOf("0");return-1==b?a:a.substring(0,b)};
CObj.ExtractFrameNum=function(a){var b=a.indexOf("0");if(-1==b)return 0;a=a.substring(b,a.length);~a.indexOf(".")&&(a=a.slice(0,-4));a=parseInt(a);return isNaN(a)?0:a};CObj.createMovieClip=function(a){var b=CObj.ExtractFrameName(a),c=[],d=0,e=0,f;for(f in PIXI.TextureCache)a==f&&(d=e),CObj.ExtractFrameName(f)==b&&(c.push(PIXI.TextureCache[f]),e++);0==c.length&&(c[0]=PIXI.TextureCache[a+".png"]);a=new PIXI.MovieClip(c);a.gotoAndStop(d);return a};
CObj.AssignTexturesToObjects=function(a,b){for(var c=a.length,d=0;d<c;d++)if(""!=a[d].clipSrc&&null!=a[d].clipSrc){var e=null;""!=a[d].sAtlasName?e=PIXI.Texture.fromFrame(a[d].clipSrc+".png"):(e=a[d].clipSrc.indexOf("."),e=-1==e?PIXI.Texture.fromFrame(a[d].clipSrc+".png"):PIXI.Texture.fromFrame(a[d].clipSrc.substr(0,e)+".png"));if(e){var f=null;a[d].isClip?(f=CObj.createMovieClip(a[d].clipSrc),f.animationSpeed=a[d].fps/FRAME_RATE,a[d].autoPlay&&f.play()):f=a[d].drawAsTexture?new PIXI.TilingSprite(e,
a[d].baseDim.x,a[d].baseDim.y):new PIXI.Sprite(e);f.anchor.x=.5;f.anchor.y=.5;f.x=a[d].x;f.y=a[d].y;f.width=a[d].baseDim.x+2;f.height=a[d].baseDim.y+2;f.rotation=a[d].rotation;f.scale.x=a[d].scaleX*window.addScale;f.scale.y=a[d].scaleY*window.addScale;f.width+=1;f.height+=1;a[d].gfx=f;b&&b.addChild(f)}}};CObj.setBodyMass=function(a,b){var c=a.getArea();a.mass=c*b/50};
CObj.setDefaultCG=function(a){for(var b=a.motionState==p2.Body.STATIC||0==a.mass?world.cgSTATIC:world.cgDYNAMIC,c=0;c<a.shapes.length;++c)a.shapes[c].collisionMask=b==world.cgSTATIC?world.cgDYNAMIC:world.cgSTATIC|world.cgDYNAMIC,a.shapes[c].collisionGroup=b};
CObj.DeserializeCObj=function(a,b){var c=Deserialize(a);c.clipSrc=a.clip;if(c.clipSrc){var d=a.clip,e=d.lastIndexOf(".");-1!=d.lastIndexOf(".",e-1)&&(d.substring(0,e),c.sAtlasName=d.substring(0,e),c.clipSrc=d.substring(e+1,d.length),e=c.sAtlasName.indexOf("."),-1!=e&&(c.sAtlasName=c.sAtlasName.substr(0,e)))}void 0!=a.density&&(c.density=a.density);void 0!=a.elasticity&&(c.elasticity=a.elasticity);void 0!=a.friction&&(c.friction=a.friction);void 0!=a.frictionStatic&&(c.frictionStatic=a.frictionStatic);
void 0!=a.frictionRolling&&(c.frictionRolling=a.frictionRolling);void 0!=a.isSensor&&(c.isSensor=a.isSensor);a.layer&&(c.layer=a.layer);c.id=a.id;a.baseDim&&(c.baseDim.x=a.baseDim.x,c.baseDim.y=a.baseDim.y);c.scaleX=a.scaleX/2;c.scaleY=a.scaleY/2;void 0!=a.x&&(c.x=a.x);void 0!=a.y&&(c.y=a.y);void 0!=a.rotation&&(c.rotation=a.rotation);return c};
function Deserialize(a){if(void 0!=a.cls&&""!=a.cls&&"ZEngine::ZObj"!=a.cls){var b=a.cls;-1!=b.indexOf("::")&&(b=b.split("::")[1]);window[b]?("ZObj"==b&&(b="CObj"),o=new window[b],o.cls=b):o=new CObj}else o=new CObj;if(o.PublicFields){var b=o.PublicFields.replace(" ","").split(";"),c,d,e=b.length;for(d=0;d<e;d++)if(""!=b[d]){var f=b[d].split(","),g=f.length;for(c=0;c<g;c++){var k=f[c];""!=k&&"["!=k.substr(0,1)&&void 0!=a[k]&&(o[k]=a[k])}}}return o}extend(CBomb,CObj,!0);
function CBomb(a,b,c,d){CObj.apply(this,[a,b,c,d]);this.PublicFields+="power,";this.radiusMax=300}
CBomb.prototype.explode=function(){if(!this.doRemove){var a=CObj.objects.length,b=new vec2.create,c=new vec2.create;ZSound.Play("rocketboom");if(pool.Pop("expl")){var d=new CObj(this.x,this.y);d.x=this.x;d.y=this.y;d.gfx.animationSpeed=.85;d.gfx.gotoAndPlay(0);d.gfx.loop=!1;d.gfx.scale.x=1.55*window.addScale;d.gfx.scale.y=1.55*window.addScale;d.updateGraphics();d.gfx.parent&&d.gfx.parent.removeChild(d.gfx);SM.inst.ol.addChild(d.gfx);d.gfx.onComplete=function(){d.gfx&&(d.destroy(),pool.Push(d.gfx))}}for(var e=
0;e<a;++e)if(!CObj.objects[e].sensor&&CObj.objects[e]!=this&&CObj.objects[e].body&&CObj.objects[e].body.type==p2.Body.DYNAMIC){b[0]=this.x;b[1]=this.y;c[0]=CObj.objects[e].x;c[1]=CObj.objects[e].y;vec2.sub(b,b,c);var f=vec2.sqrLen(b);f>this.radiusMax*this.radiusMax||(f=Math.sqrt(f),b[0]/=f,b[1]/=f,f=1-(f+2)/this.radiusMax,0>f&&(f=0),f=Math.pow(f,1.4),vec2.scale(b,b,4500*this.power*f),CObj.objects[e].body.force[0]-=b[0],CObj.objects[e].body.force[1]-=b[1])}this.destroy()}};
CBomb.prototype.setElectricity=function(a){CObj.prototype.setElectricity.call(this);a&&this.explode()};extend(CButton,CObj,!0);function CButton(a,b,c,d){CObj.apply(this,[a,b,c,d]);this.PublicFields+="text,fontFamily,fontSize,align,hover";this.gui=!0}CButton.tintColor=16777215;
CButton.prototype.destroy=function(){this.doRemove||(this.gfx.mouseout=null,this.gfx.mouseover=null,this.textField.mouseout=null,this.textField.mouseover=null,CObj.prototype.destroy.call(this),this.textField.parent.removeChild(this.textField),this.click=this.textField=null)};
Object.defineProperty(CButton.prototype,"click",{get:function(){return this._click},set:function(a){this._click=a;if(!a)this.gfx.tap=null,this.gfx.click=null;else if(this.gfx){var b=function(b){stage.getChildAt(stage.children.length-1).trans||(ZSound.Play("CLICK"),a&&a(b))};this.postCreatedContainer&&(this.textField.tap=b,this.textField.click=b);this.gfx.tap=b;this.gfx.click=b}}});
Object.defineProperty(CButton.prototype,"text",{get:function(){return this._text},set:function(a){this._text=a;if(this.gfx&&this.textField){var b=this.textField;b.text=a;b.updateText();a=b.getLocalBounds();b.x=-a.width/2;b.y=-a.height;this.updateGraphics(!0)}}});
CButton.prototype.updateGraphics=function(){if(!this.doRemove&&(CObj.prototype.updateGraphics.call(this),this.gfx&&this.textField)){var a=0;this.hover&&(a=this.deltaHoverY?this.deltaHoverY:this.y>SCR_HEIGHT-100?-50:50);this.addToSameLayer?this.textField.y=.7*this.textField.height+a:(this.textField.y=this.gfx.y-.7*this.textField.height+a,this.textField.x=this.gfx.x-this.textField.width/2)}};
CButton.prototype.init=function(){CObj.prototype.init.call(this);this.gfx||(this.gfx=new PIXI.DisplayObjectContainer,this.postCreatedContainer=!0,this.updateGraphics());this.gfx.interactive=!0;this.align="center";this.fontSize=""!=this.fontSize?parseInt(this.fontSize):"30";this.textField=CTextField.createTextField(this);this.postCreatedContainer&&(this.textField.interactive=!0);if(void 0==this.hover||"true"==this.hover)this.hover=!0;"false"==this.hover&&(this.hover=!1);this.hover&&(this.textField.alpha=
0);this.text&&(this.text=this.text);this.isClip&&this.gfx.gotoAndStop(0);var a=this.textField,b=this.gfx;this.baseScaleX=b.scale.x;this.baseScaleY=b.scale.y;var c=this.baseScaleX,d=this.baseScaleY,e=this;this.updateGraphics();this.gfx.mouseover=function(f){TweenMax.killTweensOf(b.scale);e.over=!0;b.tint=CButton.tintColor;new TweenMax(b.scale,.6,{y:d+.05,ease:Elastic.easeOut});new TweenMax(b.scale,.4,{x:c+.05,ease:Elastic.easeOut});a.visible&&""!=a.text&&(new TweenMax(a.scale,.6,{y:1.1,ease:Elastic.easeOut}),
new TweenMax(a.scale,.4,{x:1.1,ease:Elastic.easeOut}));e.hover&&(e.textField.alpha=1)};this.gfx.mouseout=function(f){e.over=!1;b.tint=16777215;b.currentFrame&&b.gotoAndStop(1);new TweenMax(b.scale,.3,{x:c,y:d,ease:Elastic.easeOut});a.visible&&""!=a.text&&new TweenMax(a.scale,.3,{x:1,y:1,ease:Elastic.easeOut});e.hover&&(e.textField.alpha=0)};this.addToSameLayer?this.gfx.addChild(this.textField):SM.inst.fontLayer.addChild(this.textField)};extend(ZCJoint,CObj,!0);
function ZCJoint(a,b,c,d){CObj.apply(this,[a,b,c,d]);this.PublicFields+="body1Id,body2Id,collideConnected,breakOnForce,angleConstraint,angleMin,angleMax,frequency,damping,rate,isStopped,"}ZCJoint.prototype.CreateMotor=function(){joint&&1E-6<Math.abs(rate)&&(motor||(motor=new MotorJoint(joint.body1,joint.body2,2*Math.PI*rate)),motor.rate=isStopped?0:2*Math.PI*rate,motor.ignore=!collideConnected,motor.space=ZNape.Inst.World)};
ZCJoint.getFirstStatic=function(){for(var a=CObj.objects.length,b=0;b<a;++b)if(CObj.objects[b].body&&CObj.objects[b].body.type==p2.Body.STATIC)return CObj.objects[b].body};
ZCJoint.prototype.init=function(){CObj.prototype.init.call(this);var a=world.hitTest([this.x,this.y],world.bodies,3),b,c,d=!1;1==a.length?(b=a[0],""!=this.body1Id&&(b=CObj.getById(this.body1Id).body),null!=b&&b.type!=p2.Body.STATIC&&(d=!0,c=ZCJoint.getFirstStatic(),this.joint=new p2.Constraint(b,c,{collideConnected:this.collideConnected,worldPivot:[this.x,this.y]}))):2<=a.length&&(b=a[0],c=a[1],""!=this.body1Id&&(b=CObj.getById(this.body1Id).body),""!=this.body2Id&&(c=CObj.getById(this.body2Id).body));
d||(b.userData.onContactBegin(c),c.userData.onContactBegin(b));b||(b=a[0]);c||(c=a[1]);""!=this.body1Id&&(b=CObj.getById(this.body1Id).body);""!=this.body2Id&&(c=CObj.getById(this.body2Id).body);null==b||null==c||b.type==p2.Body.STATIC&&c.type==p2.Body.STATIC||(this.joint=new p2.RevoluteConstraint(b,c,{collideConnected:this.collideConnected,worldPivot:[this.x,this.y]}));null!=this.joint&&(0!=this.rate&&(b.motionState!=p2.Body.STATIC&&(b.userData.motorSpeed=this.rate),c.motionState!=p2.Body.STATIC&&
(c.userData.motorSpeed=this.rate),this.joint.motor=!0),world.addConstraint(this.joint))};extend(CTextField,CObj,!0);function CTextField(a,b,c,d){CObj.apply(this,[a,b,c,d]);this.gui=!0;this.text="";this.PublicFields+="text,fontFamily,fontSize,align,tint, "}
Object.defineProperty(CTextField.prototype,"text",{get:function(){return this._text},set:function(a){this._text=CTextField.convertSpaces(a);""==this._text&&(this._text=" ");this.gfx&&(this.gfx.text=this._text,this.gfx.updateText(),a=this.gfx.getLocalBounds(),this.offsetX="center"==this.align?-a.width/2*window.addScale:"right"==this.align?-a.width*window.addScale:0,this.updateGraphics(!0))}});CTextField.hashCode=function(a){for(var b=0,c=0;c<a.length;c++)b=a.charCodeAt(c)+((b<<5)-b);return b};
CTextField.convertSpaces=function(a){var b=a.match(/==/g);b&&(breaks=b.length);return a.replace(/==/g,"\n")};
CTextField.createTextField=function(a){var b=PIXI.BitmapText.fonts.dedgamedesc;if(a.fontFamily&&""!=a.fontFamily){var c=PIXI.BitmapText.fonts[a.fontFamily];void 0!=c&&(b=c)}a.fontSize=a.fontSize&&void 0!=a.fontSize?a.fontSize/window.addScale:30/window.addScale;b=a.fontSize+"px "+b.font;a.align&&""!=a.align||(a.align="left");"dedgamecaps"==a.fontFamily&&(a.text=a.text.toUpperCase());a.text&&(a.text=CTextField.convertSpaces(a.text));b=new PIXI.BitmapText(a.text,{font:b,align:"center",valign:"center"});
b.align="center";"0xffffff"!=a.tint&&void 0!=a.tint&&(b.tint=parseInt(a.tint));b.breaks=0;b.fs=a.fontSize;b.updateText();return b};CTextField.prototype.setTextSafe=function(a){this.safeText=a};CTextField.prototype.process=function(){void 0!=this.safeText&&(this.text=this.safeText,this.safeText=null)};
CTextField.prototype.init=function(){CObj.prototype.init.call(this);this.gfx=CTextField.createTextField(this);this.gfx.scale.x*=window.addScale;this.gfx.scale.y*=window.addScale;this.text=this.text;this.updateGraphics();SM.inst.fontLayer.addChild(this.gfx)};extend(CNotArrow,CObj,!0);function CNotArrow(a,b,c,d){CObj.apply(this,[a,b,c,d]);this.PublicFields+="objectsToPoint, "}
CNotArrow.prototype.process=function(){var a=this.x-this.basePositionX,b=this.y-this.basePositionY,c=Math.sqrt(a*a+b*b);0!=c&&(this.rotation=Math.atan2(a/c,b/c));this.x=this.left;this.y=this.top;CObj.prototype.process.call(this)};
CNotArrow.prototype.init=function(){this.gfx=new PIXI.DisplayObjectContainer;this.updateGraphics();var a=new PIXI.Sprite(PIXI.Texture.fromFrame("arrow1.png"));a.anchor.x=.5;a.anchor.y=0;new TweenMax(a,2,{y:a.y-15,yoyo:!0,repeat:-1});this.gfx.addChild(a);SM.inst.fg.addChild(this.gfx);this.basePositionX=this.x;this.basePositionY=this.y;for(var a=this.objectsToPoint.split(";"),b=[],c,d=0;d<a.length;++d)(c=CObj.getById(a[d]))&&b.push({left:c.x,top:c.y});this.left=b[0].left;this.top=b[0].top;this.x=b[0].left;
this.y=b[0].top;new TweenMax(this,3,{bezier:{curviness:1,values:b},ease:Linear.easeNone,repeat:-1,yoyo:!0})};extend(CHPBar,CObj,!0);function CHPBar(a,b,c,d){CObj.apply(this,[a,b,c,d]);this.PublicFields+="upperImage,space,tile, ";prop=1}CHPBar.prototype.destroy=function(){this.doRemove||(this.gfx.removeChild(this.upperImageClip),this.upperImageClip=null,CObj.prototype.destroy.call(this))};
Object.defineProperty(CHPBar.prototype,"prop",{get:function(){return this._prop},set:function(a){this.doRemove||(this._prop=a,0>this._prop&&(this._prop=0),a=1/this.gfx.scale.x*this._prop*(this.gfx.width-2*this.space),this.tile&&(a=Math.round(a/this.upperImageClip.texture.width+1)*this.upperImageClip.texture.width),this.upperImageClip.width=a,this.upperImageClip.x=0,this.upperImageClip.y=0)}});CHPBar.prototype.tweenProp=function(a){new TweenMax(this,.8,{prop:a,ease:Cubic.easeOut})};
CHPBar.prototype.init=function(){this.space=parseInt(this.space);this.gfx?(this.gfx.anchor.x=0,this.gfx.anchor.y=0):this.gfx=new PIXI.DisplayObjectContainer;this.x-=.5*this.gfx.width;this.space||(this.space=0);if(this.upperImage){var a=PIXI.Texture.fromFrame(this.upperImage+".png");this.upperImageClip=this.tile?new PIXI.TilingSprite(a,a.width,a.height):new PIXI.Sprite(a);this.upperImageClip.anchor.x=0;this.upperImageClip.anchor.y=0;this.upperImageClip.height-=this.space;this.gfx.addChild(this.upperImageClip)}this.prop=
1;this.updateGraphics();CObj.prototype.init.call(this)};extend(CLiveObj,CObj,!0);function CLiveObj(a,b,c,d){CObj.debugView&&(this.debugGfx=new PIXI.Graphics,SM.inst.guiLayer.addChild(this.debugGfx));CObj.apply(this,[a,b,c,d]);this._maxHp=this._hp=100;this.bar=null}CLiveObj.prototype.process=function(){CObj.prototype.process.call(this)};CLiveObj.prototype.kill=function(){this.destroy();this.isKilled=!0};CLiveObj.prototype.dealDamage=function(a){this.hp-=a};
CLiveObj.prototype.destroy=function(){this.doRemove||(this.bar&&(this.bar.destroy(),this.bar=null),CObj.prototype.destroy.call(this))};CLiveObj.generateProperty("maxHp",{defaultValue:100,get:function(){return this._maxHp},set:function(a){this._maxHp=a;this._hp>this._maxHp&&(this._hp=this._maxHp)}});
CLiveObj.generateProperty("hp",{defaultValue:100,get:function(){return this._hp},set:function(a){this._hp=a>this._maxHp?this._maxHp:a;this.bar&&this.bar.tweenProp(this._hp/this._maxHp);0>=this._hp&&!this.isKilled&&this.kill()}});extend(CPlayer,CLiveObj,!0);
function CPlayer(a,b,c,d){CLiveObj.apply(this,[a,b,null,d]);this.invulnerable=0;this.initialJumpSpeed=-21.5;this.gravPower=1.3;this.pickupBooster=!0;this.gfx=this.createDedGraphics();this.fireAngle=0;this.weapon=gameStage.curweapon;this.bar=CObj.getById("hpbar");this.ammobar=gameStage.ammobar;this.colGroup=CG_PLAYER;this.colMask=CG_MONSTER;this.hp=this.maxHp=5;this.baseY=this.y+=10;this.baseX=this.x;this.offsetY=-20;this.offsetX=-25;this.radius=this.gfx.width/2-35;this.sMoving=1;this.sDying=2;this.state=
this.sMoving;this.playable=!1;this.lastUseExpl=0;this.superMode=!1;this.jumpNumber=0;SM.inst.currentStage==gameStage&&(this.movementTween=new TweenMax(this,2,{ease:Sine.easeInOut,x:this.x-50,yoyo:!0,repeat:-1}),this.landing())}CPlayer.prototype.collide=function(a){!this.prekilled&&!this.doRemove&&this.superMode&&CObj.checkType(a,CMonster)&&500<window.time-this.lastUseExpl&&(this.lastUseExpl=window.time,CGrenade.makeBoom((this.x+a.x)/2,(this.y+a.y)/2,80,300))};
CPlayer.prototype.updateAppearence=function(a,b,c,d,e){c&&this.gfx.state.setAnimationByName(0,c,!0);b?this.gfx.skeleton.setAttachment("board","board"):this.gfx.skeleton.setAttachment("board",null);b=null;c="gun0";if(a)for(a=0;a<PlayerData.inst.items_enabled.length;++a){if(PlayerData.inst.items_enabled[a].equipped){var f=PlayerData.inst.getItemById(PlayerData.inst.items_enabled[a].id_item);f.type==tApp+tHat&&(b=f.gfx);f.type==tWeapon&&(c=f.gfx)}}else this.gfx.skeleton.setAttachment("gun",null);d&&
(c=d);this.gfx.skeleton.setAttachment("gun",c);e&&(b=e);this.gfx.skeleton.setAttachment("hat",b)};
CPlayer.prototype.createDedGraphics=function(){var a=new PIXI.Spine("imgtps/skeleton.json");a.skeleton.setSkinByName("perded");a.state.setAnimationByName(0,"idle",!0);this.gunBone=a.skeleton.findSlot("gun");this.boardSlot=a.skeleton.findSlot("board");this.rshSlot=a.skeleton.findSlot("r_shoulder");this.lshSlot=a.skeleton.findSlot("l_shoulder");a.scale.x=.3;a.scale.y=.3;CPlayer.rhRot||(CPlayer.rhRot=this.rshSlot.data.boneData.rotation);CPlayer.lhRot||(CPlayer.lhRot=this.lshSlot.data.boneData.rotation);
this.rshSlot.data.boneData.rotation=CPlayer.rhRot;this.lshSlot.data.boneData.rotation=CPlayer.lhRot;a.skeleton.setAttachment("body","body");a.stateData.setMixByName("idle","jump",.2);a.stateData.setMixByName("jump","idle",.1);a.stateData.setMixByName("jump","defeated",.3);a.stateData.setMixByName("idle","defeated",.72);this.bulletStart=40;return a};
CPlayer.prototype.reveal=function(){this.hp=2;this.pickupBooster=!0;this.invulnerable=0;this.state=this.sMoving;this.revealTime=(new Date).getTime();this.gfx.state.setAnimationByName(0,"idle",!0)};
CPlayer.prototype.onJump=function(){this.state==this.sMoving&&(!this.jumping||this.jumping&&this.jumpNumber)&&(this.jumpNumber++,2<this.jumpNumber||(this.jumping=!0,2!=this.jumpNumber?(this.prevX||(this.prevX=this.x),this.vy=this.initialJumpSpeed,this.gfx.state.setAnimationByName(0,"jump",!1)):this.vy+=this.initialJumpSpeed/5,this.gravityEnabled=!0,this.vy=this.initialJumpSpeed,ZSound.Play("jump2"),this.movementTween.pause()))};
CPlayer.prototype.kill=function(){if(this.state==this.sMoving){this.state=this.sDying;this.pickupBooster=!1;if(CBooster.list)for(var a=0;a<CBooster.list.length;++a)CBooster.list[a].onDeactivate();this.invulnerable++;a=LauncherBG.inst;a.preVelocity=a.maxVelocity;this.gravityEnabled=!0;ZSound.Play("losing");this.gfx.state.update(.5);this.gfx.state.setAnimationByName(0,"defeated",!1);new TweenMax(a,2,{maxVelocity:.5});TweenMax.delayedCall(2.57,gameStage.sessionEnd)}};
CPlayer.prototype.destroy=function(){this.jumpTween&&this.jumpTween.kill();this.jumpTween=null;this.movementTween&&this.movementTween.kill();this.movementTween=null;CLiveObj.prototype.destroy.call(this);gameStage.player=null};CPlayer.prototype.jump=function(){this.jumpTween&&this.jumpTween.isActive()||(this.jumpTween=new TweenMax(this,.55,{y:140,yoyo:!0,repeat:1,ease:Cubic.easeOut}))};
CPlayer.prototype.landing=function(){this.vy=0;this.jumping=!1;this.y=this.baseY;this.gravityEnabled=!1;this.jumpNumber=0;this.state!=this.sDying&&(this.gfx.state.setAnimationByName(0,"idle",!0),this.movementTween.resume())};CPlayer.prototype.onDmgAnim=function(a){this.state!=this.sDying&&(this.gravityEnabled?this.vy=Math.max(-20,this.vy-20):(this.gravityEnabled=!0,this.vy-=15))};
CPlayer.prototype.process=function(){if(SM.inst.currentStage==gameStage&&this.playable&&gameStage.player){0<this.vy&&this.y>this.baseY-50&&(this.jumping=!1);0<this.vy&&this.y>this.baseY&&this.landing();this.blink&&this.updateBlink();this.state==this.sDying||this.jumping||(this.x+=(this.baseX-this.x)/45);this.vx*=.9;gameStage.fireState&&window.mouseY<SCR_HEIGHT-40&&this.fire();!this.jumping&&this.boardSlot&&(this.boardSlot.bone.rotation*=.5,.02>this.boardSlot.bone.rotation&&(this.boardSlot.bone.rotation=
.02));gameStage.ammoico.x=this.x-80;gameStage.ammoico.y=this.y-50;gameStage.ammobar.x=gameStage.ammoico.x+25;gameStage.ammobar.y=gameStage.ammoico.y-21;gameStage.reloadBar.x=gameStage.ammoico.x;gameStage.reloadBar.y=gameStage.ammoico.y;this.weapon&&this.weapon.process();var a=0,b=0,c=0;gameStage.curweapon==w_laser?(a=0,b=200):gameStage.curweapon==w_ak74?(a=220,b=0):gameStage.curweapon==w_rifle?(a=220,b=20):gameStage.curweapon==w_pps?(a=330,b=20,c=-Math.PI/20):gameStage.curweapon==w_grenadel?(a=-20,
b=250,c=0):gameStage.curweapon==w_minigun&&(b=380,a=-68,c=Math.PI/7.5);a=this.gunBone.currentSprite.toGlobal({x:b,y:-a});this.firePointX=a.x/SCR_SCALE;this.firePointY=a.y/SCR_SCALE;a=window.mouseX;b=window.mouseY;a<this.firePointX&&(a=this.firePointX);b>SCR_HEIGHT-50&&(b=SCR_HEIGHT-50);a=Math.atan2(this.y-b,this.x-a);this.fireAngle=Math.PI+a-this.weapon.recoilValue/100;c=this.fireAngle+Math.PI/2+c;this.state==this.sMoving&&(this.rshSlot.data.boneData.rotation=270-180*c/Math.PI+25,this.lshSlot.data.boneData.rotation=
270-180*c/Math.PI-10)}CLiveObj.prototype.process.call(this)};CPlayer.prototype.resetBlink=function(){for(var a=this.gfx,b=0;b<a.skeleton.slots.length;++b)a.skeleton.slots[b].r=1,a.skeleton.slots[b].g=1,a.skeleton.slots[b].b=1};CPlayer.prototype.updateBlink=function(){for(var a=this.gfx,b=0;b<a.skeleton.slots.length;++b){var c=.5*(Math.cos(b/150+window.time/400)+1),c=hslToRgb(c,1,.86);a.skeleton.slots[b].r=c[0];a.skeleton.slots[b].g=c[1];a.skeleton.slots[b].b=c[2]}};
CPlayer.prototype.dealDamage=function(a){if(!(550>window.time-this.revealTime||0<this.invulnerable)){this.revealTime=window.time;for(var b=0;b<this.gfx.skeleton.slots.length;++b)this.gfx.skeleton.slots[b].r=1,this.gfx.skeleton.slots[b].g=0,this.gfx.skeleton.slots[b].b=0;var c=this.gfx;TweenMax.delayedCall(.2,function(){for(var a=0;a<c.skeleton.slots.length;++a)c.skeleton.slots[a].r=1,c.skeleton.slots[a].g=1,c.skeleton.slots[a].b=1});this.gfx.skeleton.setAttachment("head","head4");TweenMax.delayedCall(.7,
function(){gameStage.player&&gameStage.player.gfx.skeleton.setAttachment("head","head1")});this.hp=0>this.hp-a?0:this.hp-a}};CPlayer.prototype.fire=function(){gameStage.menuBtn&&!gameStage.menuBtn.over&&this.state==this.sMoving&&this.weapon.shot()};extend(CBullet,CObj,!0);
function CBullet(a,b,c,d,e){CObj.apply(this,[a,b,null,d]);this.gfx=new PIXI.DisplayObjectContainer;this.visualVel=7;this.visualWidth=e;this.bhead=new PIXI.Sprite(PIXI.Texture.fromFrame("head.png"));this.bhead.anchor.x=.5;this.bhead.anchor.y=.5;this.bhead.blendMode=PIXI.blendModes.ADD;this.bhead.width=this.visualWidth;this.bmiddle=new PIXI.Sprite(PIXI.Texture.fromFrame("center.png"));this.bmiddle.width=this.visualWidth;this.bmiddle.anchor.x=.5;this.bmiddle.anchor.y=.5;this.bmiddle.blendMode=PIXI.blendModes.ADD;
this.bsheylf=new PIXI.Sprite(PIXI.Texture.fromFrame("shleyf.png"));this.bsheylf.width=this.visualWidth;this.bsheylf.anchor.x=.5;this.bsheylf.anchor.y=.5;this.bsheylf.blendMode=PIXI.blendModes.ADD;this.gfx.addChild(this.bhead);this.gfx.addChild(this.bmiddle);this.gfx.addChild(this.bsheylf);SM.inst.ol.addChild(this.gfx);this.dmg=10;this.radius=30;CBullet.list||(CBullet.list=[]);CBullet.list.push(this)}
CBullet.prototype.updateBulletSpeed=function(){this.bhead.width=this.visualWidth;this.bmiddle.width=this.visualWidth;this.bsheylf.width=this.visualWidth;this.bmiddle.height=this.visualVel/2+6;this.bhead.y=-this.bmiddle.height/2-this.bhead.height/2+2;this.bsheylf.height=5+this.visualVel/2;this.bsheylf.y=this.bmiddle.height/2+this.bsheylf.height/2};
CBullet.prototype.collide=function(a){if(a&&this.prevVictim!=a){a.dealDamage(this.dmg);if(a.metall){var b=pool.Pop("fxsmallblink");b&&(b.animationSpeed=.45)}else if(b=pool.Pop("blood"))b.animationSpeed=.55;if(b){var c=new CObj(this.x,this.y,null);b.loop=!1;b.gotoAndPlay(0);c.gfx=b;c.updateGraphics();SM.inst.fg.addChild(b);c.return2Pool=c.gfx;c.lifeTime=800;c.gfx.onComplete=function(){c.destroy()}}this.life--;this.dmg*=.66;0>=this.life&&this.destroy();this.prevVictim=a}};
CBullet.prototype.destroy=function(){this.prevVictim=null;var a=CBullet.list.indexOf(this);0<=a&&CBullet.list.splice(a,1);CObj.prototype.destroy.call(this)};CBullet.prototype.process=function(){this.visualVel+=29.5;this.dw&&(this.visualWidth+=this.dw);this.updateBulletSpeed(this.visualVel);CObj.prototype.process.call(this)};extend(FloorObj,CObj,!0);function FloorObj(a,b,c,d){CObj.apply(this,[a,b,c,d]);this.gfx&&(this.gfx.parent.removeChild(this.gfx),SM.inst.ol.addChildAt(this.gfx,0))}
FloorObj.prototype.process=function(){for(var a=this.y-this.gfx.height/2,b=0;b<CObj.objects.length;++b){var c=CObj.objects[b];CObj.checkType(c,CMonster)&&0<c.vy&&c.y+c.radius/2>a&&c.destroy();CObj.checkType(c,JumpMon)&&c.y+c.radius/2>a-50&&0<c.vy&&(c.vy=.8*-c.vy,c.av=.1*Math.random());(CObj.checkType(c,CBoosterBox)||CObj.checkType(c,CCoin)||CObj.checkType(c,CKey))&&c.y+c.radius/2>a-58&&0<c.vy&&(c.vy=.8*-c.vy)}};extend(LauncherBG,CObj,!0);
function LauncherBG(a,b,c,d){CObj.apply(this,[a,b,c,d]);this.levCycles=[];this.gfx=new PIXI.DisplayObjectContainer;SM.inst.bg.addChild(this.gfx);this.nullSpeed=10.4;this.distance=0;this.incDist=50;this.speedUpCoef=.14;this.layersSpeed=[0,.1,.14,.65,.65,1,1];this.ol=new PIXI.DisplayObjectContainer;this.pllayer=new PIXI.DisplayObjectContainer;this.planeLayer=new PIXI.DisplayObjectContainer;this.defaultLayer=null;this.pixToDist=.02}
LauncherBG.generateProperty("maxVelocity",{defaultValue:0,get:function(){return this._maxVelocity},set:function(a){this._maxVelocity||(this._maxVelocity=0);var b=a/this._maxVelocity;Infinity==b&&(b=1);this._maxVelocity=a;a=this.levCycles[0].layers.length;for(var c=0;c<a;++c){var d=this.levCycles[0].layers[c];0<d.velocity&&(d.velocity*=b)}}});LauncherBG.prototype.clear=function(){this.speedUpCoef=.08;this.levCycles.splice(0,this.levCycles.length);this.distance=0;this.incDist=50};
LauncherBG.prototype.destroy=function(){this.clear();this.planeLayer=this.pllayer=this.ol=null;CObj.prototype.destroy.call(this)};
LauncherBG.prototype.spawnClip=function(a,b,c,d,e){var f=CObj.DeserializeCObj(b);CObj.AssignTexturesToObjects([f],SM.inst.bg);(d=f.gfx)&&d.parent&&d.parent.removeChild(d);f.gfx=null;f.destroy();f=30;0==a.velocity&&(f=0);d?(a.clip.addChild(d),a.rightBound+=b.baseDim.x*b.scaleX,d.position.x=c?f+b.baseDim.x*b.scaleX/2:SCR_WIDTH+f+b.baseDim.x*b.scaleX/2+e-.8*this.maxVelocity-3):a.rightBound+=b.baseDim.x*b.scaleX};
LauncherBG.prototype.process=function(a){if(0!=this.levCycles.length){var b=this.levCycles[0].layers[this.levCycles[0].layers.length-1].velocity*this.pixToDist;a||(100<this.distance&&120>this.distance&&PlayerData.inst.progressAch("Gold medal 2",1),500<this.distance&&520>this.distance&&PlayerData.inst.progressAch("Gold medal 3",1),1E3<this.distance&&1020>this.distance&&PlayerData.inst.progressAch("Gold medal 4",1),Math.floor(this.distance/this.incDist)!=Math.floor((this.distance+b)/this.incDist)&&
(this.maxVelocity+=this.speedUpCoef,this.speedUpCoef*=.95,console.log("SPEED "+this.maxVelocity.toString())));MM.inst.currentBoss||(this.distance+=b);a=this.levCycles[0].layers.length;for(b=0;b<a;++b){var c=this.levCycles[0].layers[b];c.curDist+=c.velocity;c.rightBound-=c.velocity;for(var d=0;d<c.clip.children.length;++d){var e=c.clip.children[d];e.x-=c.velocity}for(d=0;d<c.clip.children.length;++d)e=c.clip.children[d],e.position.x+.5*e.width<this.x&&c.clip.removeChild(c.clip.getChildAt(d));for(var e=
c.minx+c.curDist-Math.floor(c.curDist/c.width)*c.width,f=e-c.velocity,d=0;d<c.objects.length;++d){var g=c.objects[d],k=g.x-g.scaleX*g.baseDim.x/2;k>=f&&k<e&&this.spawnClip(c,g,null,e,k-f)}if(4==b&&this.graves)for(d=this.graves.length,e=0;e<d;++e)this.distance>this.graves[e].dist-(SCR_WIDTH+100)*this.pixToDist&&(f=crsp("grave"),f.x=SCR_WIDTH+100,f.y=395,c.clip.addChild(f),g=CTextField.createTextField({fontFamily:"dedgamecaps",tint:"0xFFFFFFFF",text:this.graves[e].text+"\n"+this.graves[e].dist.toString()+
" \u043c.",fontSize:30,align:"center"}),g.x=-g.width/2,g.updateText(),f.addChild(g),this.graves.splice(e,1),e--,d--)}}};
LauncherBG.prototype.addLevel=function(a,b){var c=LevelManager.levels["levels/"+a+".json"];clone(c);for(var d=[],e=0;7>e;++e){var f=new PIXI.DisplayObjectContainer,f={rightBound:SCR_WIDTH,clip:f,curDist:SCR_WIDTH,objects:[],velocity:this.nullSpeed*this.layersSpeed[e]};d.push(f);this.gfx.addChild(f.clip)}this.gfx.addChildAt(this.planeLayer,1);this.gfx.addChildAt(this.ol,7);this.gfx.addChildAt(this.pllayer,8);for(e=0;e<c.objects.length;++e)d[c.objects[e].layer-1].objects.push(c.objects[e]);for(c=0;c<
d.length;++c){for(var e=1E5,f=-1E5,g=0;g<d[c].objects.length;++g){var k=d[c].objects[g].x-d[c].objects[g].scaleX*d[c].objects[g].baseDim.x/2,h=d[c].objects[g].x+d[c].objects[g].scaleX*d[c].objects[g].baseDim.x/2;k<e&&(e=k);h>f&&(f=h)}d[c].maxx=f;d[c].minx=e;d[c].width=f-e;if(0==d[c].velocity)for(e=0;e<d[c].objects.length;++e)this.spawnClip(d[c],d[c].objects[e],!0)}this.defaultLayer=d[d.length-1].clip;this.levCycles.push({layers:d,dist:b});this.maxVelocity=this.nullSpeed};extend(CGrenade,CBullet,!0);
function CGrenade(a,b,c,d){CObj.apply(this,[a,b,null,d]);this.gfx=crsp("Granata.png");this.gfx.scale.x=.5;this.gfx.scale.y=.5;LauncherBG.inst.ol.addChild(this.gfx);this.radius=35;CBullet.list||(CBullet.list=[]);CBullet.list.push(this);var e=this;TweenMax.delayedCall(.05,function(){e.addSmoke()})}
CGrenade.prototype.addSmoke=function(a){if(!this.doRemove){var b=this;TweenMax.delayedCall(.02,function(){b.addSmoke()});if(a=pool.Pop("smoke")){var c=new CObj(this.x,this.y,null);c.gfx=a;c.updateGraphics();a.alpha=1;LauncherBG.inst.ol.addChild(c.gfx);c.return2Pool=c.gfx;c.lifeTime=800;new TweenMax(c.gfx,.2,{alpha:0,onComplete:function(){c.destroy()}})}}};
CGrenade.makeBoom=function(a,b,c,d,e){ZSound.Play("grenade");var f=pool.Pop("expl");if(f){var g=new CObj(a,b,null);f.loop=!1;f.gotoAndPlay(0);g.allowTrackSpeed=!0;g.gfx=f;g.updateGraphics();SM.inst.fg.addChild(f);g.rotation=Math.random()-.5;f.animationSpeed=.85;g.updateGraphics();g.return2Pool=g.gfx;g.lifeTime=800;g.gfx.onComplete=function(){g.destroy()}}f=d*d;CMonster.list||(k=0);for(var k=CMonster.list.length,h=0;h<k;++h){var l=CMonster.list[h];if(!l.doRemove&&l!=e){var m=l.x-a,n=l.y-b,m=m*m+n*
n;m<f&&(m=Math.sqrt(m),l.dealDamage((d-(m+.01))/d*c));l.doRemove&&(h--,k--)}}this.owner!=gameStage.player&&(m=gameStage.player.x-a,n=gameStage.player.y-b,m*m+n*n<.25*d*d&&gameStage.player.dealDamage(1))};CGrenade.prototype.collide=function(a){this.owner!=gameStage.player&&a&&CObj.checkType(a,CMonster)||a==this.owner||(CGrenade.makeBoom(this.x,this.y,this.dmg,350,this.owner),this.destroy())};CGrenade.prototype.destroy=function(){CBullet.prototype.destroy.call(this)};
CGrenade.prototype.process=function(){CObj.prototype.process.call(this);!this.doRemove&&this.y>gameStage.floor.y-60&&(this.vy=.7*-this.vy,5>Math.abs(this.vy)&&this.collide(null))};extend(CPlane,CObj,!0);
function CPlane(a,b,c,d){CObj.apply(this,[a,b,c,d]);this.shleif1=crsp("plane_trace1");this.shleif2=crsp("plane_trace2");this.shleif1.rotation=Math.PI;this.shleif2.rotation=Math.PI;this.shleif1.x=-this.shleif1.width/2;this.shleif2.x=-this.shleif2.width/2;this.gfx.addChild(this.shleif1);this.gfx.addChild(this.shleif2);this.alpha=1;new TweenMax(this,4,{alpha:0,yoyo:!0,repeat:-1,ease:Sine.easeInOut})}
CPlane.generateProperty("alpha",{defaultValue:1,get:function(){return this._alpha},set:function(a){this._alpha=a;this.shleif1.alpha=a;this.shleif2.alpha=1-a}});extend(CKey,CObj,!0);
function CKey(a,b,c){CObj.apply(this,[a,b,null,null]);this.gravityEnabled=!0;this.colGroup=1;this.colMask=CG_PLAYER;this.gravPower=.7;this.radius=15;this.gfx=crsp("key.png");this.gfx.anchor.x=.5;this.gfx.anchor.y=.5;this.gfx.scale.x=.7;this.gfx.scale.y=.7;SM.inst.ol.addChild(this.gfx);this.updateGraphics();this.allowTrackSpeed=!0}CKey.prototype.process=function(){CObj.prototype.process.call(this);this.gravityEnabled&&(this.vx=-7)};
CKey.spawnKey=function(a,b,c){a=new CKey(a,b,c);a.vx=20+10*Math.random();a.vy=-20*Math.random()};
CKey.prototype.collide=function(a){if(!this.isCollected){this.isCollected=!0;PlayerData.inst.playerItem.keys||(PlayerData.inst.playerItem.keys=0);PlayerData.inst.playerItem.keys++;PlayerData.inst.savePlayerData();var b=CTextField.createTextField({fontFamily:"dedgamecaps",fontSize:25,text:"\u0421\u041e\u0411\u0420\u0410\u041d\u041e "+PlayerData.inst.playerItem.keys.toString()+" \u041a\u041b\u042e\u0427\u0415\u0419"});b.updateText();b.x=this.x;b.y=this.y;SM.inst.fg.addChild(b);new TweenMax(b,.9,{y:b.y-
100,ease:Sine.easeIn,onComplete:function(){rp(b)}});gameStage.updateScore();this.gravityEnabled=!1;this.vy=this.vx=0;this.allowTrackSpeed=!1;a=pool.Pop("coinCollect");ZSound.Play("coin");if(a){rp(a);rp(this.gfx);a.loop=!1;a.gotoAndStop(0);a.gotoAndPlay(0);this.gfx=a;this.updateGraphics();SM.inst.fg.addChild(a);a.animationSpeed=.5;this.updateGraphics();var c=this;c.return2Pool=c.gfx;c.lifeTime=800;c.gfx.onComplete=function(){c.destroy()}}else this.destroy()}};extend(CBoosterBox,CObj,!0);
function CBoosterBox(a,b,c){CObj.apply(this,[a,b,null,null]);this.gravityEnabled=!0;this.colGroup=1;this.colMask=CG_PLAYER;this.gravPower=.46;this.radius=15;this.gfx=crsp("booster box");LauncherBG.inst.ol.addChild(this.gfx);this.updateGraphics();this.allowTrackSpeed=!0}CBoosterBox.prototype.destroy=function(){this.drone=null;CObj.prototype.destroy.call(this)};
CBoosterBox.prototype.getBooster=function(){if(gameStage.player.pickupBooster){var a=[{name:"Magnet",cls:CMagnetBooster},{name:"Tablets",cls:CTabletsBooster},{name:"Health",cls:CHeartBooster},{name:"MarioStar",cls:CSupermanBooster},{name:"Double",cls:CDoubleBooster}];gameStage.tutorial&&(a=[{name:"Tablets",cls:CTabletsBooster}]);var b=getRand(a);if(CBooster.list)for(a=0;a<CBooster.list.length;++a)if(CObj.checkType(CBooster.list[a],b.cls)){var c=CBooster.list[a];break}for(a=0;a<PlayerData.inst.items.length&&
PlayerData.inst.items[a].name!=b.name;++a);var d=PlayerData.inst.getUpgrade(PlayerData.inst.items[a]).upgr,e=new b.cls(SCR_WIDTH/2,SCR_HEIGHT/2,null,d);e.name=b.name;e.item_id=PlayerData.inst.items[a].id;c?(a=c.x,c.duration+=e.duration,e.destroy()):(c&&(b=CBooster.list.indexOf(e),0<=b&&CBooster.list.splice(b,1)),e.gfx=crsp(PlayerData.inst.items[a].gfx),e.gfx.scale.x=.3,e.gfx.scale.y=.3,e.updateGraphics(),new TweenMax(e.gfx.scale,.3,{x:.6,y:.6,repeat:2,yoyo:!0}),a=35+50*(CBooster.list.length-1),new TweenMax(e,
.7,{delay:.8,x:a,y:100}),a=function(){e.onActivate()},c&&(a=function(){e.destroy()}),new TweenMax(e.gfx.scale,.7,{delay:.8,x:.3,y:.3,onComplete:a}),SM.inst.guiLayer.addChild(e.gfx))}};
CBoosterBox.prototype.collide=function(a){if(!this.isCollected)if(this.isCollected=!0,this.gravityEnabled=!1,this.vy=this.vx=0,this.allowTrackSpeed=!1,a=pool.Pop("coinCollect"),ZSound.Play("coin"),a){this.getBooster();this.drone&&(this.drone.flyAway(),this.drone=null);rp(a);rp(this.gfx);a.loop=!1;a.gotoAndStop(0);a.gotoAndPlay(0);this.gfx=a;this.updateGraphics();SM.inst.fg.addChild(a);this.updateGraphics();var b=this;b.return2Pool=b.gfx;b.lifeTime=800;b.gfx.onComplete=function(){b.destroy()}}else this.destroy()};
extend(CMonster,CLiveObj,!0);
function CMonster(a,b,c,d){CLiveObj.apply(this,[a,b,c,null]);this.radius=50;this.xp=1;this.colGroup=CG_MONSTER;this.colMask=CG_PLAYER;this.jumpTimeCoef=this.highCoef=1;CMonster.list||(CMonster.list=[]);CMonster.list.push(this);this.maxHp=50;this.spawnCoins=!0;this.coinAmount=4;this.hp=this.maxHp;if(1==d||null==d)this.bar=new CHPBar(a,b,"health bar empty"),this.bar.upperImage="health bar full",this.bar.init(),this.bar.prop=1,this.barOffsetX=this.barOffsetY=0;this.dmg=1}
CMonster.prototype.collide=function(a){this.prekilled||this.doRemove||this.hitDone||(a.dealDamage(this.dmg),0<a.invulnerable||(this.hitDone=!0))};CMonster.prototype.process=function(){this.bar&&(this.bar.x=this.x-.5*this.bar.gfx.width-10+this.barOffsetX,this.bar.y=this.y-1.5*this.radius+this.barOffsetY);470<this.y&&this.rollLeave&&(this.av-=.01,-.2>this.av&&(this.av=-.2),this.gravityEnabled=!1,new TweenMax(this,.7,{vx:-20}),this.vy=0);CLiveObj.prototype.process.call(this)};
CMonster.prototype.kill=function(){if(this&&!this.prekilled){if(this.spawnCoins){var a=5;gameStage.player.doubleBooster&&(a*=gameStage.player.doubleBooster);for(var b=0;b<a;++b).3<Math.random()||CCoin.spawnCoin(this.x,this.y,this.coinAmount)}this.prekilled=!0;this.bar&&new TweenMax(this.bar.gfx,.2,{width:3*this.bar.gfx.width,height:0});PlayerData.inst.progressAch("Gold medal 10",.01,!1);PlayerData.inst.progressAch("Gold medal 11",.005,!1);PlayerData.inst.gainExp(this.xp);a=this.gfx.parent;a.removeChild(this.gfx);
if(bloodgfx=pool.Pop("bloodblow")){this.gfx=bloodgfx;this.gfx.anchor.x=.5;this.gfx.anchor.y=.5;this.gfx.scale.x=1.8;this.gfx.scale.y=1.8;this.gfx.animationSpeed=.6;this.updateGraphics();a.addChild(this.gfx);this.gfx.loop=!1;this.gfx.gotoAndPlay(0);var c=this;this.return2Pool=this.gfx;this.lifeTime=800;this.gfx.onComplete=function(){c.destroy()}}else CLiveObj.prototype.kill.call(this);this.updateGraphics()}};
CMonster.prototype.destroy=function(){if(!this.doRemove){this.bar&&this.bar.destroy();this.bar=null;var a=CMonster.list.indexOf(this);CMonster.list.splice(a,1);CObj.prototype.destroy.call(this)}};CMonster.prototype.longJump=function(a,b,c,d,e,f,g){g||(g=40);a=1;this.gravityEnabled=!0;this.jumpTimeCoef=1;f||(f=0);f=1+f;this.gravPower=(b+.025*a)*f;this.vy=-this.gravPower*g*f;this.allowTrackSpeed=!1;this.gravityEnabled=!0;this.vx=d-a;new TweenMax(this,e,{vx:c-a,yoyo:!0,repeat:1})};
extend(JumpMon,CMonster,!0);function JumpMon(a,b,c,d){CMonster.apply(this,[a,b,c,d]);this.rollLeave=!1}JumpMon.prototype.process=function(){CMonster.prototype.process.call(this)};extend(CDrone,CMonster,!0);function CDrone(a,b,c,d){CMonster.apply(this,[a,b,c,d]);this.metall=!0;var e=this;new TweenMax.delayedCall(1,function(){e.spawnGrenade()})}
CDrone.prototype.spawnGrenade=function(){if(!this.doRemove){var a=new CGrenade(this.x,this.y+60);a.owner=this;a.life=10;a.dmg=40;a.rotation=Math.PI/2;a.av=.2;a.vx=-3;a.gfx.tint=16711680;a.gravityEnabled=!0;a.colGroup=CG_GROUND;a.colMask=CG_PLAYER;var b=this;new TweenMax.delayedCall(1,function(){b.spawnGrenade()})}};CDrone.prototype.process=function(){CMonster.prototype.process.call(this)};extend(CDrone2,CMonster,!0);function CDrone2(a,b,c,d){CMonster.apply(this,[a,b,c,d]);this.metall=!0}
extend(CObstacle,CMonster,!0);function CObstacle(a,b,c,d){CMonster.apply(this,[a,b,c,d])}CObstacle.prototype.dealDamage=function(a){CMonster.prototype.dealDamage.call(this,a)};CObstacle.prototype.collide=function(a){this.collided||a!=gameStage.player||(CMonster.prototype.collide.call(this,a),this.collided=!0,gameStage.player.onDmgAnim(this))};extend(CBarrel,CObstacle,!0);function CBarrel(a,b,c,d){CObstacle.apply(this,[a,b,c,!1]);this.metall=!0}
CBarrel.prototype.kill=function(){this.doRemove||(this.destroy(),CGrenade.makeBoom(this.x,this.y,this.dmgExpl,350))};extend(Boss1,CMonster,!0);
function Boss1(a,b,c,d){this.hitTestCircles=[{x:10,y:0,r:60},{x:10,y:-130,r:60},{x:0,y:-260,r:60}];CMonster.apply(this,[a,b,null,null]);this.gfx=new PIXI.Spine(c);this.gfx.state.setAnimationByName(0,"idle",!0);this.gfx.scale.x=.48;this.gfx.scale.y=.48;this.updateGraphics();this.maxHp=1E3;this.xp=250;this.hp=this.maxHp;this.bar.gfx.width*=2;this.barOffsetY=-360;LauncherBG.inst.ol.addChild(this.gfx);var e=this;this.fireDelay=1.75;this.b1=this.gfx.skeleton.findSlot("b_bullet1");this.b2=this.gfx.skeleton.findSlot("b_bullet2");
this.gfx.skeleton.setAttachment("b_low_arm","b_low_arm");this.gfx.skeleton.setAttachment("b_legs","b_legs");this.gfx.skeleton.setAttachment("b_body","b_body");this.gfx.skeleton.setAttachment("b_head","b_head");this.gfx.skeleton.setAttachment("b_top_body","b_top_body");this.gfx.stateData.setMixByName("idle","shot",.2);this.gfx.stateData.setMixByName("shot","idle",.1);this.gfx.skeleton.setAttachment("disp1","disp1");this.gfx.skeleton.setAttachment("b_bomb",null);TweenMax.delayedCall(this.fireDelay,
function(){e.fire()})}Boss1.prototype.fire=function(){this.gfx.state.setAnimationByName(0,"shot",!1);var a=this;TweenMax.delayedCall(.5,function(){a.fireBullet(1);a.fireBullet(1);a.fireBullet(1)});TweenMax.delayedCall(1.3,function(){a.fireBullet(2);a.fireBullet(2);a.fireBullet(2)});TweenMax.delayedCall(1.7,function(){a.goIdle()})};Boss1.prototype.setRandDisp=function(){var a="disp"+(1+Math.floor(5*Math.random())).toString();this.gfx.skeleton.setAttachment("disp1",a)};
Boss1.prototype.goIdle=function(){var a=this;this.gfx&&(this.gfx.state.setAnimationByName(0,"idle",!0),this.setRandDisp(),TweenMax.delayedCall(1,function(){a.fire()}))};
Boss1.prototype.fireBullet=function(a){if(!this.doRemove){a=(1==a?this.b1:this.b2).currentSprite.toGlobal({x:0,y:0});this.firePointX=a.x/SCR_SCALE;this.firePointY=a.y/SCR_SCALE;a=new CMonster(this.firePointX,this.firePointY,null,!1);a.gfx=CObj.createMovieClip("b_bullet");a.gfx.anchor.x=.5;a.gfx.anchor.y=.5;a.gfx.animationSpeed=.33;a.gfx.play();LauncherBG.inst.ol.addChild(a.gfx);a.gfx.scale.x=.8;a.gfx.scale.y=.8;a.maxHp=10;a.hp=a.maxHp;a.xp=5;a.radius=35;a.av=.1*(Math.random()-.5);a.spawnCoins=!1;
a.gravityEnabled=!0;a.jumpTimeCoef=1;var b=.8+.4*(Math.random()-.5);a.gravPower=(.14+.1*Math.random())*b;a.vy=20*-a.gravPower*b;a.allowTrackSpeed=!1;new TweenMax(a,1.6+.5*Math.random(),{x:-100,ease:Linear.easeIn})}};Boss1.prototype.showUpAnimation=function(){var a=this;new TweenMax(this,3,{x:this.x-450,onComplete:function(){new TweenMax(a,5,{x:a.x+80,yoyo:!0,repeat:-1})}})};Boss1.prototype.kill=function(){CMonster.prototype.kill.call(this);PlayerData.inst.progressAch("Gold medal 7",1,!1)};
Boss1.prototype.destroy=function(){CMonster.prototype.destroy.call(this);MM.inst.currentBoss=null};extend(Boss2,Boss1,!0);
function Boss2(a,b,c,d){Boss1.apply(this,[a,b,c,null]);this.hp=this.maxHp=1600;this.xp=400;this.gfx.skeleton.setAttachment("b_legs","b_legs1");this.gfx.skeleton.setAttachment("b_body","b_body1");this.gfx.skeleton.setAttachment("b_head","b_head1");this.gfx.skeleton.setAttachment("b_top_body","b_top_body1");this.gfx.skeleton.setAttachment("b_low_arm","b_low_arm1");this.gfx.skeleton.setAttachment("b_low_arm","b_low_arm1");this.gfx.skeleton.setAttachment("b_bomb","b_bomb");this.setRandDisp()}
Boss2.prototype.setRandDisp=function(){var a=(1+Math.floor(5*Math.random())).toString(),a="disp"+a+a;console.log("set disp "+a.toString());this.gfx.skeleton.setAttachment("disp1",a)};
Boss2.prototype.fireGrenade=function(){var a=this.gfx.skeleton.findSlot("b_bomb").currentSprite.toGlobal({x:0,y:0}),b=a.x/SCR_SCALE,c=a.y/SCR_SCALE;this.colGroup=CG_MONSTER;this.colMask=CG_PLAYER;this.gfx.state.setAnimationByName(0,"drop bomb",!1);var d=this;TweenMax.delayedCall(.15,function(){var a=new CGrenade(b,c);a.vy=15;a.owner=d;a.life=10;a.dmg=40;a.rotation=Math.PI/2;a.av=.2;a.vx=-3;a.gfx.tint=16711680;a.gravityEnabled=!0;a.colGroup=CG_GROUND;a.colMask=CG_PLAYER})};
Boss2.prototype.fire=function(){this.gfx.state.setAnimationByName(0,"shot",!1);var a=this;TweenMax.delayedCall(.5,function(){a.fireBullet(1);a.fireBullet(1);a.fireBullet(1)});TweenMax.delayedCall(1.3,function(){a.fireBullet(2);a.fireBullet(2);a.fireBullet(2)});.5>Math.random()?TweenMax.delayedCall(1.7,function(){a.goIdle()}):(TweenMax.delayedCall(2,function(){a.fireGrenade()}),TweenMax.delayedCall(2.3,function(){a.goIdle()}))};
MM=function(){this.patterns=[{mons:"+.",diff:1,prob:.8},{mons:"s..000l00..s.",diff:1,prob:1},{mons:"f..000..c.",diff:1,prob:1},{mons:"f..f00szf..000",diff:1,prob:1},{mons:"s.s..ssc..ss000",diff:1,prob:1},{mons:".g..s.gs.l.l.",diff:1,prob:1},{mons:".s..s..s..c",diff:1,prob:1},{mons:".s00z00s..z",diff:1,prob:1},{mons:".b..b..c..b.b.",diff:1,prob:1},{mons:".ss..ss.s..l...ss..l.l..s",diff:1,prob:1},{mons:".l..zz.ss.c.",diff:1,prob:1},{mons:".c.gc..",diff:1,prob:1},{mons:".c..c..o000s.s.",diff:1,prob:1},
{mons:".z...c.s.s.sc..",diff:2,prob:1},{mons:".z...c.z..",diff:2,prob:1},{mons:"+.",diff:2,prob:.8},{mons:"j",diff:2,prob:.4},{mons:".lbb..c.",diff:2,prob:1},{mons:".c..?.?.?.",diff:2,prob:1},{mons:".f...z...f..c.",diff:2,prob:1},{mons:".l.lz..c..z..c...c..s..l..s.l",diff:2,prob:1},{mons:".lsslss0000l00l.l..",diff:3,prob:1},{mons:".o..lo..l..",diff:3,prob:1},{mons:".c.g..gl",diff:3,prob:1},{mons:"..f..f.z.o..f..",diff:3,prob:1},{mons:"jd..df...f.",diff:4,prob:1},{mons:"..dz..d..z.z",diff:4,prob:1},
{mons:"+.",diff:3,prob:.8},{mons:".F..l.l.F..l.",diff:4,prob:1},{mons:".b.bf..",diff:4,prob:.1},{mons:"..s.sss..s..l",diff:4,prob:1},{mons:"l.l.l...ssl.lbl.l.",diff:4,prob:1},{mons:"f..c.flf.c00",diff:5,prob:1},{mons:".c..c..z..s..sc..sc..sc..",diff:5,prob:1},{mons:"+.",diff:5,prob:.8},{mons:".f.ffc..c..",diff:5,prob:1},{mons:".b..bbb..bbbbbbb..",diff:5,prob:.1},{mons:"gg.g...g..g..G.GG.",diff:5,prob:1},{mons:"zzz.z..G.GG.zzz.",diff:5,prob:1},{mons:"..ss..ss.s..lll.ss..l...l...s",diff:6,prob:1},{mons:".b.bf.?.",
diff:6,prob:.1},{mons:".c..c.l..g.g00g",diff:6,prob:1},{mons:".c..c..l..g..g..g",diff:6,prob:1},{mons:"j",diff:6,prob:.4},{mons:"..s..s..dss",diff:6,prob:.1},{mons:"+.",diff:6,prob:.8},{mons:"h.llH.lzh..H.l.l",diff:7,prob:1},{mons:".b..bbb..bbbbb000bbbbbbb..",diff:7,prob:.1},{mons:".o.H.H..l..",diff:7,prob:1},{mons:".z..zz...zz.z...zz.zz.",diff:7,prob:1},{mons:".czgG.gFl...",diff:7,prob:1},{mons:"h..c.hsh.?.",diff:8,prob:1},{mons:".c.b.cbb..lb.gG.Gg..g.",diff:8,prob:1},{mons:"+.",diff:8,prob:.8},
{mons:"o...ss.s.s.d..o.o..",diff:8,prob:1},{mons:"Fz.Fz.zFz.",diff:8,prob:1},{mons:"bb..o..b.o.H.h..c",diff:9,prob:1},{mons:".c.chH..h..H..000000",diff:10,prob:1},{mons:"ss...ssss..b.l..c",diff:10,prob:1},{mons:".z..zz...zzz..G.zzzz.",diff:10,prob:1}];this.carClips=["car","car1","car2"];this.bosses=[{cls:Boss1,dist:1E3},{cls:Boss2,dist:2E3}];this.monY=360;this.sNormal=1;this.sBoss=2;this.lastSpawnPlane=this.lastStep=0;this.currentBoss=null;this.state=this.sNormal;this.stepDelay=330};MM.inst=new MM;
MM.prototype.init=function(){this.distXP=.005;this.simpleRandomSpawn=[this.spawnCoin,this.spawnDrone,this.spawnFatty,this.spawnFatty2,this.spawnGopnick,this.spawnGopnick2,this.spawnSimpleMonster,this.spawnSimpleMonster,this.spawnSimpleMonster];this.bossDistance=0;this.monsterQueue=MM.inst.generateMonsterQueue()};
MM.prototype.spawnPlane=function(){var a=-200,b;.5<Math.random()?(b=(Math.random()-.5)*Math.PI/12,a=-200):(b=Math.PI+(Math.random()-.5)*Math.PI/12,a=SCR_WIDTH+200);a=new CPlane(a,50+150*Math.random(),"plane");rp(a.gfx);LauncherBG.inst.planeLayer.addChild(a.gfx);a.rotation=b;a.vx=Math.cos(a.rotation)/8;a.vy=Math.sin(a.rotation)/8};
MM.prototype.generateMonsterQueue=function(){this.debugArray=[];for(var a=[],b=0,c=0;c<this.patterns.length;++c)this.patterns[c].diff>b&&(b=this.patterns[c].diff);for(c=1;c<=b;++c)a.push({diff:c,prob0:0,prob1:0});for(var b=[],d=0,e=PlayerData.inst.playerItem.lvl/4.5-.5,f,c=0;3E3>c;++c){var g=d/200;g>a.length&&(g=a.length);for(var k=Math.sin(d/50)*(1+.05*g)+g+e,h=g=0;h<a.length;++h){var l=1/(Math.abs(a[h].diff-k)+1),l=Math.pow(l,1.7);0<h?(a[h].prob1=a[h-1].prob1+l,a[h].prob0=a[h-1].prob1):(a[h].prob1=
l,a[h].prob0=0);g+=l}l=Math.random()*g;for(h=0;h<a.length&&!(l>a[h].prob0&&l<=a[h].prob1);++h);for(var g=0,m=a[h].diff,k=a[h].prob1-a[h].prob0,h=0;h<this.patterns.length;++h)this.patterns[h].diff==m&&(l=this.patterns[h].prob,f?(this.patterns[h].prob1=f.prob1+l,this.patterns[h].prob0=f.prob1):(this.patterns[h].prob1=l,this.patterns[h].prob0=0),f=this.patterns[h],g+=l);f=null;l=Math.random()*g;for(h=0;h<this.patterns.length&&!(this.patterns[h].diff==m&&l>this.patterns[h].prob0&&l<=this.patterns[h].prob1);++h);
b+=this.patterns[h].mons;this.debugArray.push({pid:h,diff:this.patterns[h].diff,start:d,prob:(this.patterns[h].prob1-this.patterns[h].prob0)/g,probDiff:k});d+=this.patterns[h].mons.length}this.currentPattern=this.debugArray[0];return b};
MM.prototype.spawnObstacle=function(a,b,c,d){a=new CObstacle(SCR_WIDTH+240,450+2*b,a,!1);a.maxHp=1E8;a.hp=a.maxHp;a.gfx.scale.x=.8;a.gfx.scale.y=.8;a.gfx.anchor.y=.5+b/(a.gfx.height/a.gfx.scale.y);a.radius=.94*(a.gfx.width/2-10);d&&(a.radius+=d);a.offsY=-c;a.colGroup=0;a.allowTrackSpeed=!0;this.lastSpawnSimple=(new Date).getTime();this.simpleMonsterDelay=1E3*Math.random()+2E3};MM.prototype.spawnCoin=function(a){a=new CCoin(SCR_WIDTH+240,428,1);a.vy=0;a.gravityEnabled=!1};
MM.prototype.spawnBarrel=function(a,b,c){a=new CBarrel(SCR_WIDTH+240,450+2*b,a,!0);a.gfx.scale.x=.8;a.gfx.scale.y=.8;a.maxHp=50;a.hp=a.maxHp;a.gfx.anchor.y=.5+b/(a.gfx.height/a.gfx.scale.y);a.dmgExpl=250;a.dmg=1;a.radius=a.gfx.width/2+12;a.offsY=-c;a.allowTrackSpeed=!0};
MM.prototype.spawnCar=function(a,b,c){a=getRand(this.carClips);a=new CObstacle(SCR_WIDTH+240,450+2*b,a,!1);a.gfx.scale.x=.8;a.gfx.scale.y=.8;a.maxHp=111180;a.hp=a.maxHp;a.gfx.anchor.y=.5+b/(a.gfx.height/a.gfx.scale.y);a.radius=(a.gfx.width-50)/2*.94;a.gfx.scale.x=.7;a.gfx.scale.y=.7;a.offsY=-c;a.allowTrackSpeed=!0;a.colGroup=0};
MM.prototype.spawnDrone=function(a){a=new CDrone(SCR_WIDTH+100,80,"dron");a.gfx.anchor.x=.5;a.vx=-1;a.allowTrackSpeed=!1;a.gravityEnabled=!1;new TweenMax(a,1,{y:a.y+80,ease:Sine.easeInOut,yoyo:!0,repeat:10});a.maxHp=190;a.hp=a.maxHp;a.barOffsetX=10;a.xp=15+LauncherBG.inst.distance*this.distXP};
MM.prototype.spawnBoosterDrone=function(){var a=new CBoosterDrone(SCR_WIDTH+100,80,"booster dron");a.gfx.anchor.x=.5;a.vx=-1;a.allowTrackSpeed=!1;a.gravityEnabled=!1;new TweenMax(a,1,{y:a.y+80,ease:Sine.easeInOut,yoyo:!0,repeat:15});a.maxHp=80;a.hp=a.maxHp;a.barOffsetX=10;a.xp=5+LauncherBG.inst.distance*this.distXP};
MM.prototype.spawnDrone2=function(a){a=new CDrone2(SCR_WIDTH+100,a,"dron2");a.gfx.anchor.x=.5;a.vx=-4;a.allowTrackSpeed=!1;a.gravityEnabled=!1;new TweenMax(a,1,{y:a.y+30,ease:Sine.easeInOut,yoyo:!0,repeat:10});new TweenMax(a,.6,{vx:-12,ease:Sine.easeInOut,yoyo:!0,repeat:5});a.maxHp=100;a.hp=a.maxHp;a.barOffsetX=10;a.xp=10+LauncherBG.inst.distance*this.distXP};
MM.prototype.spawnBonusGnome=function(a){var b=new BonusMonGnome(SCR_WIDTH+100,150,"enemy1_1");b.gfx.scale.x=.8;b.gfx.scale.y=.8;b.maxHp=400;b.hp=b.maxHp;b.xp=a+LauncherBG.inst.distance*this.distXP};MM.prototype.spawnJumpMon=function(){var a=new JumpMon(SCR_WIDTH+120,this.monY-200,"enemy1_2");a.gfx.scale.x=.8;a.gfx.scale.y=.8;a.av=.1*Math.random();a.longJump(1,.25,-1,-3,1.2);a.maxHp=170;a.hp=a.maxHp;a.xp=6+LauncherBG.inst.distance*this.distXP};
MM.prototype.spawnFatty=function(){var a=new CMonster(SCR_WIDTH+100,this.monY,"enemy1");a.rollLeave=!0;a.gfx.scale.x=.8;a.gfx.scale.y=.8;a.longJump(1,.13,-4,-13,1.2);new TweenMax(a,1.2,{rotation:-Math.PI/15});a.maxHp=100;a.hp=a.maxHp;a.xp=5+LauncherBG.inst.distance*this.distXP};
MM.prototype.spawnFatty2=function(a){a=new CMonster(SCR_WIDTH+100,this.monY,"enemy1_1");a.rollLeave=!0;a.gfx.scale.x=.8;a.gfx.scale.y=.8;a.longJump(1,.2,-6,-15,1.2);new TweenMax(a,1.2,{rotation:-Math.PI/15});a.maxHp=100;a.hp=a.maxHp;a.xp=6+LauncherBG.inst.distance*this.distXP};
MM.prototype.spawnGopnick=function(a){a=new CMonster(SCR_WIDTH+100,this.monY,"enemy3");a.rollLeave=!0;a.jumpTimeCoef=.7;a.gfx.scale.x=.8;a.gfx.scale.y=.8;a.maxHp=60;a.hp=a.maxHp;new TweenMax(a,1.2,{rotation:-Math.PI/15});a.longJump(1,.2,-5-2*Math.random(),-16-2*Math.random(),1.1,0,38);a.xp=7+LauncherBG.inst.distance*this.distXP};
MM.prototype.spawnGopnick2=function(a){a=new CMonster(SCR_WIDTH+100,this.monY,"enemy3_3");a.rollLeave=!0;a.jumpTimeCoef=.6;a.gfx.scale.x=.8;a.gfx.scale.y=.8;a.maxHp=80;a.hp=a.maxHp;new TweenMax(a,1.2,{rotation:-Math.PI/15});a.longJump(1,.2,-8-2*Math.random(),-21-2*Math.random(),.8,0,30);a.xp=8+LauncherBG.inst.distance*this.distXP};MM.prototype.spawnRandomMonster=function(a){getRand(this.simpleRandomSpawn).call(this)};
MM.prototype.spawnSimpleMonster=function(a){a="enemy2";.5<Math.random()&&(a="enemy2_2");a=new CMonster(SCR_WIDTH+100,this.monY,a);a.rollLeave=!0;a.gfx.scale.x=.8;a.gfx.scale.y=.8;new TweenMax(a,1.2,{rotation:-Math.PI/15});a.longJump(1,.14,-6,-12,1.2-.15*Math.random());a.xp=4+LauncherBG.inst.distance*this.distXP};
MM.prototype.doStep=function(){var a=this.monsterQueue.charAt(0);this.monsterQueue=this.monsterQueue.slice(1);this.totalD||(this.totalD=0);this.totalD++;for(var b=0;b<this.debugArray.length;++b)this.debugArray[b].start==MM.totalD&&(this.currentPattern=this.debugArray[b]);this.diff=LauncherBG.inst.distance/1E3;"s"==a&&this.spawnSimpleMonster(5);"f"==a&&this.spawnFatty();"F"==a&&this.spawnFatty2();"G"==a&&this.spawnGopnick2();"g"==a&&this.spawnGopnick();"c"==a&&this.spawnCar("car",40,0);"l"==a&&this.spawnObstacle("luke",
40,10);"z"==a&&this.spawnObstacle("conus",20,0,-9);"j"==a&&this.spawnBonusGnome(5);"d"==a&&this.spawnDrone();"h"==a&&this.spawnDrone2(120);"H"==a&&this.spawnDrone2(330);"b"==a&&this.spawnBarrel("barrel",20,0,-5);"?"==a&&this.spawnRandomMonster();"0"==a&&this.spawnCoin(440);"o"==a&&this.spawnJumpMon();"+"==a&&this.spawnBoosterDrone();0==this.monsterQueue.length&&(this.noMonsLeft=!0)};
MM.prototype.process=function(){var a=PauseTimer.getTimer(),b=Math.floor(LauncherBG.inst.distance/4.5);0==Math.floor(LauncherBG.inst.distance)%250&&.5>Math.random()&&6E4<a-this.lastSpawnPlane&&(this.spawnPlane(),this.lastSpawnPlane=a);b!=this.prevS&&(!this.currentBoss&&0<this.bosses.length&&4.5*this.prevS-this.bossDistance<this.bosses[0].dist&&LauncherBG.inst.distance-this.bossDistance>=this.bosses[0].dist?(this.currentBoss=new (this.bosses.shift().cls)(SCR_WIDTH+200,500,"imgtps/boss1.json"),this.currentBoss.showUpAnimation()):
this.currentBoss&&(this.bossDistance+=4.5),this.currentBoss||this.doStep());this.prevS=b};extend(BonusMonGnome,CMonster,!0);
function BonusMonGnome(a,b,c,d){CMonster.apply(this,[a,b,null,d]);this.gfx=new PIXI.Spine("imgtps/bird.json");this.gfx.state.setAnimationByName(0,"animation",!0);this.gfx.scale.x=.48;this.gfx.scale.y=.48;this.updateGraphics();LauncherBG.inst.ol.addChild(this.gfx);this.xp=20;this.lastDrop=0;this.allowTrackSpeed=!1;var e=this;new TweenMax(this,18,{vx:-40,ease:Circ.easeIn,onComplete:function(){e.destroy()}})}BonusMonGnome.prototype.collide=function(a){};
BonusMonGnome.prototype.dealDamage=function(a){CMonster.prototype.dealDamage.call(this,a);200<PauseTimer.getTimer()-this.lastDrop&&(this.lastDrop=PauseTimer.getTimer(),a=3,gameStage.player.doubleBooster&&(a*=gameStage.player.doubleBooster),CCoin.spawnCoin(this.x,this.y,a))};extend(CBoosterDrone,CMonster,!0);
function CBoosterDrone(a,b,c,d){this.bdy=67;this.bdx=2;this.boosterBox=new CBoosterBox(this.x,this.y+this.bdy);this.boosterBox.allowTrackSpeed=!1;this.boosterBox.gravityEnabled=!1;this.boosterBox.drone=this;CMonster.apply(this,[a,b,c,!1]);this.metall=!0}CBoosterDrone.prototype.collide=function(a){};CBoosterDrone.prototype.flyAway=function(){TweenMax.killTweensOf(this);this.vy=-3;this.vx*=4.4};
CBoosterDrone.prototype.dealDamage=function(){this.spawned||(this.boosterBox.gravityEnabled=!0,this.boosterBox.allowTrackSpeed=!0,this.boosterBox.vx=6.5,this.boosterBox.vy=-10,this.boosterBox=this.boosterBox.drone=null,this.spawned=!0,this.flyAway());CLiveObj.prototype.dealDamage.call(this)};CBoosterDrone.prototype.process=function(){this.boosterBox&&(this.boosterBox.x=this.x+this.bdx,this.boosterBox.y=this.y+this.bdy);CMonster.prototype.process.call(this)};extend(CCoin,CObj,!0);
function CCoin(a,b,c){CObj.apply(this,[a,b,null,null]);this.gravityEnabled=!0;this.colGroup=1;this.colMask=CG_PLAYER;this.gravPower=.7;this.radius=15;this.gfx=CObj.createMovieClip("coin");this.gfx.anchor.x=.5;this.gfx.anchor.y=.5;this.gfx.scale.x=.7;this.gfx.scale.y=.7;this.gfx.animationSpeed=.25;this.gfx.play();LauncherBG.inst.ol.addChild(this.gfx);this.updateGraphics();this.amount=c;this.allowTrackSpeed=!0;CCoin.coins||(CCoin.coins=[]);CCoin.coins.push(this)}
CCoin.spawnCoin=function(a,b,c){a=new CCoin(a,b,c);a.allowTrackSpeed=!0;a.vx=6.5+1*(Math.random()-.5);a.vy=-10-12*Math.random();return a};
CCoin.prototype.collide=function(a){if(!this.isCollected)if(this.isCollected=!0,PlayerData.inst.score+=this.amount,gameStage.updateScore(),this.gravityEnabled=!1,this.vy=this.vx=0,this.allowTrackSpeed=!1,a=pool.Pop("coinCollect"),ZSound.Play("coin"),a){rp(a);rp(this.gfx);a.loop=!1;a.gotoAndStop(0);a.gotoAndPlay(0);this.gfx=a;this.updateGraphics();SM.inst.fg.addChild(a);a.animationSpeed=.5;this.updateGraphics();var b=this;b.return2Pool=b.gfx;b.lifeTime=800;b.gfx.onComplete=function(){b.destroy()}}else this.destroy()};
extend(CScrollbar,CObj,!0);Object.defineProperty(CScrollbar.prototype,"pos",{get:function(){return this._pos},set:function(a){0>a&&(a=0);a>this.ph-this.toucher.height/2&&(a=this.ph-this.toucher.height/2);this._pos=a;this.toucher.y=this.toucher.height/2+a/this.ph*(this.ph0-this.toucher.height)-this.ph0/2;this.container.y=-this.ph0/2-a*this.posScale}});CScrollbar.prototype.updateHeight=function(){this.ph=this.container.height};
CScrollbar.prototype.clear=function(){for(var a=0;a<this.container.children.length;++a)this.container.children[a].destroy?this.container.children[a].destroy():(this.container.removeChild(this.container.children[a]),a--)};
CScrollbar.prototype.destroy=function(){this.toucher.mousedown=null;this.toucher.mouseup=null;this.toucher.mousemove=null;this.toucher.mouseupoutside=null;this.toucher=this.toucher.scrollbar=null;this.bar.mousedown=null;this.sbMask=this.container=this.bar=this.bar.scrollbar=null;CObj.prototype.destroy.call(this)};CScrollbar.prototype.onWheel=function(a,b,c,d){a.stopPropagation();a.stopImmediatePropagation();this.pos-=25*b};
function CScrollbar(a,b,c,d,e,f,g,k,h){c="shop back.png";f&&(c=f);CObj.apply(this,[a,b,null,null]);this.gfx=new PIXI.DisplayObjectContainer;this.gui=!0;this.pw=d;this.ph0=this.ph=e;h||(h=0);SM.inst.fg.addChildAt(this.gfx,0);d="scroll line element.png";g&&(d=g);g="scroll.png";k&&(g=k);var l=this;this.gfx.interactive=!0;this.gfx.mouseover=function(){l.mover=!0};this.gfx.mouseout=function(){l.mover=!1};this.bg=new PIXI.Sprite(PIXI.Texture.fromFrame(c));this.bg.width=this.pw+h;this.bg.height=this.ph+
h;this.bg.anchor.x=.5;this.bg.anchor.y=.5;this.gfx.addChild(this.bg);this.updateGraphics();this.toucher=new PIXI.Sprite(PIXI.Texture.fromFrame(g));this.toucher.width=8;this.toucher.anchor.x=.5;this.toucher.anchor.y=.5;this.toucher.x=this.pw/2-4;this.toucher.interactive=!0;this.toucher.scrollbar=this;this.toucher.mousedown=function(a){this.pressed=!0};this.toucher.mouseup=function(a){this.pressed=!1};this.toucher.mouseupoutside=this.toucher.mouseup;this.toucher.mousemove=function(a){this.pressed&&
this.scrollbar&&(this.scrollbar.pos=a.global.y/SCR_SCALE-this.scrollbar.y+this.scrollbar.ph/2)};this.bar=new PIXI.Sprite(PIXI.Texture.fromFrame(d));this.bar.width=8;this.bar.height=this.ph;this.bar.anchor.x=.5;this.bar.anchor.y=.5;this.bar.x=this.pw/2-4;this.bar.interactive=!0;this.bar.scrollbar=this;this.bar.mousedown=function(a){this.scrollbar.pos=a.global.y/SCR_SCALE-this.scrollbar.y+this.scrollbar.ph/2;this.scrollbar.toucher.pressed=!0};this.container=new PIXI.DisplayObjectContainer;this.container.x=
-this.pw/2;this.container.y=-this.ph/2;this.sbMask=new PIXI.Graphics;this.sbMask.beginFill();this.sbMask.drawRect(-this.pw/2,-this.ph/2,this.pw,this.ph);this.sbMask.endFill();this.container.mask=this.sbMask;this.gfx.addChild(this.sbMask);this.gfx.addChild(this.container);this.gfx.addChild(this.bar);this.gfx.addChild(this.toucher);this.pos=0;this.posScale=1;this.x=a;this.y=b}extend(CircleBar,CObj,!0);function CircleBar(a,b,c,d){CObj.apply(this,[a,b,c,d])}
CircleBar.generateProperty("pos",{defaultValue:1,get:function(){return this._pos},set:function(a){0>a&&(a=0);1<a&&(a=1);this._pos=a;this.mask.clear();var b=this.radius;a*=2*Math.PI;var c=Math.cos(a-Math.PI/2)*b,d=Math.sin(a-Math.PI/2)*b,e=[0,-b,0,0];a<Math.PI/2?e.push(c,d):(a<Math.PI?e.push(c,d):(a<3*Math.PI/2?e.push(c,d):(e.push(c,d),e.push(-b,0)),e.push(0,b)),e.push(b,0));this.mask.beginFill(4294967295);this.mask.drawPolygon(e);this.mask.endFill()}});
CircleBar.prototype.destroy=function(){this.progressfore=this.progressbg=this.ico=null;CObj.prototype.destroy.call(this)};CircleBar.prototype.process=function(){CObj.prototype.process.call(this)};
CircleBar.prototype.init=function(a,b,c){this.gfx=new PIXI.DisplayObjectContainer;this.ico=crsp(a);this.progressbg=crsp(c);this.progressfore=crsp(b);this.mask=new PIXI.Graphics;this.gfx.addChild(this.ico);this.radius=1.5*this.gfx.width;this.gfx.addChild(this.progressbg);this.gfx.addChild(this.progressfore);this.gfx.addChild(this.mask);this.progressfore.mask=this.mask;this.pos=0;this.updateGraphics()};extend(CEActionGUI,CircleBar,!0);
function CEActionGUI(a,b,c,d){CircleBar.apply(this,[a,b,c,d]);this.gui=!0}CEActionGUI.prototype.destroy=function(){this.eventpl=this.event=null;CircleBar.prototype.destroy.call(this)};CEActionGUI.prototype.process=function(){this.updateRecharge();CircleBar.prototype.process.call(this)};CEActionGUI.prototype.startAction=function(){this.acting||(this.acting=!0,this.progressbg.visible=!0,this.progressfore.visible=!0,this.pos=0,this.startTime=window.time,this.execTime=1E3*this.event.exectime)};
CEActionGUI.prototype.takeReward=function(){this.progressbg.visible=!1;this.progressfore.visible=!1;this.eventpl.reward_ready=!1;this.eventpl.lastused=new Date;this.event.money_gain&&(PlayerData.inst.playerItem.money+=this.event.money_gain);this.event.crystal_gain&&(PlayerData.inst.playerItem.crystals+=this.event.crystal_gain);this.event.xp_gain&&PlayerData.inst.gainExp(this.event.xp_gain);incMetric("USED EVENT "+this.event.name);"event1"==this.event.name&&PlayerData.inst.progressAch("Gold medal 6",
.1,!1);this.btnReward.destroy();this.btnReward=null;PlayerData.inst.savePlayerEvents(this.eventpl);PlayerData.inst.savePlayerData();shopStage.updateStatsPanel();this.acting=!1};CEActionGUI.prototype.endAction=function(){this.progressbg.visible=!1;this.acting=this.progressfore.visible=!1;this.eventpl.reward_ready=!0;PlayerData.inst.savePlayerEvents(this.eventpl);this.addRewardButton()};
CEActionGUI.prototype.addRewardButton=function(){this.btnReward=new CButton(268,-3,"take reward");this.btnReward.fontSize=17;this.btnReward.gfx.scale.x=1.1;this.btnReward.gfx.scale.y=1.1;rp(this.btnReward.gfx);this.btnReward.hover=!1;var a=this;this.btnReward.click=function(){a.takeReward()};this.btnReward.init();this.btnReward.gfx.interactive=!0;this.gfx.addChild(this.btnReward.gfx)};
CEActionGUI.prototype.updateRecharge=function(){if(this.eventpl){var a=this.eventpl.lastused?dateDiff(this.eventpl.lastused,this.event.delay_min):{d:-1};this.timeleft.tint=3355443;0>a.d&&this.event.reqlvl<=PlayerData.inst.playerItem.lvl?(a="",this.ready=this.ico.interactive=!0):(this.ico.interactive=!1,this.ico.alpha=.5,a=this.event.reqlvl>PlayerData.inst.playerItem.lvl?"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f "+this.event.reqlvl.toString()+" \u0443\u0440.":"\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u043e \u0447\u0435\u0440\u0435\u0437 "+
a.timeString,this.timeleft.tint=16711680,this.ready=!1);this.timeleft.text=a;this.timeleft.updateText()}};
CEActionGUI.prototype.init=function(a,b,c,d,e){CircleBar.prototype.init.call(this,c,d,e);this.eventpl=a;this.event=b;c=0;d="";0<this.event.xp_gain&&(c=this.event.xp_gain,d="price xp.png");0<this.event.money_gain&&(c=this.event.money_gain,d="price coin.png");0<this.event.crystal_gain&&(c=this.event.crystal_gain,d="price star.png");d=new PIXI.Sprite(PIXI.Texture.fromFrame(d));d.anchor.x=.5;d.anchor.y=.5;d.x=170;d.y=-2;this.gfx.addChild(d);this.rewText=CTextField.createTextField({tint:"0x333333",text:"\u041d\u0430\u0433\u0440\u0430\u0434\u0430",
fontSize:18,align:"center"});this.rewText.x=50;this.rewText.y=-12;this.gfx.addChild(this.rewText);this.timeleft=CTextField.createTextField({tint:"0x333333",text:"",fontSize:17,align:"center"});this.timeleft.x=50;this.timeleft.y=27;this.gfx.addChild(this.timeleft);c=CTextField.createTextField({tint:"0x333333",text:c.toString(),fontSize:16,align:"center"});c.x=170;c.y=-11;this.gfx.addChild(c);var f=this,g=this.ico;g.interactive=!0;var k=g.scale.x,h=g.scale.y;g.mouseover=function(){new TweenMax(g.scale,
.6,{y:h+.05,ease:Elastic.easeOut});new TweenMax(g.scale,.4,{x:k+.05,ease:Elastic.easeOut})};g.mouseout=function(){new TweenMax(g.scale,.6,{y:h,ease:Elastic.easeOut});new TweenMax(g.scale,.4,{x:k,ease:Elastic.easeOut})};g.click=function(){f.ready&&!a.reward_ready&&f.startAction()};this.progressbg.interactive=!0;this.progressbg.click=this.onclick;this.progressbg.tap=this.onclick;null==this.eventpl.lastused&&(this.pos=1);c=CTextField.createTextField({fontFamily:"dedgamedesc",tint:"0x1111111",text:b.desc,
fontSize:20,align:"center"});c.x=50;c.y=-55;this.gfx.addChild(c);this.eventpl.reward_ready&&this.addRewardButton();this.progressbg.visible=!1;this.progressfore.visible=!1};
CWeapon=function(a,b,c,d,e,f){this.lastShot=0;this.backupStats=d;this.resetParams();this.clipGfx=e;this.sReload=1;this.sFire=2;this.visualWidth=d.visualWidth;this.dw=d.dw;this.speed=d.speed;this.state=this.sFire;this.id=a;this.name=b;this.desc=c;this.unlocked=!1;this.upgrades=f;this.sound=d.sound;this.recoilValue=0;this.acc=this.backupStats.acc;CWeapon.list||(CWeapon.objects=[]);CWeapon.objects.push(this)};CWeapon.prototype.mouseUp=function(){};
CWeapon.prototype.resetParams=function(){this.ammo=this.backupStats.magcap;this.recoil=this.backupStats.recoil;this.delay=this.backupStats.delay;this.damage=this.backupStats.damage;this.magCapacity=this.backupStats.magcap;this.unlockPrice=this.backupStats.unlockPrice;this.reloadTime=this.backupStats.reloadTime;this.upgrCostLevel=this.backupStats.upgrCostLevel;this.life=this.backupStats.life};
CWeapon.prototype.process=function(){this.recoilValue-=.25;0>this.recoilValue&&(this.recoilValue=0);this.acc-=this.backupStats.accIncrease;this.acc<this.backupStats.acc&&(this.acc=this.backupStats.acc)};
CWeapon.prototype.shot=function(){if(!this.canShot()||this.state==this.sReload)return!1;this.sound&&ZSound.Play(this.sound);if(0>this.ammo)return this.reload(),!1;this.lastShot=window.time;this.acc+=this.backupStats.accRecoil;this.recoilValue+=this.recoil;this.ammo--;window.totalShots||(window.totalShots=0);window.totalShots++;0==this.ammo&&this.reload();this.updateAmmo();return!0};CWeapon.prototype.canShot=function(){return this.state==this.sReload?!1:window.time-this.lastShot>=this.delay?!0:!1};
CWeapon.prototype.updateAmmo=function(){gameStage.player.ammobar.text=this.ammo.toString()};
CWeapon.prototype.reload=function(){var a=this;a.state=this.sReload;gameStage.reloadBar.pos=0;gameStage.reloadBar.gfx.visible=!0;gameStage.ammoico.gfx.visible=!1;new TweenMax(gameStage.reloadBar,this.reloadTime/1E3,{pos:1});new TweenMax(this,this.reloadTime/1E3,{ammo:a.magCapacity});TweenMax.delayedCall(this.reloadTime/1E3,function(){gameStage.player&&(gameStage.ammoico.gfx.visible=!0,gameStage.reloadBar.gfx.visible=!1,a.state=a.sFire,a.ammo=a.magCapacity,a.updateAmmo())})};
CWeapon.prototype.retrieveData=function(){};CWeapon.prototype.applyUpgrades=function(a){for(var b=0;b<a.length;++b){var c=a[b];this[c.param]+=c.value}};extend(CPistol,CWeapon,!0);function CPistol(a,b,c,d,e,f){CWeapon.apply(this,[a,b,c,d,e,f])}CPistol.prototype.mouseUp=function(){this.lastShot-=.3*this.delay;console.log("MUP")};
CPistol.prototype.shot=function(){var a=CWeapon.prototype.shot.call(this);if(a){var b=gameStage.player.fireAngle+(superRand(6)-.5)*this.acc,c=Math.cos(b),d=Math.sin(b),e=gameStage.player.firePointX,f=gameStage.player.firePointY-14,g=crsp("fxblink.png");g.scale.x=1.3;g.scale.y=1.3;g.x=e+65*c;g.y=f+65*d;g.rotation=b;g.blendMode=PIXI.blendModes.ADD;SM.inst.fg.addChild(g);TweenMax.delayedCall(.03,function(){g.parent.removeChild(g)});50>Math.abs(gameStage.player.y-gameStage.player.baseY)&&(gameStage.player.vx=
-.5);e=new CBullet(e,f,null,null,this.visualWidth);e.life=this.life;e.dmg=this.damage;e.rotation=Math.PI/2+b;e.dw=this.dw;e.vx=c*this.speed;e.vy=d*this.speed;e.colGroup=CG_BULLET;e.colMask=CG_MONSTER;return a}};extend(CQueueGun,CWeapon,!0);function CQueueGun(a,b,c,d,e,f){CWeapon.apply(this,[a,b,c,d,e,f]);this.queueLife=0;this._sound=this.sound;this.sound=null;this.canFireQueue=!0}
CQueueGun.prototype.reload=function(){this.canFireQueue=!1;CWeapon.prototype.reload.call(this);this.queueLife=this.queue+1};CQueueGun.prototype.process=function(){CWeapon.prototype.process.call(this);var a=(new Date).getTime();this.canFireQueue&&0<this.queueLife&&this.state!=this.sReload&&a-this.lastShot>=this.queueDelay&&(a=this.delay,this.delay=this.queueDelay,this.shot(!0),this.delay=a)};
CQueueGun.prototype.resetParams=function(){CWeapon.prototype.resetParams.call(this);this.queue=this.backupStats.queue;this.queueDelay=this.backupStats.queueDelay};
CQueueGun.prototype.shot=function(a){var b=CWeapon.prototype.shot.call(this);if(b){if(!a){this.canFireQueue=!0;if(0<this.queueLife)return;0!=this.queueLife||a||(this.queueLife=this.queue)}0<this.ammo&&this._sound&&this.queueLife==this.queue&&ZSound.Play(this._sound);this.queueLife--;a=-this.recoilValue/200+gameStage.player.fireAngle+Math.random()*this.backupStats.acc;var c=Math.cos(a),d=Math.sin(a),e=gameStage.player.firePointX,f=gameStage.player.firePointY-14,g=crsp("fxblink.png");g.scale.x=1.3;
g.scale.y=1.3;g.x=e+65*c;g.y=f+65*d;g.rotation=a;g.blendMode=PIXI.blendModes.ADD;SM.inst.fg.addChild(g);TweenMax.delayedCall(.03,function(){g.parent.removeChild(g)});e=new CBullet(e,f,null,null,this.visualWidth);e.life=this.life;e.dmg=this.damage;e.rotation=Math.PI/2+a;e.dw=this.dw;e.vx=c*this.speed;e.vy=d*this.speed;e.colGroup=CG_BULLET;e.colMask=CG_MONSTER;return b}};extend(CLaser,CWeapon,!0);
function CLaser(a,b,c,d,e,f){CWeapon.apply(this,[a,b,c,d,e,f]);this.laserClip=new PIXI.DisplayObjectContainer;this.lineClip=new PIXI.DisplayObjectContainer;this.particlesClip=new PIXI.DisplayObjectContainer;this.laserClip.addChild(this.particlesClip);this.laserClip.addChild(this.lineClip);SM.inst.fg.addChild(this.laserClip);this.updateLaserLen(0);this.lastPart=this.maxL=0}
CLaser.prototype.updateLaserLen=function(a){for(;this.lineClip.height<a;){var b=new PIXI.Sprite(PIXI.Texture.fromFrame("laser.png"));b.anchor.x=.5;b.anchor.y=.5;b.width+=.18*Math.random();b.x=0;this.lineClip.addChild(b);b.y=this.lineClip.height-.5;b.blendMode=PIXI.blendModes.ADD}for(;this.lineClip.height>a+10;)this.lineClip.removeChildAt(this.lineClip.children.length-1)};
CLaser.prototype.process=function(){CWeapon.prototype.process.call(this);var a=(new Date).getTime();a-this.lastShot>this.delay&&(this.firing=!1);if(this.firing){var b=gameStage.player.fireAngle,c=Math.cos(b),d=Math.sin(b),e=gameStage.player.firePointX,f=gameStage.player.firePointY-14;this.updateLaserLen(this.maxL);this.laserClip.rotation=b-Math.PI/2;this.laserClip.x=e;this.laserClip.y=f;120<a-this.lastPart&&(this.lastPart=a,b=crsp("laserparticle"),b.y=0,b.x=0,b.blendMode=PIXI.blendModes.ADD,this.particlesClip.addChild(b));
for(var g=this.lineClip.children.length,b=0;b<g;++b)this.lineClip.children[b].scale.x=1+b/g,this.lineClip.children[b].x=2.5*Math.cos(b/g*Math.PI*4+a/100);for(b=0;b<this.particlesClip.children.length;++b)g=1-Math.abs(this.maxL/2-this.particlesClip.children[b].y)/(this.maxL/2),.3>g&&(g=.3),this.particlesClip.children[b].scale.x=g,this.particlesClip.children[b].scale.y=-g,g=10+4*Math.cos(a/800),this.particlesClip.children[b].y+=g,this.particlesClip.children[b].y>this.maxL&&(this.particlesClip.removeChildAt(b),
b--);a=f+1E4*d;c=e+1E4*c;if(CMonster.list)for(b=0;b<CMonster.list.length;++b){var k=CMonster.list[b].x,d=CMonster.list[b].y,g=((a-f)*(k-e)-(c-e)*(d-f))/((a-f)*(a-f)+(c-e)*(c-e)),k=k-(k-g*(a-f)),d=d-(d+g*(c-e));k*k+d*d<CMonster.list[b]._sqr&&CMonster.list[b].dealDamage(this.damage/60)}this.laserClip.visible=!0}else this.laserClip.visible=!1};CLaser.prototype.shot=function(){CWeapon.prototype.shot.call(this)&&!this.firing&&(this.maxL=0,new TweenMax(this,.6,{maxL:1E3}),this.firing=!0)};
extend(CGrenadeLauncher,CWeapon,!0);function CGrenadeLauncher(a,b,c,d,e,f){CWeapon.apply(this,[a,b,c,d,e,f])}
CGrenadeLauncher.prototype.shot=function(){var a=CWeapon.prototype.shot.call(this);if(a){var b=gameStage.player.fireAngle+Math.random()*this.backupStats.acc,c=Math.cos(b),d=Math.sin(b),e=gameStage.player.firePointX,f=gameStage.player.firePointY-14,g=crsp("fxblink.png");g.x=e+50*c;g.y=f+50*d;g.rotation=b;g.blendMode=PIXI.blendModes.ADD;SM.inst.fg.addChild(g);TweenMax.delayedCall(.03,function(){g.parent.removeChild(g)});e=new CGrenade(e,f);e.owner=gameStage.player;e.life=this.life;e.dmg=this.damage;
e.rotation=Math.PI/2+b;e.av=.2;e.vx=17.5*c;e.vy=17.5*d;e.gravityEnabled=!0;e.colGroup=CG_BULLET;e.colMask=CG_MONSTER;return a}};
var w_pistol=new CPistol("pistol","\u043f\u0438\u0441\u0442\u043e\u043b\u0435\u0442","\u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435",{visualWidth:20,dw:-.7,speed:40.5,sound:null,acc:.05,recoil:12,magcap:10,delay:120,damage:12,unlockprice:10,reloadTime:1200},"asd",[{name:"\u0422\u043e\u0447\u043d\u044b\u0439 \u0441\u0442\u0432\u043e\u043b",param:"recoil",valuesUpgr:[10,20,30,40],level:0},{name:"\u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u043c\u0430\u0433\u0430\u0437\u0438\u043d",
param:"magCapacity",valuesUpgr:[2,4,6,8],level:0},{name:"\u0411\u044b\u0441\u0442\u0440\u0430\u044f \u0441\u0442\u0440\u0435\u043b\u044c\u0431\u0430",param:"delay",valuesUpgr:[-10,-20,-30,-40],level:0}]),w_rifle=new CPistol("\u041c\u043e\u0441\u0438\u043d\u043a\u0430","\u043f\u0438\u0441\u0442\u043e\u043b\u0435\u0442","\u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435",{visualWidth:15,dw:.3,speed:50.5,sound:"rifle",life:3,acc:.05,recoil:0,accIncrease:.02,accRecoil:.1,magcap:6,delay:380,damage:66,unlockprice:10,
reloadTime:1350},"asd",[{name:"\u0422\u043e\u0447\u043d\u044b\u0439 \u0441\u0442\u0432\u043e\u043b",param:"recoil",valuesUpgr:[10,20,30,40],level:0},{name:"\u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u043c\u0430\u0433\u0430\u0437\u0438\u043d",param:"magCapacity",valuesUpgr:[2,4,6,8],level:0},{name:"\u0411\u044b\u0441\u0442\u0440\u0430\u044f \u0441\u0442\u0440\u0435\u043b\u044c\u0431\u0430",param:"delay",valuesUpgr:[-10,-20,-30,-40],level:0}]),w_pps=new CPistol("pistol",
"\u043f\u0438\u0441\u0442\u043e\u043b\u0435\u0442","\u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435",{visualWidth:25,dw:-1.2,speed:45.5,sound:"mini",life:1,acc:.022,accIncrease:.02,accRecoil:.1,recoil:1,magcap:20,delay:120,damage:28,unlockprice:10,reloadTime:900},"asd",[{name:"\u0422\u043e\u0447\u043d\u044b\u0439 \u0441\u0442\u0432\u043e\u043b",param:"recoil",valuesUpgr:[10,20,30,40],level:0},{name:"\u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u043c\u0430\u0433\u0430\u0437\u0438\u043d",
param:"magCapacity",valuesUpgr:[2,4,6,8],level:0},{name:"\u0411\u044b\u0441\u0442\u0440\u0430\u044f \u0441\u0442\u0440\u0435\u043b\u044c\u0431\u0430",param:"delay",valuesUpgr:[-10,-20,-30,-40],level:0}]),w_minigun=new CPistol("MINIGUN","\u043f\u0438\u0441\u0442\u043e\u043b\u0435\u0442","\u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435",{visualWidth:20,dw:-.7,speed:40.5,sound:"mini",life:2,acc:.05,recoil:.1,accIncrease:.029,accRecoil:.127,magcap:100,delay:60,damage:18,unlockprice:10,reloadTime:2200},
"asd",[{name:"\u0422\u043e\u0447\u043d\u044b\u0439 \u0441\u0442\u0432\u043e\u043b",param:"recoil",valuesUpgr:[10,20,30,40],level:0},{name:"\u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u043c\u0430\u0433\u0430\u0437\u0438\u043d",param:"magCapacity",valuesUpgr:[2,4,6,8],level:0},{name:"\u0411\u044b\u0441\u0442\u0440\u0430\u044f \u0441\u0442\u0440\u0435\u043b\u044c\u0431\u0430",param:"delay",valuesUpgr:[-10,-20,-30,-40],level:0}]),w_ak74=new CQueueGun("pistol",
"\u043f\u0438\u0441\u0442\u043e\u043b\u0435\u0442","\u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435",{visualWidth:10,dw:.1,speed:60.5,sound:"ochered",queue:5,queueDelay:110,life:1,acc:.17,accIncrease:.05,accRecoil:.12,recoil:2.5,magcap:50,delay:600,damage:55,unlockprice:10,reloadTime:2200},"asd",[{name:"\u0422\u043e\u0447\u043d\u044b\u0439 \u0441\u0442\u0432\u043e\u043b",param:"recoil",valuesUpgr:[10,20,30,40],level:0},{name:"\u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u043c\u0430\u0433\u0430\u0437\u0438\u043d",
param:"magCapacity",valuesUpgr:[2,4,6,8],level:0},{name:"\u0411\u044b\u0441\u0442\u0440\u0430\u044f \u0441\u0442\u0440\u0435\u043b\u044c\u0431\u0430",param:"delay",valuesUpgr:[-10,-20,-30,-40],level:0}]),w_grenadel=new CGrenadeLauncher("grenade launcher","\u043b\u0430\u0437\u0435\u0440","\u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435",{visualWidth:20,dw:-.7,speed:40.5,sound:"laser",life:1,acc:.08,accIncrease:0,accRecoil:0,recoil:3,magcap:3,delay:400,damage:135,reloadTime:2200},"asd",[{name:"\u0422\u043e\u0447\u043d\u044b\u0439 \u0441\u0442\u0432\u043e\u043b",
param:"recoil",valuesUpgr:[10,20,30,40],level:0},{name:"\u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u043c\u0430\u0433\u0430\u0437\u0438\u043d",param:"magCapacity",valuesUpgr:[2,4,6,8],level:0},{name:"\u0411\u044b\u0441\u0442\u0440\u0430\u044f \u0441\u0442\u0440\u0435\u043b\u044c\u0431\u0430",param:"delay",valuesUpgr:[-10,-20,-30,-40],level:0}]),w_laser=new CLaser("laser","\u043b\u0430\u0437\u0435\u0440","\u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435",{visualWidth:20,
dw:-.7,speed:40.5,sound:"laser",life:1,acc:.08,accIncrease:0,accRecoil:0,recoil:0,magcap:60,delay:150,damage:190,unlockprice:10,reloadTime:2200},"asd",[{name:"\u0422\u043e\u0447\u043d\u044b\u0439 \u0441\u0442\u0432\u043e\u043b",param:"recoil",valuesUpgr:[10,20,30,40],level:0},{name:"\u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u043c\u0430\u0433\u0430\u0437\u0438\u043d",param:"magCapacity",valuesUpgr:[2,4,6,8],level:0},{name:"\u0411\u044b\u0441\u0442\u0440\u0430\u044f \u0441\u0442\u0440\u0435\u043b\u044c\u0431\u0430",
param:"delay",valuesUpgr:[-10,-20,-30,-40],level:0}]);extend(CBooster,CObj,!0);function CBooster(a,b,c,d){CObj.apply(this,[a,b,c,null]);this.upgr=d;CBooster.list||(CBooster.list=[]);CBooster.list.push(this);this.activate=!0}CBooster.prototype.getUpgrade=function(){};CBooster.prototype.destroy=function(){if(!this.doRemove){var a=CBooster.list.indexOf(this);0<=a&&CBooster.list.splice(a,1);CObj.prototype.destroy.call(this)}};
CBooster.prototype.onDeactivate=function(){rp(this.tf);this.tf=null;this.activate=!1;var a=CBooster.list.indexOf(this);0<=a&&CBooster.list.splice(a,1);var b=this;new TweenMax(this.gfx,.5,{alpha:0,onComplete:function(){b.destroy()}})};
CBooster.prototype.removeBoosterItem=function(){for(var a=0;a<PlayerData.inst.items_enabled.length&&PlayerData.inst.items_enabled[a].id!=this.ieid;++a);a<PlayerData.inst.items_enabled.length&&PlayerData.inst.items_enabled.splice(this.ieid,1);azureclient.invokeApi("removeitem",{body:{iditemplayer:this.ieid},method:"post"})};
CBooster.prototype.onActivate=function(){this.activate=!0;PlayerData.inst.progressAch("Gold medal 5",1,!1);this.startTime=PauseTimer.getTimer();this.lastTick=0;this.tf=CTextField.createTextField({fontFamily:"dedgamecaps",tint:"0xFFFFFF",text:"",fontSize:80,align:"center"});this.tf.x=this.tf.width/2;this.tf.y=-40;this.gfx.addChild(this.tf)};
CBooster.prototype.process=function(){if(this.activate&&!this.doRemove){if(this.tf){if(1E3<PauseTimer.getTimer()-this.lastTick){this.lastTick=PauseTimer.getTimer();var a=Math.round(this.duration-(PauseTimer.getTimer()-this.startTime)/1E3);0>a&&(a=0);this.tf.text=a.toString();this.tf.updateText()}this.tf.x=-this.tf.width/2}a=PauseTimer.getTimer()-this.startTime;if(this.startTime&&a>1E3*this.duration)this.onDeactivate()}};extend(CDoubleBooster,CBooster,!0);
function CDoubleBooster(a,b,c,d){CBooster.apply(this,[a,b,c,d]);this.duration=15+3*d}CDoubleBooster.prototype.onActivate=function(){gameStage.player&&(CBooster.prototype.onActivate.call(this),gameStage.player.doubleBooster=2+.25*this.upgr)};CDoubleBooster.prototype.onDeactivate=function(){gameStage.player.doubleBooster=null;CBooster.prototype.onDeactivate.call(this)};extend(CHeartBooster,CBooster,!0);function CHeartBooster(a,b,c,d){CBooster.apply(this,[a,b,c,d]);this.duration=.1}
CHeartBooster.prototype.onActivate=function(){var a=[1,2,3,4,5,10];gameStage.player.hp=0<=this.upgr?gameStage.player.hp+a[this.upgr]:gameStage.player.hp+1;gameStage.player&&CBooster.prototype.onActivate.call(this)};extend(CMagnetBooster,CBooster,!0);function CMagnetBooster(a,b,c,d){CBooster.apply(this,[a,b,c,d]);a=250+20*d;CMagnetBooster.mindist=a*a;this.duration=40+10*d}
CMagnetBooster.prototype.process=function(){if(gameStage.player&&CCoin.coins)for(var a=CCoin.coins.length,b=0;b<a;++b){var c=CCoin.coins[b].x-gameStage.player.x,d=CCoin.coins[b].y-gameStage.player.y;if(c*c+d*d<CMagnetBooster.mindist){var e=Math.sqrt(c*c+d*d),c=c/e,d=d/e;CCoin.coins[b].vx-=1.5*c;CCoin.coins[b].vy-=1.5*d}}CBooster.prototype.process.call(this)};extend(CSupermanBooster,CBooster,!0);function CSupermanBooster(a,b,c,d){CBooster.apply(this,[a,b,c,d]);this.duration=9+2*d}
CSupermanBooster.prototype.onActivate=function(){gameStage.player&&(CBooster.prototype.onActivate.call(this),gameStage.player.gfx.skeleton.setAttachment("body","body1"),new TweenMax(gameStage.player,.6,{y:200,ease:Linear.easeOut}),gameStage.player.jumping=!0,gameStage.player.gravityEnabled=!1,this.fire1=CObj.createMovieClip("firesmall"),this.fire1.x=-314,this.fire1.y=-100,this.fire1.scale.x=3,this.fire1.scale.y=3,this.fire1.loop=!0,this.fire1.gotoAndPlay(0),gameStage.player.gfx.addChildAt(this.fire1,
0),this.fire2=CObj.createMovieClip("firesmall"),this.fire2.x=-140,this.fire2.y=20,this.fire2.scale.x=3,this.fire2.scale.y=3,this.fire2.loop=!0,this.fire2.gotoAndPlay(0),gameStage.player.gfx.addChildAt(this.fire2,0),this.fire3=CObj.createMovieClip("firesmall"),this.fire3.x=85,this.fire3.y=20,this.fire3.scale.x=3,this.fire3.scale.y=3,this.fire3.loop=!0,this.fire3.gotoAndPlay(0),gameStage.player.gfx.addChildAt(this.fire3,0),gameStage.player.gfx.state.setAnimationByName(0,"idle",!0))};
CSupermanBooster.prototype.onDeactivate=function(){gameStage.player.jumping=!1;gameStage.player.gravityEnabled=!0;rp(this.fire1);rp(this.fire2);rp(this.fire3);this.fire3=this.fire2=this.fire1=null;gameStage.player.invulnerable++;var a=gameStage.player;TweenMax.delayedCall(1,function(){a.invulnerable--});CBooster.prototype.onDeactivate.call(this)};
CSupermanBooster.prototype.process=function(){this.activate&&!this.doRemove&&(gameStage.player&&(gameStage.player.vy=.7*Math.cos(PauseTimer.getTimer()/1E3)),CBooster.prototype.process.call(this))};extend(CTabletsBooster,CBooster,!0);function CTabletsBooster(a,b,c,d){CBooster.apply(this,[a,b,c,d]);this.duration=4+d}
CTabletsBooster.prototype.onActivate=function(){CBooster.prototype.onActivate.call(this);if(gameStage.player){gameStage.player.invulnerable++;var a=gameStage.player;a.blink=!0;this.prevVel=LauncherBG.inst.maxVelocity;a.superMode=!0;new TweenMax(LauncherBG.inst,1.5,{maxVelocity:LauncherBG.inst.maxVelocity+15,ease:Linear.easeOut})}};
CTabletsBooster.prototype.onDeactivate=function(){var a=gameStage.player;TweenMax.delayedCall(.7,function(){a.invulnerable--});new TweenMax(LauncherBG.inst,.3,{maxVelocity:this.prevVel,ease:Linear.easeOut});CBooster.prototype.onDeactivate.call(this);a.superMode=!1;a.resetBlink();a.blink=!1};
PlayerData=function(a){console.log("PlayerData init");this.maxEnergy=10;this.epm=.2;this.delayEnergyMS=1/this.epm*6E4;this.xpLevel=[{crystals:1,money:25,xp:0},{crystals:1,money:50,xp:250},{crystals:1,money:100,xp:500},{crystals:1,money:200,xp:1E3},{crystals:2,money:400,xp:2E3},{crystals:2,money:800,xp:2500},{crystals:2,money:1E3,xp:3500},{crystals:2,money:1500,xp:7E3},{crystals:3,money:2E3,xp:12E3},{crystals:3,money:2500,xp:18E3},{crystals:3,money:3E3,xp:19E3},{crystals:3,money:3E3,xp:2E4},{crystals:3,
money:3E3,xp:21E3},{crystals:3,money:3E3,xp:22E3},{crystals:3,money:3E3,xp:23E3},{crystals:3,money:3E3,xp:24E3},{crystals:3,money:3E3,xp:25E3},{crystals:3,money:3E3,xp:26E3},{crystals:3,money:3E3,xp:27E3},{crystals:3,money:3E3,xp:28E3},{crystals:3,money:3E3,xp:29E3},{crystals:3,money:3E3,xp:31E3},{crystals:3,money:3E3,xp:32E3},{crystals:3,money:3E3,xp:33E3},{crystals:3,money:3E3,xp:34E3},{crystals:3,money:3E3,xp:35E3}];this.items={};this.achs={};a&&(this.playerItem=a);this.activeBoosters=[];this.score=
0;this.loadData(this.loadEnd);PlayerData.inst=this};PlayerData.prototype.addNotification=function(a,b){window.azureclient.getTable("tb_notifications").insert({message:a,vkapi:b})};
PlayerData.prototype.comboCheck=function(){if(this.playerItem.combodate){var a=(new Date).getTime()-this.playerItem.updateDate.getTime(),a=a/1E3/60;1740<a?this.playerItem.combodate=new Date:(a=(new Date).getTime()-this.playerItem.combodate,a/=1E3,a/=60,4320<a&&this.progressAch("Gold medal 8",1,!1),14400<a&&this.progressAch("Gold medal 9",1,!1))}else this.playerItem.combodate=this.playerItem.updateDate};
PlayerData.prototype.getItemById=function(a){for(var b=0;b<this.items.length;++b)if(this.items[b].id==a)return this.items[b];return null};PlayerData.prototype.getType=function(a){for(var b=0;b<PlayerData.inst.items.length;++b)if(PlayerData.inst.items[b].id==a.id_item)return PlayerData.inst.items[b].type;return null};
PlayerData.prototype.getUpgrade=function(a,b){if(b)for(var c=0;c<this.items.length;++c)if(this.items[c].name==b){a=this.items[c];break}for(var d=a.name,e=[],c=0;c<this.items.length;++c)0<=this.items[c].name.indexOf(d+"$")&&e.push({id:this.items[c].id,name:this.items[c].name});e.sort(function(a,b){return b.name.localeCompare(a.name)});d=!1;for(c=0;c<e.length;++c)for(var f=0;f<PlayerData.inst.items_enabled.length;++f)if(PlayerData.inst.items_enabled[f].id_item==a.id&&(d=!0),PlayerData.inst.items_enabled[f].id_item==
e[c].id)return{upgr:5-c,id:e[c].id,idNext:0<c?e[c-1].id:null};return d?{upgr:1,id:a.id,idNext:e[e.length-1].id}:{upgr:0,id:null,idNext:a.id}};PlayerData.prototype.equipItem=function(a){for(var b=a.id,c=!1,d=0;d<this.items_enabled.length;++d)this.items_enabled[d].id_item==b&&(c=!0);if(c){a=a.type;for(d=0;d<PlayerData.inst.items_enabled.length;++d)this.getType(PlayerData.inst.items_enabled[d])==a&&(PlayerData.inst.items_enabled[d].equipped=PlayerData.inst.items_enabled[d].id_item==b?!0:!1);this.savePlayerItems()}};
PlayerData.prototype.gainExp=function(a){this.playerItem.xp+=a;var b=SM.inst.currentStage==gameStage;this.playerItem.xp>=this.xpLevel[this.playerItem.lvl].xp&&this.playerItem.lvl+1<this.xpLevel.length&&(this.playerItem.xp-=this.xpLevel[this.playerItem.lvl].xp,this.playerItem.crystals+=this.xpLevel[this.playerItem.lvl].crystals,this.playerItem.lvl++,ZSound.Play("levelup"),b?this.score+=this.xpLevel[this.playerItem.lvl].money:(this.playerItem.money+=this.xpLevel[this.playerItem.lvl].money,shopStage.updateStatsPanel()),
!b&&charStage.disableWnd&&(charStage.disableWnd.interactive=!1),b&&(gameStage.updateScore(),gameStage.pause()),LevelManager.loadLevel("levelup",function(){CObj.getById("moneytf").text=PlayerData.inst.xpLevel[PlayerData.inst.playerItem.lvl].money.toString();CObj.getById("crystalstf").text=PlayerData.inst.xpLevel[PlayerData.inst.playerItem.lvl].crystals.toString();CObj.getById("levnum").text=PlayerData.inst.playerItem.lvl.toString();CObj.getById("btnclose").click=function(){LevelManager.removeLastLevel();
b?gameStage.unpause():(shopStage.updateStatsPanel(),charStage.closeEventsWnd(),PlayerData.inst.savePlayerData())}},SM.inst.fontLayer));SM.inst.currentStage==gameStage&&gameStage.updateXP()};
PlayerData.prototype.showAch=function(a){var b=new PIXI.DisplayObjectContainer,c=crsp("notifiction cover");b.addChild(c);var d=crsp(a.gfx);d.height=80;d.scale.x=d.scale.y;d.x=-c.width/2+55;b.addChild(d);d=new CTextField.createTextField({fontFamily:"dedgamecaps",text:"\u041d\u043e\u0432\u0430\u044f \u043d\u0430\u0433\u0440\u0430\u0434\u0430!",fontSize:"33"});a=new CTextField.createTextField({fontFamily:"dedgamecaps",text:a.desc,fontSize:"25"});d.x=-d.width/2+40;d.y=-35;a.x=-a.width/2+40;a.y=5;b.addChild(d);
b.addChild(a);stage.addChild(b);b.x=SCR_WIDTH/2;new TweenMax(b,.4,{y:c.height/2});new TweenMax(b,.3,{delay:1.8,alpha:0,onComplete:function(){b.parent.removeChild(b)}})};
PlayerData.prototype.progressAch=function(a,b,c){for(var d=0;d<this.achs.length&&this.achs[d].name.toLowerCase()!=a.toLowerCase();++d);a=!1;for(var e=0;e<this.achs_progress.length;++e)if(this.achs_progress[e].id_ach==this.achs[d].id){c?(1<=b&&(a=!0),this.achs_progress[e].progress=b):(1>this.achs_progress[e].progress&&1<=this.achs_progress[e].progress+b&&(a=!0,charStage.unreadAch=!0),this.achs_progress[e].progress+=b);break}a&&(this.savePlayerAchs(this.achs_progress[e]),this.showAch(this.achs[d]),
incMetric("ACH GAINED "+this.achs[d].name));return a};PlayerData.prototype.loadEnd=function(){PlayerData.inst.createAchProgress();window.dbinit=!0;console.log("DB intialized");onAssetsLoaded()};
PlayerData.prototype.updateEnergy=function(){var a=(new Date).getTime()-this.playerItem.updateDate.getTime();this.playerItem.updateDate=new Date;a=a/1E3/60;0<a&&(this.playerItem.energy+=a*this.epm);this.playerItem.energy>this.maxEnergy&&(this.playerItem.energy=this.maxEnergy);this.savePlayerData();SM.inst.currentStage!=charStage&&SM.inst.currentStage!=shopStage||shopStage.updateStatsPanel();var b=this;setTimeout(function(){b.updateEnergy()},this.delayEnergyMS)};
PlayerData.prototype.createAchProgress=function(a){for(a=0;a<this.achs.length;++a){for(var b=!1,c=0;c<this.achs_progress.length;++c)if(this.achs[a].id==this.achs_progress[c].id_ach){b=!0;break}b||this.achs_progress.push({id_ach:this.achs[a].id,id_player:this.playerItem.id,progress:0})}};incMetric=function(a){azureclient.invokeApi("increasemetric",{body:{name:a},method:"post"}).done()};
PlayerData.prototype.getEventById=function(a){for(var b=0;b<this.events.length;++b)if(this.events[b].id==a)return this.events[b];return null};
PlayerData.prototype.loadData=function(a){this.loadCount=0;console.log("PlayerData.loadData");window.azureclient.getTable("tb_players").read().done(function(b){PlayerData.inst.playerItem=b[0];console.log("PlayerData.get player record");PlayerData.inst.playerItem.name=vkparams.first_name;PlayerData.inst.playerItem.last_name=vkparams.last_name;PlayerData.inst.updateEnergy();azureclient.invokeApi("update_score",{body:{id_player:PlayerData.inst.playerItem.id,score:PlayerData.inst.playerItem.maxdistance},
method:"post"}).done();PlayerData.inst.playerItem.crystals||(PlayerData.inst.playerItem.crystals=0);PlayerData.inst.loadCount++;7==PlayerData.inst.loadCount&&a&&a()},function(a){});window.azureclient.getTable("tb_achs").read().done(function(b){PlayerData.inst.achs=b;PlayerData.inst.loadCount++;7==PlayerData.inst.loadCount&&a&&a()},function(a){});window.azureclient.getTable("tb_ach_player").read().done(function(b){PlayerData.inst.achs_progress=b;PlayerData.inst.loadCount++;7==PlayerData.inst.loadCount&&
a&&a()},function(a){});window.azureclient.getTable("tb_items").read().done(function(b){PlayerData.inst.items=b;PlayerData.inst.items.sort(function(a,b){return a.reqlvl-b.reqlvl});PlayerData.inst.loadCount++;7==PlayerData.inst.loadCount&&a&&a()},function(a){});window.azureclient.getTable("tb_item_player").read().done(function(b){PlayerData.inst.items_enabled=b;for(var c=b=!1,d=-1,e=0;e<PlayerData.inst.items_enabled.length;++e)"68AFAEDC-B3E0-401E-9E1A-E272084F2E11"==PlayerData.inst.items_enabled[e].id_item&&
(d=e,b=!0),PlayerData.inst.items_enabled[e].equipped&&(c=!0);!c&&b&&(PlayerData.inst.items_enabled[d].equipped=!0);b||(azureclient.invokeApi("buy_item",{body:{id_item:"68AFAEDC-B3E0-401E-9E1A-E272084F2E11",id_player:PlayerData.pid,equipped:c},method:"post"}).done(function(a){},function(a){}),c=!0,0<PlayerData.inst.items_enabled.length&&(c=!1),PlayerData.inst.items_enabled.push({id_item:"68AFAEDC-B3E0-401E-9E1A-E272084F2E11",id_player:PlayerData.pid,equipped:c}));PlayerData.inst.loadCount++;7==PlayerData.inst.loadCount&&
a&&a()},function(a){});window.azureclient.getTable("tb_edevent_player").read().done(function(b){PlayerData.inst.eventsplayer=b;PlayerData.inst.loadCount++;7==PlayerData.inst.loadCount&&a&&a()},function(a){});window.azureclient.getTable("tb_edevent").read().done(function(b){PlayerData.inst.events=b;PlayerData.inst.loadCount++;7==PlayerData.inst.loadCount&&a&&a()},function(a){})};PlayerData.prototype.savePlayerData=function(){this.savePlayerData();this.savePlayerItems();this.savePlayerEvents();this.savePlayerAchs()};
PlayerData.prototype.savePlayerAchs=function(a){for(var b=0;b<PlayerData.inst.achs_progress.length;++b)a&&a.id!=PlayerData.inst.achs_progress[b].id||window.azureclient.getTable("tb_ach_player").update(PlayerData.inst.achs_progress[b]).done(function(a){},function(a){})};
PlayerData.prototype.savePlayerEvents=function(a){for(var b=0;b<PlayerData.inst.eventsplayer.length;++b)a&&a.id!=PlayerData.inst.eventsplayer[b].id||window.azureclient.getTable("tb_edevent_player").update(PlayerData.inst.eventsplayer[b]).done(function(a){},function(a){})};
PlayerData.prototype.savePlayerItems=function(a){for(var b=0;b<PlayerData.inst.items_enabled.length;++b)a&&a.id!=PlayerData.inst.items_enabled[b].id||window.azureclient.getTable("tb_item_player").update(PlayerData.inst.items_enabled[b]).done(function(a){},function(a){})};PlayerData.prototype.savePlayerData=function(a){window.azureclient.getTable("tb_players").update(PlayerData.inst.playerItem).done(function(b){PlayerData.inst.playerItem=b;a&&a()},function(a){})};
getURLParameter=function(a){return decodeURIComponent(((new RegExp("[?|&]"+a+"=([^&;]+?)(&|#|;|$)")).exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null};
PlayerData.getVKuserData=function(a){VK.api("users.get",{user_ids:vkparams.viewerid.toString()},function(b){b.response&&0!=b.response.length?(vkparams.first_name=b.response[0].first_name?b.response[0].first_name:"\u041d\u043e\u0443\u043d\u0435\u0439\u043c",vkparams.last_name=b.response[0].first_name?b.response[0].last_name:"",new PlayerData(a)):PlayerData.getVKuserData(a)})};
PlayerData.getVKfriends=function(a){vkparams.first_name="\u0410\u043d\u043e\u043d\u0438\u043c";vkparams.last_name="";vkparams.novk?new PlayerData(a):(console.log("Gettin vk friends"),VK.api("friends.get",{user_id:vkparams.viewerid,order:"name",count:1E3,fields:"domain"},function(b){console.log("friends.get data"+JSON.stringify(b));if(b.response&&b.response.length){vkparams.friends=b.response;vkparams.friendsids=[];console.log("VK friends+");for(b=0;b<vkparams.friends.length;++b)vkparams.friendsids.push(vkparams.friends[b].uid);
azureclient.invokeApi("get_scores",{body:{filter:vkparams.friendsids,take:1E3},method:"post"}).done(function(b){vkparams.friendsIngame=b.result;vkparams.friendsIngameIDs=[];if(b.result){for(var d=0;d<b.result.length;++d)vkparams.friendsIngameIDs.push(b.result[d].vkapi);PlayerData.getVKuserData(a)}},function(a){})}else PlayerData.getVKfriends(a)}))};
PlayerData.azureLogin=function(){azureclient.invokeApi("login",{body:{vkapi:vkparams.viewerid,ref:vkparams.refferer},method:"post"}).done(function(a){vkparams.registered=a.result.registered;vkparams.registered?console.log("user registered"):console.log("user logged in");PlayerData.pid=a.result.userId.split(":")[1];azureclient.currentUser={userId:a.result.userId,mobileServiceAuthenticationToken:a.result.token};vkparams.id=a.result.id;PlayerData.getVKfriends(a.result)},function(a){PlayerData.azureLogin()})};
PlayerData.dbInit=function(){console.log("dbInit start. Connecting to azure");window.azureclient=new WindowsAzure.MobileServiceClient("https://thanksdad.azure-mobile.net/","DRoaNHnoaCjxrhkbpOzHxGEHOFgGLS75");window.vkparams={};vkparams.userid=getURLParameter("user_id");vkparams.sid=getURLParameter("sid");vkparams.viewerid=getURLParameter("viewer_id");vkparams.viewerid||(vkparams.viewerid=2882845,vkparams.novk=!0);vkparams.gamerid=vkparams.userid||vkparams.viewerid;vkparams.auth_key=getURLParameter("auth_key");
vkparams.refferer=getURLParameter("referrer");vkparams.accesstoken=getURLParameter("access_token");console.log("login / register user");PlayerData.azureLogin()};var tWeapon="weap",tPerk="perk",tBoost="boost",tApp="app.",tHat="hat";function checkDb(){updDb(dbobj)}
var dbobj=[{tbname:"tb_edevent",items:[{desc:"\u041f\u043e\u043c\u044f\u043d\u0443\u0442\u044c \u0431\u043e\u0435\u0432\u044b\u0445 \u0442\u043e\u0432\u0430\u0440\u0438\u0449\u0435\u0439",name:"event1",delay_min:1440,xp_gain:0,money_gain:0,crystal_gain:2,gfx:"action 1.png",reqlvl:2,exectime:30},{desc:"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043f\u0435\u043d\u0441\u0438\u044e",name:"event2",delay_min:2880,xp_gain:0,money_gain:500,crystal_gain:0,gfx:"action 2.png",reqlvl:1,exectime:120},
{desc:"\u041f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u043d\u043e\u0432\u043e\u0441\u0442\u0438",name:"event3",delay_min:360,xp_gain:50,money_gain:0,crystal_gain:0,gfx:"action 3.png",reqlvl:1,exectime:30},{desc:"\u0417\u0430\u0433\u043b\u044f\u043d\u0443\u0442\u044c \u0432 \u0438\u043d\u0442\u0435\u0440\u043d\u0435\u0442",name:"event4",delay_min:1440,xp_gain:600,money_gain:0,crystal_gain:0,gfx:"action 4.png",reqlvl:4,exectime:140},{desc:"\u041f\u043e\u0441\u0442\u0438\u0440\u0430\u0442\u044c \u043c\u0443\u043d\u0434\u0438\u0440",
name:"event5",delay_min:2,xp_gain:0,money_gain:0,crystal_gain:8,gfx:"action 5.png",reqlvl:5,exectime:120},{desc:"\u0414\u043e\u0435\u0441\u0442\u044c \u0443\u0436\u0438\u043d",name:"event6",delay_min:1440,xp_gain:100,money_gain:0,crystal_gain:0,gfx:"action 6.png",reqlvl:1,exectime:10},{desc:"\u041f\u043e\u0437\u0432\u043e\u043d\u0438\u0442\u044c \u0432\u043d\u0443\u043a\u0443",name:"event7",delay_min:1440,xp_gain:900,money_gain:0,crystal_gain:0,gfx:"action 7.png",reqlvl:5,exectime:80},{desc:"\u041f\u043e\u043c\u043e\u0447\u044c \u0431\u0430\u0431\u043a\u0435 \u043f\u043e \u0445\u043e\u0437\u044f\u0439\u0441\u0442\u0432\u0443",
name:"event8",delay_min:240,xp_gain:0,money_gain:0,crystal_gain:3,gfx:"action 8.png",reqlvl:4,exectime:50},{desc:"\u041f\u043e\u0434\u0440\u0435\u043c\u0430\u0442\u044c",name:"event9",delay_min:360,xp_gain:200,money_gain:0,crystal_gain:0,gfx:"action 9.png",reqlvl:3,exectime:120},{desc:"\u041f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0444\u043e\u0442\u043e\u0433\u0440\u0430\u0444\u0438\u0438",name:"event10",delay_min:60,xp_gain:50,money_gain:0,crystal_gain:0,gfx:"action 10.png",reqlvl:1,
exectime:10},{desc:"\u041f\u043e\u0447\u0438\u0442\u0430\u0442\u044c \u043a\u043d\u0438\u0433\u0443",name:"event11",delay_min:240,xp_gain:0,money_gain:0,crystal_gain:1,gfx:"action 11.png",reqlvl:3,exectime:60},{desc:"\u041f\u043e\u0447\u0438\u0441\u0442\u0438\u0442\u044c \u043e\u0440\u0434\u0435\u043d\u0430",name:"event12",delay_min:1440,xp_gain:0,money_gain:0,crystal_gain:2,gfx:"action 12.png",reqlvl:1,exectime:1},{desc:"\u0421\u0445\u043e\u0434\u0438\u0442\u044c \u0432 \u043f\u043e\u043b\u0438\u043a\u043b\u0438\u043d\u0438\u043a\u0443",
name:"event13",delay_min:2880,xp_gain:0,money_gain:1E3,crystal_gain:3,gfx:"action 13.png",reqlvl:2,exectime:200},{name:"event14",desc:"\u041f\u043e\u043a\u043e\u0440\u043c\u0438\u0442\u044c \u043a\u043e\u0442\u0430",delay_min:360,xp_gain:0,money_gain:1E3,crystal_gain:0,gfx:"action 14.png",reqlvl:5,exectime:30}]},{tbname:"tb_achs",items:[{name:"Gold medal 1",desc:"\u041f\u0435\u0440\u0432\u044b\u0439 \u0431\u043e\u0439",gfx:"orden.png"},{name:"Gold medal 2",desc:"\u0414\u043e\u043b\u0433\u0438\u0439 \u043f\u0443\u0442\u044c 100\u043c",
gfx:"orden6.png"},{name:"Gold medal 3",desc:"\u0414\u043e\u043b\u0433\u0438\u0439 \u043f\u0443\u0442\u044c 500\u043c",gfx:"orden10.png"},{name:"Gold medal 4",desc:"\u0414\u043e\u043b\u0433\u0438\u0439 \u043f\u0443\u0442\u044c 1000\u043c",gfx:"orden11.png"},{name:"Gold medal 5",desc:"\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0431\u0443\u0441\u0442\u0435\u0440",gfx:"orden5.png"},{name:"Gold medal 6",desc:"10 \u0440\u0430\u0437 \u043f\u043e\u043c\u044f\u043d\u0443\u043b \u0434\u0440\u0443\u0437\u0435\u0439",
gfx:"orden2.png"},{name:"Gold medal 7",desc:"\u041f\u043e\u0431\u0435\u0434\u0438\u043b \u043f\u0435\u0440\u0432\u043e\u0433\u043e \u0431\u043e\u0441\u0441\u0430",gfx:"orden.png"},{name:"Gold medal 8",desc:"3 \u0434\u043d\u044f \u0431\u0435\u0437 \u043f\u0435\u0440\u0435\u0440\u044b\u0432\u0430",gfx:"orden7.png"},{name:"Gold medal 9",desc:"10 \u0434\u043d\u0435\u0439 \u0431\u0435\u0437 \u043f\u0435\u0440\u0435\u0440\u044b\u0432\u0430",gfx:"orden2.png"},{name:"Gold medal 10",desc:"\u041d\u0430\u043a\u0430\u0437\u0430\u0442\u044c 100 \u0448\u043a\u043e\u043b\u044c\u043d\u0438\u043a\u043e\u0432",
gfx:"orden6.png"},{name:"Gold medal 11",desc:"\u041d\u0430\u043a\u0430\u0437\u0430\u0442\u044c 200 \u0448\u043a\u043e\u043b\u044c\u043d\u0438\u043a\u043e\u0432",gfx:"orden12.png"}]},{tbname:"tb_items",items:[{type:tWeapon,price:-1,pricecrys:-1,name:"Rifle",desc:"\u0421\u0442\u0430\u0440\u043e\u0435 \u0434\u0435\u0434\u043e\u0432\u0441\u043a\u043e\u0435 \u0440\u0443\u0436\u044c\u0438\u0448\u043a\u043e",gfx:"gun0",reqlvl:-1},{type:tWeapon,price:600,pricecrys:12,name:"PPS",desc:"\u041f\u041f\u0428|\u041f\u0438\u0441\u0442\u043e\u043b\u0435\u0442-\u043f\u0443\u043b\u0435\u043c\u0451\u0442 \u0428\u043f\u0430\u0433\u0438\u043d\u0430==\u043c\u0430\u0433\u0430\u0437\u0438\u043d 20 \u043f\u0430\u0442\u0440\u043e\u043d\u043e\u0432",
gfx:"gun1",reqlvl:2},{type:tWeapon,price:1300,pricecrys:26,name:"AK-74",desc:"\u041a\u0430\u043b\u0430\u0448|\u0410\u041a-47 - \u0430\u0432\u0442\u043e\u043c\u0430\u0442 \u0431\u044b\u043b \u0441\u043a\u043e\u043d\u0441\u0442\u0440\u0443\u0438\u0440\u043e\u0432\u0430\u043d==\u041c\u0438\u0445\u0430\u0438\u043b\u043e\u043c \u0422\u0438\u043c\u043e\u0444\u0435\u0435\u0432\u0438\u0447\u0435\u043c \u041a\u0430\u043b\u0430\u0448\u043d\u0438\u043a\u043e\u0432\u044b\u043c==\u0423\u0432\u0435\u043b\u0438\u0447\u0435\u043d\u043d\u044b\u0439 \u043c\u0430\u0433\u0430\u0437\u0438\u043d: 50 \u043f\u0430\u0442\u0440\u043e\u043d\u043e\u0432",
gfx:"gun2",reqlvl:4},{type:tWeapon,price:2400,pricecrys:48,name:"Minigun",desc:"\u041c\u0438\u043d\u0438\u0433\u0430\u043d - \u043c\u043d\u043e\u0433\u043e\u0441\u0442\u0432\u043e\u043b\u044c\u043d\u044b\u0439 \u0441\u043a\u043e\u0440\u043e\u0441\u0442\u0440\u0435\u043b\u044c\u043d\u044b\u0439 \u043f\u0443\u043b\u0435\u043c\u0451\u0442==\u043f\u043e\u0441\u0442\u0440\u043e\u0435\u043d\u043d\u044b\u0439 \u043f\u043e \u0441\u0445\u0435\u043c\u0435 \u0413\u0430\u0442\u043b\u0438\u043d\u0433\u0430==\u043c\u0430\u0433\u0430\u0437\u0438\u043d 100 \u043f\u0430\u0442\u0440\u043e\u043d\u043e\u0432",
gfx:"gun3",reqlvl:7},{type:tWeapon,price:8E3,pricecrys:160,name:"Grenade launcher",desc:"\u0413\u0440\u0430\u043d\u0430\u0442\u043e\u043c\u0451\u0442 - \u0440\u0443\u0447\u043d\u043e\u0439 \u043c\u043d\u043e\u0433\u043e\u0437\u0430\u0440\u044f\u0434\u043d\u044b\u0439==\u043f\u043e\u043b\u0443\u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439 \u0433\u0440\u0430\u043d\u0430\u0442\u043e\u043c\u0435\u0442==3 \u0441\u043d\u0430\u0440\u044f\u0434\u0430",gfx:"gun4",reqlvl:10},
{type:tWeapon,price:3E4,pricecrys:600,name:"Plazma Cannon",desc:"\u041b\u0430\u0437\u0435\u0440\u043d\u0430\u044f \u0432\u0438\u043d\u0442\u043e\u0432\u043a\u0430 - \u044d\u043d\u0435\u0440\u0433\u0435\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u043e\u0440\u0443\u0436\u0438\u0435==\u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u0430\u043d\u043d\u043e\u0435 \u0432 \u0446\u0435\u043d\u0442\u0440\u0435 \u0421\u043a\u043e\u043b\u043a\u043e\u0432\u043e",gfx:"gun5",reqlvl:15},{type:tBoost,price:100,
pricecrys:-1,name:"Magnet",desc:"\u041c\u0430\u0433\u043d\u0438\u0442|\u041c\u0430\u0433\u043d\u0438\u0442: \u043f\u0440\u0438\u0442\u044f\u0433\u0438\u0432\u0430\u0435\u0442 \u043c\u043e\u043d\u0435\u0442\u044b \u043f\u0440\u044f\u043c\u043e \u0432 \u043a\u0430\u0440\u043c\u0430\u043d.==\u0414\u0435\u0439\u0441\u0442\u0432\u0443\u0435\u0442 40 \u0441\u0435\u043a\u0443\u043d\u0434.==[\u0423\u043b\u0443\u0447\u0448\u0435\u043d\u0438\u0435]==\u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c + 5 \u0441\u0435\u043a\u0443\u043d\u0434==\u0414\u0438\u0441\u0442\u0430\u043d\u0446\u0438\u044f \u043f\u043e\u0434\u0431\u043e\u0440\u0430 \u0443\u0432\u0435\u043b\u0438\u0447\u0435\u043d\u0430.",
gfx:"booster2",reqlvl:1},{type:tBoost,price:200,pricecrys:4,name:"Magnet$1",desc:"\u041c\u0430\u0433\u043d\u0438\u0442|\u041c\u0430\u0433\u043d\u0438\u0442: \u043f\u0440\u0438\u0442\u044f\u0433\u0438\u0432\u0430\u0435\u0442 \u043c\u043e\u043d\u0435\u0442\u044b \u043f\u0440\u044f\u043c\u043e \u0432 \u043a\u0430\u0440\u043c\u0430\u043d.==\u0414\u0435\u0439\u0441\u0442\u0432\u0443\u0435\u0442 40 \u0441\u0435\u043a\u0443\u043d\u0434.==[\u0423\u043b\u0443\u0447\u0448\u0435\u043d\u0438\u0435]==\u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c + 10 \u0441\u0435\u043a\u0443\u043d\u0434==\u0414\u0438\u0441\u0442\u0430\u043d\u0446\u0438\u044f \u043f\u043e\u0434\u0431\u043e\u0440\u0430 \u0443\u0432\u0435\u043b\u0438\u0447\u0435\u043d\u0430.",
gfx:"booster2",reqlvl:2},{type:tBoost,price:400,pricecrys:8,name:"Magnet$2",desc:"\u041c\u0430\u0433\u043d\u0438\u0442|\u041c\u0430\u0433\u043d\u0438\u0442: \u043f\u0440\u0438\u0442\u044f\u0433\u0438\u0432\u0430\u0435\u0442 \u043c\u043e\u043d\u0435\u0442\u044b \u043f\u0440\u044f\u043c\u043e \u0432 \u043a\u0430\u0440\u043c\u0430\u043d.==\u0414\u0435\u0439\u0441\u0442\u0432\u0443\u0435\u0442 40 \u0441\u0435\u043a\u0443\u043d\u0434.==[\u0423\u043b\u0443\u0447\u0448\u0435\u043d\u0438\u0435]==\u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c + 15 \u0441\u0435\u043a\u0443\u043d\u0434==\u0414\u0438\u0441\u0442\u0430\u043d\u0446\u0438\u044f \u043f\u043e\u0434\u0431\u043e\u0440\u0430 \u0443\u0432\u0435\u043b\u0438\u0447\u0435\u043d\u0430.",
gfx:"booster2",reqlvl:4},{type:tBoost,price:800,pricecrys:16,name:"Magnet$3",desc:"\u041c\u0430\u0433\u043d\u0438\u0442|\u041c\u0430\u0433\u043d\u0438\u0442: \u043f\u0440\u0438\u0442\u044f\u0433\u0438\u0432\u0430\u0435\u0442 \u043c\u043e\u043d\u0435\u0442\u044b \u043f\u0440\u044f\u043c\u043e \u0432 \u043a\u0430\u0440\u043c\u0430\u043d.==\u0414\u0435\u0439\u0441\u0442\u0432\u0443\u0435\u0442 40 \u0441\u0435\u043a\u0443\u043d\u0434.==[\u0423\u043b\u0443\u0447\u0448\u0435\u043d\u0438\u0435]==\u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c + 20 \u0441\u0435\u043a\u0443\u043d\u0434==\u0414\u0438\u0441\u0442\u0430\u043d\u0446\u0438\u044f \u043f\u043e\u0434\u0431\u043e\u0440\u0430 \u0443\u0432\u0435\u043b\u0438\u0447\u0435\u043d\u0430.",
gfx:"booster2",reqlvl:6},{type:tBoost,price:2E3,pricecrys:40,name:"Magnet$4",desc:"\u041c\u0430\u0433\u043d\u0438\u0442|\u041c\u0430\u0433\u043d\u0438\u0442: \u043f\u0440\u0438\u0442\u044f\u0433\u0438\u0432\u0430\u0435\u0442 \u043c\u043e\u043d\u0435\u0442\u044b \u043f\u0440\u044f\u043c\u043e \u0432 \u043a\u0430\u0440\u043c\u0430\u043d.==\u0414\u0435\u0439\u0441\u0442\u0432\u0443\u0435\u0442 40 \u0441\u0435\u043a\u0443\u043d\u0434.==[\u0423\u043b\u0443\u0447\u0448\u0435\u043d\u0438\u0435]==\u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c + 25 \u0441\u0435\u043a\u0443\u043d\u0434==\u0414\u0438\u0441\u0442\u0430\u043d\u0446\u0438\u044f \u043f\u043e\u0434\u0431\u043e\u0440\u0430 \u0443\u0432\u0435\u043b\u0438\u0447\u0435\u043d\u0430.",
gfx:"booster2",reqlvl:8},{type:tBoost,price:150,pricecrys:-1,name:"Tablets",desc:"\u0411\u0438\u043e\u0434\u043e\u0431\u0430\u0432\u043a\u0438|\u0422\u0430\u0431\u043b\u0435\u0442\u043a\u0430: \u0443\u0441\u043a\u043e\u0440\u044f\u0435\u0442 \u0434\u0435\u0434\u0430== \u0438 \u0434\u0435\u043b\u0430\u0435\u0442 \u043d\u0435\u0443\u044f\u0437\u0432\u0438\u043c\u044b\u043c \u043d\u0430 5 \u0441\u0435\u043a\u0443\u043d\u0434.==[\u0423\u043b\u0443\u0447\u0448\u0435\u043d\u0438\u0435]==\u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c + 1 \u0441\u0435\u043a\u0443\u043d\u0434\u0430.",
gfx:"booster1",reqlvl:1},{type:tBoost,price:300,pricecrys:6,name:"Tablets$1",desc:"\u0411\u0438\u043e\u0434\u043e\u0431\u0430\u0432\u043a\u0438|\u0422\u0430\u0431\u043b\u0435\u0442\u043a\u0430: \u0443\u0441\u043a\u043e\u0440\u044f\u0435\u0442 \u0434\u0435\u0434\u0430== \u0438 \u0434\u0435\u043b\u0430\u0435\u0442 \u043d\u0435\u0443\u044f\u0437\u0432\u0438\u043c\u044b\u043c \u043d\u0430 5 \u0441\u0435\u043a\u0443\u043d\u0434.==[\u0423\u043b\u0443\u0447\u0448\u0435\u043d\u0438\u0435]==\u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c + 2 \u0441\u0435\u043a\u0443\u043d\u0434\u044b.",
gfx:"booster1",reqlvl:3},{type:tBoost,price:600,pricecrys:12,name:"Tablets$2",desc:"\u0411\u0438\u043e\u0434\u043e\u0431\u0430\u0432\u043a\u0438|\u0422\u0430\u0431\u043b\u0435\u0442\u043a\u0430: \u0443\u0441\u043a\u043e\u0440\u044f\u0435\u0442 \u0434\u0435\u0434\u0430== \u0438 \u0434\u0435\u043b\u0430\u0435\u0442 \u043d\u0435\u0443\u044f\u0437\u0432\u0438\u043c\u044b\u043c \u043d\u0430 5 \u0441\u0435\u043a\u0443\u043d\u0434.==[\u0423\u043b\u0443\u0447\u0448\u0435\u043d\u0438\u0435]==\u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c + 3 \u0441\u0435\u043a\u0443\u043d\u0434\u044b.",
gfx:"booster1",reqlvl:6},{type:tBoost,price:1800,pricecrys:24,name:"Tablets$3",desc:"\u0411\u0438\u043e\u0434\u043e\u0431\u0430\u0432\u043a\u0438|\u0422\u0430\u0431\u043b\u0435\u0442\u043a\u0430: \u0443\u0441\u043a\u043e\u0440\u044f\u0435\u0442 \u0434\u0435\u0434\u0430==\u0438 \u0434\u0435\u043b\u0430\u0435\u0442 \u043d\u0435\u0443\u044f\u0437\u0432\u0438\u043c\u044b\u043c \u043d\u0430 5 \u0441\u0435\u043a\u0443\u043d\u0434.==[\u0423\u043b\u0443\u0447\u0448\u0435\u043d\u0438\u0435]==\u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c + 4 \u0441\u0435\u043a\u0443\u043d\u0434\u0430.",
gfx:"booster1",reqlvl:9},{type:tBoost,price:3500,pricecrys:60,name:"Tablets$4",desc:"\u0411\u0438\u043e\u0434\u043e\u0431\u0430\u0432\u043a\u0438|\u0422\u0430\u0431\u043b\u0435\u0442\u043a\u0430: \u0443\u0441\u043a\u043e\u0440\u044f\u0435\u0442 \u0434\u0435\u0434\u0430== \u0438 \u0434\u0435\u043b\u0430\u0435\u0442 \u043d\u0435\u0443\u044f\u0437\u0432\u0438\u043c\u044b\u043c \u043d\u0430 5 \u0441\u0435\u043a\u0443\u043d\u0434.==[\u0423\u043b\u0443\u0447\u0448\u0435\u043d\u0438\u0435]==\u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c + 5 \u0441\u0435\u043a\u0443\u043d\u0434.",
gfx:"booster1",reqlvl:12},{type:tBoost,price:500,pricecrys:-1,name:"Health",desc:"\u0411\u043e\u043b\u044c\u0448\u0435 \u0416\u042b\u0417\u041d\u0418|\u0421\u0435\u0440\u0434\u0446\u0435: \u043b\u0435\u0447\u0438\u0442 \u043d\u0430 1 \u0436\u0438\u0437\u043d\u044c==[\u0423\u043b\u0443\u0447\u0448\u0435\u043d\u0438\u0435]==\u043b\u0435\u0447\u0438\u0442 \u043d\u0430 2 \u0436\u0438\u0437\u043d\u0438",gfx:"booster4",reqlvl:1},{type:tBoost,price:1E3,pricecrys:20,name:"Health$1",desc:"\u0411\u043e\u043b\u044c\u0448\u0435 \u0416\u042b\u0417\u041d\u0418|\u0421\u0435\u0440\u0434\u0446\u0435: \u043b\u0435\u0447\u0438\u0442 \u043d\u0430 1 \u0436\u0438\u0437\u043d\u044c==[\u0423\u043b\u0443\u0447\u0448\u0435\u043d\u0438\u0435]==\u043b\u0435\u0447\u0438\u0442 \u043d\u0430 3 \u0436\u0438\u0437\u043d\u0438",
gfx:"booster4",reqlvl:4},{type:tBoost,price:2E3,pricecrys:40,name:"Health$2",desc:"\u0411\u043e\u043b\u044c\u0448\u0435 \u0416\u042b\u0417\u041d\u0418|\u0421\u0435\u0440\u0434\u0446\u0435: \u043b\u0435\u0447\u0438\u0442 \u043d\u0430 1 \u0436\u0438\u0437\u043d\u044c.==[\u0423\u043b\u0443\u0447\u0448\u0435\u043d\u0438\u0435]==\u041b\u0435\u0447\u0438\u0442 \u043d\u0430 4 \u0436\u0438\u0437\u043d\u0438.",gfx:"booster4",reqlvl:8},{type:tBoost,price:4E3,pricecrys:80,name:"Health$3",desc:"\u0411\u043e\u043b\u044c\u0448\u0435 \u0416\u042b\u0417\u041d\u0418|\u0421\u0435\u0440\u0434\u0446\u0435: \u043b\u0435\u0447\u0438\u0442 \u043d\u0430 1 \u0436\u0438\u0437\u043d\u044c==[\u0423\u043b\u0443\u0447\u0448\u0435\u043d\u0438\u0435]==\u043b\u0435\u0447\u0438\u0442 \u043d\u0430 5 \u0436\u0438\u0437\u043d\u0435\u0439",
gfx:"booster4",reqlvl:12},{type:tBoost,price:1E4,pricecrys:200,name:"Health$4",desc:"\u0411\u043e\u043b\u044c\u0448\u0435 \u0416\u042b\u0417\u041d\u0418|\u0421\u0435\u0440\u0434\u0446\u0435: \u043b\u0435\u0447\u0438\u0442 \u043d\u0430 1 \u0436\u0438\u0437\u043d\u044c==[\u0423\u043b\u0443\u0447\u0448\u0435\u043d\u0438\u0435]==\u0412\u043e\u0441\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u0442 \u0437\u0434\u043e\u0440\u043e\u0432\u044c\u0435==+\u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u0441\u043b\u043e\u0442 \u0436\u0438\u0437\u043d\u0438 \u043d\u0430\u0432\u0441\u0435\u0433\u0434\u0430.",
gfx:"booster4",reqlvl:15},{type:tBoost,price:300,pricecrys:-1,name:"MarioStar",desc:"\u041d\u0435\u0443\u044f\u0437\u0432\u0438\u043c\u043e\u0441\u0442\u044c!|\u0413\u043b\u0443\u0448\u0438\u0442\u0435\u043b\u044c \u043e\u0442 \u00ab\u0412\u043e\u043b\u0433\u0438\u00bb:==\u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0434\u0435\u0434\u0443 \u043b\u0435\u0442\u0430\u0442\u044c \u0432 \u0442\u0435\u0447\u0435\u043d\u0438\u0435 9 \u0441\u0435\u043a\u0443\u043d\u0434.==[\u0423\u043b\u0443\u0447\u0448\u0435\u043d\u0438\u0435]==\u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c + 2 \u0441\u0435\u043a\u0443\u043d\u0434\u044b.",
gfx:"booster5",reqlvl:1},{type:tBoost,price:600,pricecrys:8,name:"MarioStar$1",desc:"\u041d\u0435\u0443\u044f\u0437\u0432\u0438\u043c\u043e\u0441\u0442\u044c!|\u0413\u043b\u0443\u0448\u0438\u0442\u0435\u043b\u044c \u043e\u0442 \u00ab\u0412\u043e\u043b\u0433\u0438\u00bb:==\u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0434\u0435\u0434\u0443 \u043b\u0435\u0442\u0430\u0442\u044c \u0432 \u0442\u0435\u0447\u0435\u043d\u0438\u0435 9 \u0441\u0435\u043a\u0443\u043d\u0434.==[\u0423\u043b\u0443\u0447\u0448\u0435\u043d\u0438\u0435]==\u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c + 4 \u0441\u0435\u043a\u0443\u043d\u0434\u044b.",
gfx:"booster5",reqlvl:3},{type:tBoost,price:1200,pricecrys:16,name:"MarioStar$2",desc:"\u041d\u0435\u0443\u044f\u0437\u0432\u0438\u043c\u043e\u0441\u0442\u044c!|\u0413\u043b\u0443\u0448\u0438\u0442\u0435\u043b\u044c \u043e\u0442 \u00ab\u0412\u043e\u043b\u0433\u0438\u00bb:==\u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0434\u0435\u0434\u0443 \u043b\u0435\u0442\u0430\u0442\u044c \u0432 \u0442\u0435\u0447\u0435\u043d\u0438\u0435 9 \u0441\u0435\u043a\u0443\u043d\u0434.==[\u0423\u043b\u0443\u0447\u0448\u0435\u043d\u0438\u0435]==\u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c + 6 \u0441\u0435\u043a\u0443\u043d\u0434\u044b.",
gfx:"booster5",reqlvl:5},{type:tBoost,price:2400,pricecrys:32,name:"MarioStar$3",desc:"\u041d\u0435\u0443\u044f\u0437\u0432\u0438\u043c\u043e\u0441\u0442\u044c!|\u0413\u043b\u0443\u0448\u0438\u0442\u0435\u043b\u044c \u043e\u0442 \u00ab\u0412\u043e\u043b\u0433\u0438\u00bb:==\u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0434\u0435\u0434\u0443 \u043b\u0435\u0442\u0430\u0442\u044c \u0432 \u0442\u0435\u0447\u0435\u043d\u0438\u0435 9 \u0441\u0435\u043a\u0443\u043d\u0434.==[\u0423\u043b\u0443\u0447\u0448\u0435\u043d\u0438\u0435]==\u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c + 8 \u0441\u0435\u043a\u0443\u043d\u0434\u044b.",
gfx:"booster5",reqlvl:7},{type:tBoost,price:5E3,pricecrys:100,name:"MarioStar$4",desc:"\u041d\u0435\u0443\u044f\u0437\u0432\u0438\u043c\u043e\u0441\u0442\u044c!|\u0413\u043b\u0443\u0448\u0438\u0442\u0435\u043b\u044c \u043e\u0442 \u00ab\u0412\u043e\u043b\u0433\u0438\u00bb:==\u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0434\u0435\u0434\u0443 \u043b\u0435\u0442\u0430\u0442\u044c \u0432 \u0442\u0435\u0447\u0435\u043d\u0438\u0435 9 \u0441\u0435\u043a\u0443\u043d\u0434.==[\u0423\u043b\u0443\u0447\u0448\u0435\u043d\u0438\u0435]==\u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c + 10 \u0441\u0435\u043a\u0443\u043d\u0434\u044b.",
gfx:"booster5",reqlvl:10},{type:tBoost,price:600,pricecrys:-1,name:"Double",desc:"\u0412 \u0434\u0432\u0430 \u0440\u0430\u0437\u0430 \u0431\u043e\u043b\u044c\u0448\u0435 \u043c\u043e\u043d\u0435\u0442|\u0421\u0447\u0430\u0441\u0442\u043b\u0438\u0432\u0430\u044f \u043c\u043e\u043d\u0435\u0442\u043a\u0430: ==\u0412\u044b\u043f\u0430\u0434\u0430\u0435\u0442 \u0431\u043e\u043b\u044c\u0448\u0435 \u0437\u043e\u043b\u043e\u0442\u0430. \u0414\u0435\u0439\u0441\u0442\u0432\u0443\u0435\u0442 15 \u0441\u0435\u043a\u0443\u043d\u0434.==[\u0423\u043b\u0443\u0447\u0448\u0435\u043d\u0438\u0435]==\u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c + 3 \u0441\u0435\u043a\u0443\u043d\u0434\u044b.==+225% \u0437\u043e\u043b\u043e\u0442\u0430.",
gfx:"booster3",reqlvl:-1},{type:tBoost,price:1200,pricecrys:24,name:"Double$1",desc:"\u0412 \u0434\u0432\u0430 \u0440\u0430\u0437\u0430 \u0431\u043e\u043b\u044c\u0448\u0435 \u043c\u043e\u043d\u0435\u0442|\u0421\u0447\u0430\u0441\u0442\u043b\u0438\u0432\u0430\u044f \u043c\u043e\u043d\u0435\u0442\u043a\u0430: ==\u0412\u044b\u043f\u0430\u0434\u0430\u0435\u0442 \u0431\u043e\u043b\u044c\u0448\u0435 \u0437\u043e\u043b\u043e\u0442\u0430. \u0414\u0435\u0439\u0441\u0442\u0432\u0443\u0435\u0442 15 \u0441\u0435\u043a\u0443\u043d\u0434.==[\u0423\u043b\u0443\u0447\u0448\u0435\u043d\u0438\u0435]==\u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c + 6 \u0441\u0435\u043a\u0443\u043d\u0434.==+250% \u0437\u043e\u043b\u043e\u0442\u0430.",
gfx:"booster3",reqlvl:4},{type:tBoost,price:2200,pricecrys:44,name:"Double$2",desc:"\u0412 \u0434\u0432\u0430 \u0440\u0430\u0437\u0430 \u0431\u043e\u043b\u044c\u0448\u0435 \u043c\u043e\u043d\u0435\u0442|\u0421\u0447\u0430\u0441\u0442\u043b\u0438\u0432\u0430\u044f \u043c\u043e\u043d\u0435\u0442\u043a\u0430: ==\u0412\u044b\u043f\u0430\u0434\u0430\u0435\u0442 \u0431\u043e\u043b\u044c\u0448\u0435 \u0437\u043e\u043b\u043e\u0442\u0430. \u0414\u0435\u0439\u0441\u0442\u0432\u0443\u0435\u0442 15 \u0441\u0435\u043a\u0443\u043d\u0434.==[\u0423\u043b\u0443\u0447\u0448\u0435\u043d\u0438\u0435]==\u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c + 9 \u0441\u0435\u043a\u0443\u043d\u0434.== +275% \u0437\u043e\u043b\u043e\u0442\u0430.",
gfx:"booster3",reqlvl:8},{type:tBoost,price:4400,pricecrys:88,name:"Double$3",desc:"\u0412 \u0434\u0432\u0430 \u0440\u0430\u0437\u0430 \u0431\u043e\u043b\u044c\u0448\u0435 \u043c\u043e\u043d\u0435\u0442|\u0421\u0447\u0430\u0441\u0442\u043b\u0438\u0432\u0430\u044f \u043c\u043e\u043d\u0435\u0442\u043a\u0430: ==\u0412\u044b\u043f\u0430\u0434\u0430\u0435\u0442 \u0431\u043e\u043b\u044c\u0448\u0435 \u0437\u043e\u043b\u043e\u0442\u0430. \u0414\u0435\u0439\u0441\u0442\u0432\u0443\u0435\u0442 15 \u0441\u0435\u043a\u0443\u043d\u0434.==[\u0423\u043b\u0443\u0447\u0448\u0435\u043d\u0438\u0435]==\u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c + 12 \u0441\u0435\u043a\u0443\u043d\u0434.== +300% \u0437\u043e\u043b\u043e\u0442\u0430",
gfx:"booster3",reqlvl:10},{type:tBoost,price:9E3,pricecrys:180,name:"Double$4",desc:"\u0412 \u0434\u0432\u0430 \u0440\u0430\u0437\u0430 \u0431\u043e\u043b\u044c\u0448\u0435 \u043c\u043e\u043d\u0435\u0442|\u0421\u0447\u0430\u0441\u0442\u043b\u0438\u0432\u0430\u044f \u043c\u043e\u043d\u0435\u0442\u043a\u0430: ==\u0412\u044b\u043f\u0430\u0434\u0430\u0435\u0442 \u0431\u043e\u043b\u044c\u0448\u0435 \u0437\u043e\u043b\u043e\u0442\u0430. \u0414\u0435\u0439\u0441\u0442\u0432\u0443\u0435\u0442 15 \u0441\u0435\u043a\u0443\u043d\u0434.==[\u0423\u043b\u0443\u0447\u0448\u0435\u043d\u0438\u0435]==\u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c + 15 \u0441\u0435\u043a\u0443\u043d\u0434.== +325% \u0437\u043e\u043b\u043e\u0442\u0430",
gfx:"booster3",reqlvl:15},{type:tApp+tHat,price:1500,pricecrys:-1,name:"Appearence.Hat1",desc:"\u0421\u0442\u0430\u0440\u0430\u044f \u0434\u043e\u0431\u0440\u0430\u044f \u0443\u0448\u0430\u043d\u043e\u0447\u043a\u0430.",gfx:"hat1",reqlvl:-1},{type:tApp+tHat,price:3200,pricecrys:-1,name:"Appearence.Hat2",desc:"\u0411\u043e\u0435\u0432\u0430\u044f \u043a\u0430\u0441\u043a\u0430.==\u041e\u0441\u0442\u0430\u043b\u0430\u0441\u044c \u0441\u043e \u0432\u0440\u0435\u043c\u0451\u043d \u0432\u043e\u0439\u043d\u044b.",
gfx:"hat2",reqlvl:-1},{type:tApp+tHat,price:5300,pricecrys:-1,name:"Appearence.Hat3",desc:"\u0412\u044f\u0437\u0430\u043d\u0430\u044f \u0448\u0430\u043f\u043a\u0430.==\u0421\u0434\u0435\u043b\u0430\u043d\u0430 \u0431\u0430\u0431\u043a\u043e\u0439 \u0441 \u043b\u044e\u0431\u043e\u0432\u044c\u044e.",gfx:"hat3",reqlvl:-1},{type:tApp+tHat,price:8500,pricecrys:-1,name:"Appearence.Hat4",desc:"\u041c\u043e\u043b\u043e\u0434\u0451\u0436\u043d\u0430\u044f \u043a\u0435\u043f\u043a\u0430.==\u0412\u043d\u0443\u0447\u043e\u043a \u043e\u0441\u0442\u0430\u0432\u0438\u043b \u043e\u0434\u043d\u0430\u0436\u0434\u044b \u0438 \u0437\u0430\u0431\u044b\u043b \u0437\u0430\u0431\u0440\u0430\u0442\u044c.",
gfx:"hat4",reqlvl:-1},{type:tApp+tHat,price:1E4,pricecrys:-1,name:"Appearence.Hat5",desc:"\u041f\u043e\u0434\u0430\u0440\u043e\u043a \u043e\u0442 \u0441\u0442\u0430\u0440\u043e\u0433\u043e \u0442\u043e\u0432\u0430\u0440\u0438\u0449\u0430 \u0411\u0440\u044e\u0441\u0430.",gfx:"hat5",reqlvl:-1},{type:tApp+tHat,price:13E3,pricecrys:-1,name:"Appearence.Hat6",desc:"\u041a\u043e\u0432\u0431\u043e\u0439\u0441\u043a\u0430\u044f \u0448\u043b\u044f\u043f\u0430.==\u0421\u044b\u043d \u043f\u0440\u0438\u0432\u0451\u0437 \u0438\u0437 \u043a\u043e\u043c\u0430\u043d\u0434\u0438\u0440\u043e\u0432\u043a\u0438 \u0432 \u0410\u043c\u0435\u0440\u0438\u043a\u0443.",
gfx:"hat6",reqlvl:-1}]}];function updDb(a,b){for(var c=0;c<a.length;++c)for(var d=window.azureclient.getTable(a[c].tbname),e=0;e<a[c].items.length;++e)(function(b,d){d.where(a[c].items[e].id?{id:a[c].items[e].id}:{name:a[c].items[e].name}).read().done(function(a){0<a.length?(b.id=a[0].id,d.update(b)):d.insert(b)},function(a){console.log("Error: "+a)})})(a[c].items[e],d)}
function getParameterByName(a,b){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c=(new RegExp("[\\?&]"+a+"=([^&#]*)")).exec(b);return null===c?"":decodeURIComponent(c[1].replace(/\+/g," "))}
getDedImage=function(a){shopStage.transScreen&&(shopStage.transScreen.visible=!1);if(a)var b=300,c=365,d=-55,e=-120;else b=SCR_WIDTH/2,c=SCR_HEIGHT,e=d=0;b=new PIXI.RenderTexture(b,c);a&&(CObj.getById("bback").gfx.visible=!1,CObj.getById("ava").gfx.visible=!1,CObj.getById("bgshopded").gfx.visible=!1);renderer.render(stage,!0);c=new PIXI.Matrix;c.translate(d,e);b.render(SM.inst.superStage,c);d=b.getBase64();b.destroy(!0);a&&(CObj.getById("bgshopded").gfx.visible=!0,CObj.getById("bback").gfx.visible=
!0,CObj.getById("ava").gfx.visible=!0);shopStage.transScreen&&(shopStage.transScreen.visible=!0);return d};
uploadPhoto=function(a,b,c){var d=getDedImage(b),d=d.replace(/^data:image\/(png|jpg);base64,/,"");VK.api(b?"photos.getProfileUploadServer":"photos.getWallUploadServer",{uid:a},function(a){a=a.response.upload_url;getParameterByName("hash",a);getParameterByName("rhash",a);$.ajax({type:"POST",url:"upload.php",data:{uploadUrl:a,photo:d},dataType:"text"}).success(function(a){a=JSON.parse(a);b?VK.api("photos.saveProfilePhoto",{server:a.server,photo:a.photo,hash:a.hash},function(a){console.log("SSS")},function(a){c&&
c();console.log("SSS")}):VK.api("photos.saveWallPhoto",{uid:vkparams.viewerid,server:a.server,photo:a.photo,hash:a.hash},function(a){a.response&&VK.api("wall.post",{owner_id:vkparams.viewerid,message:"\u0421\u043f\u0430\u0441\u0438\u0431\u043e \u0434\u0435\u0434\u0443 \u0437\u0430 \u0441\u0435\u043b\u0444\u0438",attachments:a.response[0].id},function(a){c&&c();console.log("SSS")},function(a){c&&c();console.log("SSS")})});console.log("")}).error(function(a){console.log("");c&&c()})})};
function post(a,b,c){c=c||"post";var d=document.createElement("form");d.setAttribute("method",c);d.setAttribute("action",a);for(var e in b)b.hasOwnProperty(e)&&(a=document.createElement("input"),a.setAttribute("type","hidden"),a.setAttribute("name",e),a.setAttribute("value",b[e]),d.appendChild(a));document.body.appendChild(d);d.submit()}PauseTimer=function(){};PauseTimer.paused=!1;PauseTimer.pauseStartedAt=0;PauseTimer.totalPauseTime=0;PauseTimer.getTimer=function(){return window.time-PauseTimer.totalPauseTime};
PauseTimer.isPaused=function(){return PauseTimer.paused};PauseTimer.pause=function(){PauseTimer.pauseStartedAt=window.time;TweenMax.pauseAll();PauseTimer.paused=!0};PauseTimer.resume=function(){PauseTimer.paused&&(PauseTimer.totalPauseTime+=window.time-PauseTimer.pauseStartedAt,TweenMax.resumeAll(),PauseTimer.paused=!1)};window.MOBILE?(window.SCR_WIDTH=1024,window.SCR_HEIGHT=576):(window.SCR_WIDTH=800,window.SCR_HEIGHT=600);window.SCR_SCALE=1;window.FRAME_RATE=60;var loadingState="prepreload";
window.openSponsorWindow=null;window.focus();var assetsLoaded=0,preloaderAsset=["imgtps/preloader.json"];window.addScale=1;window.renderer=new PIXI.autoDetectRenderer(window.SCR_WIDTH,window.SCR_HEIGHT);window.loader=new PIXI.AssetLoader(preloaderAsset);window.loader.onComplete=preloaderLoaded;window.loader.load();PlayerData.dbInit();$(document).bind("contextmenu",function(){return!1});window.apiid=4654201;VK.init({apiId:window.apiid},function(){},function(){});
function order(a){var b={type:"item",item:a};window.currentOrder=a;VK.callMethod("showOrderBox",b)}
function orderSuccess(a){"item1"==window.currentOrder&&(null==window.currentOrder,PlayerData.inst.playerItem.money+=1200);"item2"==window.currentOrder&&(null==window.currentOrder,PlayerData.inst.playerItem.money+=6E3);"item3"==window.currentOrder&&(null==window.currentOrder,PlayerData.inst.playerItem.money+=32E3);"item4"==window.currentOrder&&(null==window.currentOrder,PlayerData.inst.playerItem.crystals+=12);"item5"==window.currentOrder&&(null==window.currentOrder,PlayerData.inst.playerItem.crystals+=
60);"item6"==window.currentOrder&&(null==window.currentOrder,PlayerData.inst.playerItem.crystals+=320);"item7"==window.currentOrder&&(null==window.currentOrder,PlayerData.inst.playerItem.energy+=10);PlayerData.inst.savePlayerData();shopStage.updateStatsPanel();VK.orderComplete&&VK.orderComplete(a)}VK.addCallback("onOrderSuccess",orderSuccess);VK.addCallback("onOrderFail",function(){VK.orderFail&&(VK.orderFail(),VK.orderFail=null)});
VK.addCallback("onOrderCancel",function(){VK.orderCancel&&(VK.orderCancel(),VK.orderCancel=null)});function showADs2(){var a=vkparams.viewerid,b=window.apiid,c=new VKAdman;c.onNoAds(function(){console.log("Adman: No ads")});c.onStarted(function(){console.log("Adman: Started")});c.onCompleted(function(){console.log("Adman: Completed")});c.onSkipped(function(){console.log("Adman: Skipped")});c.onClicked(function(){console.log("Adman: Clicked")});c.setupPreroll(b);admanStat(b,a)}
function showADs(){var a=document.createElement("div");a.id="vk_ads_55316";a.setAttribute("style","position:absolute;left:0%;top:0%;");document.body.appendChild(a);setTimeout(function(){function a(){VK.Widgets.Ads("vk_ads_55316",{},c)}var c={ad_unit_id:55316,ad_unit_hash:"d4685898a5210c69b772bf2ab6fb0571"};if(window.VK&&VK.Widgets)a();else{window.vkAsyncInitCallbacks||(window.vkAsyncInitCallbacks=[]);vkAsyncInitCallbacks.push(a);var d="https:"===location.protocol?"https:":"http:",e=document.getElementById("vk_ads_55316"),
f=document.createElement("script");f.type="text/javascript";f.async=!0;f.src=d+"//vk.com/js/api/openapi.js?116";e.parentNode.insertBefore(f,e.nextSibling)}},0)}
function preloaderLoaded(){window.stage=new PIXI.Stage(16777215);window.px=SCR_WIDTH;window.py=SCR_HEIGHT;window.loadingScreen=new PIXI.Graphics;window.preloaderBg=new PIXI.DisplayObjectContainer;var a=1.1;window.MOBILE&&(a=1.3);var b=crsp("1st plan");b.x=SCR_WIDTH/2;b.y=SCR_HEIGHT/2;b.scale.x=a;b.scale.y=a;var c=crsp("background");c.x=SCR_WIDTH/2;c.y=SCR_HEIGHT/2;c.scale.x=a;c.scale.y=a;preloaderBg.addChild(c);preloaderBg.addChild(b);a=crsp("loading bar");a.x=SCR_WIDTH/2;a.y=SCR_HEIGHT/2+160;preloaderBg.addChild(a);
SM.inst.addLayersToStage();SM.inst.superStage.addChild(preloaderBg);a=crsp("loading bar line");a.x=SCR_WIDTH/2;a.y=SCR_HEIGHT/2+160;window.pbWidth=a.width;a.mask=new PIXI.Graphics;a.mask.x=-pbWidth/2;window.progressMask=a.mask;a.addChild(a.mask);preloaderBg.addChild(a);SM.inst.addLayersToStage();SM.inst.superStage.addChild(loadingScreen);requestAnimFrame(animate);window.loadingState="loading";window.assetsToLoader="levels/energywindow.json levels/settings.json levels/levelpremium.json levels/levelup.json levels/levach.json levels/levshop.json levels/hud.json levels/plantPart1.json levels/plantPart2.json levels/levelmenu.json levels/levelselect.json levels/levelwin.json levels/levelsoundcheck.json levels/levelgameover.json levels/credits.json levels/wingame.json levels/rotatescreen.json levels/levchar.json levels/levscore.json levels/upperPanel.json imgtps/comix.json imgtps/bg.json imgtps/guiatlas.json imgtps/pussyatlas.json imgtps/dedgamedesc.xml imgtps/dedgamecaps.xml imgtps/dedgameXP.xml imgtps/skeleton.json imgtps/boss1.json imgtps/bird.json".split(" ");
window.prevW=window.innerWidth;window.prevH=window.innerHeight;window.loader=new PIXI.AssetLoader(assetsToLoader);document.body.appendChild(renderer.view);PIXI.scaleModes.DEFAULT=0;window.comixStage=new ComixStage;window.scoreStage=new ScoreStage;window.gameStage=new GameStage;window.achStage=new AchStage;window.shopStage=new ShopStage;window.charStage=new CharStage;window.pool=new ZPool;FRAME_DELAY=1E3/FRAME_RATE;window.addEventListener("resize",onWindowResize,!1);window.addEventListener("resizeend",
onWindowResize,!1);rescale();onWindowResize();window.lastLoop=0;assetsButSoundsLoaded();loader.onComplete=function(){window.loaded=!0;window.gfxLoaded=!0;onAssetsLoaded()};loader.load();loader.onProgress=onAssetsProgress}function onAssetsProgress(a){window.assetsLoaded++;a.json&&void 0!=a.json.objects&&(LevelManager.levels[a.url]=a.json)}
function assetsButSoundsLoaded(){ZSound.soundLoadedFunction=onAssetsLoaded;ZSound.Init([{id:"m_ded",src:"Dedushka.ogg"},{id:"m_room",src:"PostRoom.ogg"},{id:"CLICK",src:"CLICK2.ogg"},{id:"jump",src:"jump.ogg"},{id:"jump2",src:"jump2.ogg"},{id:"lazer",src:"Vystrel_lazer.ogg"},{id:"mini",src:"Vystrel_minigan.ogg"},{id:"ochered",src:"Vystrel_ochered.ogg"},{id:"rifle",src:"rifle.ogg"},{id:"levelup",src:"levelup.ogg"},{id:"buy",src:"buy.ogg"},{id:"losing",src:"losing.ogg"},{id:"grenade",src:"grenade.ogg"},
{id:"vzbodritsa",src:"vzbodritsa.ogg"},{id:"coin",src:"Pickup_Coin66.ogg"}])}
function onAssetsLoaded(){if(window.dbinit&&1==ZSound.loaded&&window.gfxLoaded){rp(preloaderBg);loadingState="game";rp(loadingScreen);preloaderBg=loadingScreen=null;gameStage.currentLevel=1;PIXI.TextureCache["1st plan.png"].destroy(!0);window.progressMask=null;window.addEventListener("orientationchange",orientchange,!1);orientchange();setTimeout("window.scrollTo(0, 1)",10);var a=document.getElementById("vk_ads_55316");a&&a.parentNode.removeChild(a);vkparams.registered?SM.inst.openStage(comixStage):
SM.inst.openStage(charStage)}}function orientchange(){switch(window.orientation){case 0:addRotationText();break;case 90:removeRotationText();break;case -90:removeRotationText()}}function removeRotationText(){document.body.removeChild(window.rotatebg);window.rotatebg=null;document.body.removeChild(window.icorotate);window.icorotate=null}
function addRotationText(){window.icorotate||(window.rotatebg=document.createElement("img"),window.rotatebg.setAttribute("src","rotatebg.png"),document.body.appendChild(window.rotatebg),window.icorotate=document.createElement("img"),window.icorotate.setAttribute("src","rotatescreen.png"),document.body.appendChild(window.icorotate),rescale())}
function applyRatio(a,b){if(1!=b)if(a.position.x*=b,a.position.y*=b,0==a.children.length)a.scale.x*=b,a.scale.y*=b;else if(CObj.checkType(a,PIXI.Spine)||CObj.checkType(a,PIXI.Sprite)||CObj.checkType(a,PIXI.MovieClip))a.scale.x*=b,a.scale.y*=b;else for(var c=0;c<a.children.length;c++)applyRatio(a.children[c],b)}
function rescale(){rescTimeout=null;window.scrollTo(0,0);SCR_SCALE=Math.min(window.innerWidth/SCR_WIDTH,window.innerHeight/SCR_HEIGHT);renderer.resize(SCR_WIDTH*SCR_SCALE,SCR_HEIGHT*SCR_SCALE);SM.inst.superStage&&(SM.inst.superStage.scale.x=SCR_SCALE,SM.inst.superStage.scale.y=SCR_SCALE);var a=window.innerWidth/2-SCR_WIDTH*SCR_SCALE/2;renderer.view.setAttribute("style","position:absolute;left:"+a.toString()+"px;top:"+(window.innerHeight/2-SCR_HEIGHT*SCR_SCALE/2).toString()+"px");if(window.icorotate){window.rotatebg.width=
window.innerWidth-2*a;window.rotatebg.height=window.innerHeight;window.rotatebg.setAttribute("style","position:absolute;left:"+Math.round(a)+"px;top:0px");window.icorotate.width=325*SCR_SCALE;window.icorotate.height=325*SCR_SCALE;var a=Math.round(window.innerWidth/2),b=Math.round(window.innerHeight/2)-window.icorotate.height/2;window.icorotate.setAttribute("style","position:absolute;left:"+a.toString()+"px;top:"+b.toString()+"px;margin-left:"+(-window.icorotate.width/2).toString()+"px;")}}
function onWindowResize(){rescTimeout&&clearTimeout(rescTimeout);rescTimeout=setTimeout(rescale,300)}
function animate(){requestAnimFrame(animate);window.time=(new Date).getTime();if("prepreload"!=loadingState)if("loading"==loadingState){var a=assetsLoaded/window.assetsToLoader.length;1<a&&(a=1);var b=5*Math.cos(window.time/2E3),c=5*Math.sin(window.time/1600);window.preloaderBg.children[0].x=SCR_WIDTH/2+b;window.preloaderBg.children[0].y=SCR_HEIGHT/2-c/3;window.preloaderBg.children[1].x=SCR_WIDTH/2-b;window.preloaderBg.children[1].y=SCR_HEIGHT/2-c;window.progressMask.clear();window.progressMask.beginFill(16742263);
window.progressMask.drawRect(0,-16,(window.pbWidth+1)*a,28);window.progressMask.endFill()}else"game"==loadingState&&(SM.inst&&SM.inst.process(),lastLoop=new Date);renderer.render(stage)};
